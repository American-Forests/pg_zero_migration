#!/usr/bin/env node
import { createRequire } from 'module'; const require = createRequire(import.meta.url);
var Td=Object.create;var vs=Object.defineProperty;var Cd=Object.getOwnPropertyDescriptor;var _d=Object.getOwnPropertyNames;var Rd=Object.getPrototypeOf,Ad=Object.prototype.hasOwnProperty;var w=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var m=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var vd=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of _d(t))!Ad.call(e,o)&&o!==r&&vs(e,o,{get:()=>t[o],enumerable:!(n=Cd(t,o))||n.enumerable});return e};var Is=(e,t,r)=>(r=e!=null?Td(Rd(e)):{},vd(t||!e||!e.__esModule?vs(r,"default",{value:e,enumerable:!0}):r,e));var Qr=m(Os=>{"use strict";Os.parse=function(e,t){return new Gr(e,t).parse()};var Gr=class e{constructor(t,r){this.source=t,this.transform=r||Id,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var t=this.source[this.position++];return t==="\\"?{value:this.source[this.position++],escaped:!0}:{value:t,escaped:!1}}record(t){this.recorded.push(t)}newEntry(t){var r;(this.recorded.length>0||t)&&(r=this.recorded.join(""),r==="NULL"&&!t&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var t=this.nextCharacter();if(t.value==="=")break}}parse(t){var r,n,o;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!o)this.dimension++,this.dimension>1&&(n=new e(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!o){if(this.dimension--,!this.dimension&&(this.newEntry(),t))return this.entries}else r.value==='"'&&!r.escaped?(o&&this.newEntry(!0),o=!o):r.value===","&&!o?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function Id(e){return e}});var Wr=m((gT,Ds)=>{var Od=Qr();Ds.exports={create:function(e,t){return{parse:function(){return Od.parse(e,t)}}}}});var Ls=m((yT,Ps)=>{"use strict";var Dd=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Md=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Pd=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Ld=/^-?infinity$/;Ps.exports=function(t){if(Ld.test(t))return Number(t.replace("i","I"));var r=Dd.exec(t);if(!r)return kd(t)||null;var n=!!r[8],o=parseInt(r[1],10);n&&(o=Ms(o));var s=parseInt(r[2],10)-1,i=r[3],a=parseInt(r[4],10),c=parseInt(r[5],10),l=parseInt(r[6],10),u=r[7];u=u?1e3*parseFloat(u):0;var f,d=$d(t);return d!=null?(f=new Date(Date.UTC(o,s,i,a,c,l,u)),zr(o)&&f.setUTCFullYear(o),d!==0&&f.setTime(f.getTime()-d)):(f=new Date(o,s,i,a,c,l,u),zr(o)&&f.setFullYear(o)),f};function kd(e){var t=Md.exec(e);if(t){var r=parseInt(t[1],10),n=!!t[4];n&&(r=Ms(r));var o=parseInt(t[2],10)-1,s=t[3],i=new Date(r,o,s);return zr(r)&&i.setFullYear(r),i}}function $d(e){if(e.endsWith("+00"))return 0;var t=Pd.exec(e.split(" ")[1]);if(t){var r=t[1];if(r==="Z")return 0;var n=r==="-"?-1:1,o=parseInt(t[2],10)*3600+parseInt(t[3]||0,10)*60+parseInt(t[4]||0,10);return o*n*1e3}}function Ms(e){return-(e-1)}function zr(e){return e>=0&&e<100}});var $s=m((bT,ks)=>{ks.exports=Nd;var Bd=Object.prototype.hasOwnProperty;function Nd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Bd.call(r,n)&&(e[n]=r[n])}return e}});var Fs=m((ST,Ns)=>{"use strict";var Fd=$s();Ns.exports=we;function we(e){if(!(this instanceof we))return new we(e);Fd(this,Xd(e))}var qd=["seconds","minutes","hours","days","months","years"];we.prototype.toPostgres=function(){var e=qd.filter(this.hasOwnProperty,this);return this.milliseconds&&e.indexOf("seconds")<0&&e.push("seconds"),e.length===0?"0":e.map(function(t){var r=this[t]||0;return t==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+t},this).join(" ")};var Ud={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},jd=["years","months","days"],Gd=["hours","minutes","seconds"];we.prototype.toISOString=we.prototype.toISO=function(){var e=jd.map(r,this).join(""),t=Gd.map(r,this).join("");return"P"+e+"T"+t;function r(n){var o=this[n]||0;return n==="seconds"&&this.milliseconds&&(o=(o+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),o+Ud[n]}};var Hr="([+-]?\\d+)",Qd=Hr+"\\s+years?",Wd=Hr+"\\s+mons?",zd=Hr+"\\s+days?",Hd="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Vd=new RegExp([Qd,Wd,zd,Hd].map(function(e){return"("+e+")?"}).join("\\s*")),Bs={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Yd=["hours","minutes","seconds","milliseconds"];function Kd(e){var t=e+"000000".slice(e.length);return parseInt(t,10)/1e3}function Xd(e){if(!e)return{};var t=Vd.exec(e),r=t[8]==="-";return Object.keys(Bs).reduce(function(n,o){var s=Bs[o],i=t[s];return!i||(i=o==="milliseconds"?Kd(i):parseInt(i,10),!i)||(r&&~Yd.indexOf(o)&&(i*=-1),n[o]=i),n},{})}});var Us=m((wT,qs)=>{"use strict";qs.exports=function(t){if(/^\\x/.test(t))return new Buffer(t.substr(2),"hex");for(var r="",n=0;n<t.length;)if(t[n]!=="\\")r+=t[n],++n;else if(/[0-7]{3}/.test(t.substr(n+1,3)))r+=String.fromCharCode(parseInt(t.substr(n+1,3),8)),n+=4;else{for(var o=1;n+o<t.length&&t[n+o]==="\\";)o++;for(var s=0;s<Math.floor(o/2);++s)r+="\\";n+=Math.floor(o/2)*2}return new Buffer(r,"binary")}});var Vs=m((ET,Hs)=>{var ze=Qr(),He=Wr(),St=Ls(),Gs=Fs(),Qs=Us();function wt(e){return function(r){return r===null?r:e(r)}}function Ws(e){return e===null?e:e==="TRUE"||e==="t"||e==="true"||e==="y"||e==="yes"||e==="on"||e==="1"}function Jd(e){return e?ze.parse(e,Ws):null}function Zd(e){return parseInt(e,10)}function Vr(e){return e?ze.parse(e,wt(Zd)):null}function ep(e){return e?ze.parse(e,wt(function(t){return zs(t).trim()})):null}var tp=function(e){if(!e)return null;var t=He.create(e,function(r){return r!==null&&(r=Jr(r)),r});return t.parse()},Yr=function(e){if(!e)return null;var t=He.create(e,function(r){return r!==null&&(r=parseFloat(r)),r});return t.parse()},k=function(e){if(!e)return null;var t=He.create(e);return t.parse()},Kr=function(e){if(!e)return null;var t=He.create(e,function(r){return r!==null&&(r=St(r)),r});return t.parse()},rp=function(e){if(!e)return null;var t=He.create(e,function(r){return r!==null&&(r=Gs(r)),r});return t.parse()},np=function(e){return e?ze.parse(e,wt(Qs)):null},Xr=function(e){return parseInt(e,10)},zs=function(e){var t=String(e);return/^\d+$/.test(t)?t:e},js=function(e){return e?ze.parse(e,wt(JSON.parse)):null},Jr=function(e){return e[0]!=="("?null:(e=e.substring(1,e.length-1).split(","),{x:parseFloat(e[0]),y:parseFloat(e[1])})},op=function(e){if(e[0]!=="<"&&e[1]!=="(")return null;for(var t="(",r="",n=!1,o=2;o<e.length-1;o++){if(n||(t+=e[o]),e[o]===")"){n=!0;continue}else if(!n)continue;e[o]!==","&&(r+=e[o])}var s=Jr(t);return s.radius=parseFloat(r),s},sp=function(e){e(20,zs),e(21,Xr),e(23,Xr),e(26,Xr),e(700,parseFloat),e(701,parseFloat),e(16,Ws),e(1082,St),e(1114,St),e(1184,St),e(600,Jr),e(651,k),e(718,op),e(1e3,Jd),e(1001,np),e(1005,Vr),e(1007,Vr),e(1028,Vr),e(1016,ep),e(1017,tp),e(1021,Yr),e(1022,Yr),e(1231,Yr),e(1014,k),e(1015,k),e(1008,k),e(1009,k),e(1040,k),e(1041,k),e(1115,Kr),e(1182,Kr),e(1185,Kr),e(1186,Gs),e(1187,rp),e(17,Qs),e(114,JSON.parse.bind(JSON)),e(3802,JSON.parse.bind(JSON)),e(199,js),e(3807,js),e(3907,k),e(2951,k),e(791,k),e(1183,k),e(1270,k)};Hs.exports={init:sp}});var Ks=m((xT,Ys)=>{"use strict";var M=1e6;function ip(e){var t=e.readInt32BE(0),r=e.readUInt32BE(4),n="";t<0&&(t=~t+(r===0),r=~r+1>>>0,n="-");var o="",s,i,a,c,l,u;{if(s=t%M,t=t/M>>>0,i=4294967296*s+r,r=i/M>>>0,a=""+(i-M*r),r===0&&t===0)return n+a+o;for(c="",l=6-a.length,u=0;u<l;u++)c+="0";o=c+a+o}{if(s=t%M,t=t/M>>>0,i=4294967296*s+r,r=i/M>>>0,a=""+(i-M*r),r===0&&t===0)return n+a+o;for(c="",l=6-a.length,u=0;u<l;u++)c+="0";o=c+a+o}{if(s=t%M,t=t/M>>>0,i=4294967296*s+r,r=i/M>>>0,a=""+(i-M*r),r===0&&t===0)return n+a+o;for(c="",l=6-a.length,u=0;u<l;u++)c+="0";o=c+a+o}return s=t%M,i=4294967296*s+r,a=""+i%M,n+a+o}Ys.exports=ip});var ti=m((TT,ei)=>{var ap=Ks(),T=function(e,t,r,n,o){r=r||0,n=n||!1,o=o||function(p,h,S){return p*Math.pow(2,S)+h};var s=r>>3,i=function(p){return n?~p&255:p},a=255,c=8-r%8;t<c&&(a=255<<8-t&255,c=t),r&&(a=a>>r%8);var l=0;r%8+t>=8&&(l=o(0,i(e[s])&a,c));for(var u=t+r>>3,f=s+1;f<u;f++)l=o(l,i(e[f]),8);var d=(t+r)%8;return d>0&&(l=o(l,i(e[u])>>8-d,d)),l},Zs=function(e,t,r){var n=Math.pow(2,r-1)-1,o=T(e,1),s=T(e,r,1);if(s===0)return 0;var i=1,a=function(l,u,f){l===0&&(l=1);for(var d=1;d<=f;d++)i/=2,(u&1<<f-d)>0&&(l+=i);return l},c=T(e,t,r+1,!1,a);return s==Math.pow(2,r+1)-1?c===0?o===0?1/0:-1/0:NaN:(o===0?1:-1)*Math.pow(2,s-n)*c},cp=function(e){return T(e,1)==1?-1*(T(e,15,1,!0)+1):T(e,15,1)},Xs=function(e){return T(e,1)==1?-1*(T(e,31,1,!0)+1):T(e,31,1)},lp=function(e){return Zs(e,23,8)},up=function(e){return Zs(e,52,11)},fp=function(e){var t=T(e,16,32);if(t==49152)return NaN;for(var r=Math.pow(1e4,T(e,16,16)),n=0,o=[],s=T(e,16),i=0;i<s;i++)n+=T(e,16,64+16*i)*r,r/=1e4;var a=Math.pow(10,T(e,16,48));return(t===0?1:-1)*Math.round(n*a)/a},Js=function(e,t){var r=T(t,1),n=T(t,63,1),o=new Date((r===0?1:-1)*n/1e3+9466848e5);return e||o.setTime(o.getTime()+o.getTimezoneOffset()*6e4),o.usec=n%1e3,o.getMicroSeconds=function(){return this.usec},o.setMicroSeconds=function(s){this.usec=s},o.getUTCMicroSeconds=function(){return this.usec},o},Ve=function(e){for(var t=T(e,32),r=T(e,32,32),n=T(e,32,64),o=96,s=[],i=0;i<t;i++)s[i]=T(e,32,o),o+=32,o+=32;var a=function(l){var u=T(e,32,o);if(o+=32,u==4294967295)return null;var f;if(l==23||l==20)return f=T(e,u*8,o),o+=u*8,f;if(l==25)return f=e.toString(this.encoding,o>>3,(o+=u<<3)>>3),f;console.log("ERROR: ElementType not implemented: "+l)},c=function(l,u){var f=[],d;if(l.length>1){var p=l.shift();for(d=0;d<p;d++)f[d]=c(l,u);l.unshift(p)}else for(d=0;d<l[0];d++)f[d]=a(u);return f};return c(s,n)},dp=function(e){return e.toString("utf8")},pp=function(e){return e===null?null:T(e,8)>0},hp=function(e){e(20,ap),e(21,cp),e(23,Xs),e(26,Xs),e(1700,fp),e(700,lp),e(701,up),e(16,pp),e(1114,Js.bind(null,!1)),e(1184,Js.bind(null,!0)),e(1e3,Ve),e(1007,Ve),e(1016,Ve),e(1008,Ve),e(1009,Ve),e(25,dp)};ei.exports={init:hp}});var ni=m((CT,ri)=>{ri.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var Xe=m(Ke=>{var mp=Vs(),gp=ti(),yp=Wr(),bp=ni();Ke.getTypeParser=Sp;Ke.setTypeParser=wp;Ke.arrayParser=yp;Ke.builtins=bp;var Ye={text:{},binary:{}};function oi(e){return String(e)}function Sp(e,t){return t=t||"text",Ye[t]&&Ye[t][e]||oi}function wp(e,t,r){typeof t=="function"&&(r=t,t="text"),Ye[t][e]=r}mp.init(function(e,t){Ye.text[e]=t});gp.init(function(e,t){Ye.binary[e]=t})});var Je=m((RT,Zr)=>{"use strict";Zr.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Ee=Xe(),Ep=Ee.getTypeParser(20,"text"),xp=Ee.getTypeParser(1016,"text");Zr.exports.__defineSetter__("parseInt8",function(e){Ee.setTypeParser(20,"text",e?Ee.getTypeParser(23,"text"):Ep),Ee.setTypeParser(1016,"text",e?Ee.getTypeParser(1007,"text"):xp)})});var xe=m((AT,ai)=>{"use strict";var Tp=Je(),si=w("util"),{isDate:Cp}=si.types||si;function _p(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function ii(e){let t="{";for(let r=0;r<e.length;r++)if(r>0&&(t=t+","),e[r]===null||typeof e[r]>"u")t=t+"NULL";else if(Array.isArray(e[r]))t=t+ii(e[r]);else if(ArrayBuffer.isView(e[r])){let n=e[r];if(!(n instanceof Buffer)){let o=Buffer.from(n.buffer,n.byteOffset,n.byteLength);o.length===n.byteLength?n=o:n=o.slice(n.byteOffset,n.byteOffset+n.byteLength)}t+="\\\\x"+n.toString("hex")}else t+=_p(Et(e[r]));return t=t+"}",t}var Et=function(e,t){if(e==null)return null;if(typeof e=="object"){if(e instanceof Buffer)return e;if(ArrayBuffer.isView(e)){let r=Buffer.from(e.buffer,e.byteOffset,e.byteLength);return r.length===e.byteLength?r:r.slice(e.byteOffset,e.byteOffset+e.byteLength)}return Cp(e)?Tp.parseInputDatesAsUTC?vp(e):Ap(e):Array.isArray(e)?ii(e):Rp(e,t)}return e.toString()};function Rp(e,t){if(e&&typeof e.toPostgres=="function"){if(t=t||[],t.indexOf(e)!==-1)throw new Error('circular reference detected while preparing "'+e+'" for query');return t.push(e),Et(e.toPostgres(Et),t)}return JSON.stringify(e)}function Ap(e){let t=-e.getTimezoneOffset(),r=e.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);let o=String(r).padStart(4,"0")+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")+"T"+String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")+":"+String(e.getSeconds()).padStart(2,"0")+"."+String(e.getMilliseconds()).padStart(3,"0");return t<0?(o+="-",t*=-1):o+="+",o+=String(Math.floor(t/60)).padStart(2,"0")+":"+String(t%60).padStart(2,"0"),n&&(o+=" BC"),o}function vp(e){let t=e.getUTCFullYear(),r=t<1;r&&(t=Math.abs(t)+1);let n=String(t).padStart(4,"0")+"-"+String(e.getUTCMonth()+1).padStart(2,"0")+"-"+String(e.getUTCDate()).padStart(2,"0")+"T"+String(e.getUTCHours()).padStart(2,"0")+":"+String(e.getUTCMinutes()).padStart(2,"0")+":"+String(e.getUTCSeconds()).padStart(2,"0")+"."+String(e.getUTCMilliseconds()).padStart(3,"0");return n+="+00:00",r&&(n+=" BC"),n}function Ip(e,t,r){return e=typeof e=="string"?{text:e}:e,t&&(typeof t=="function"?e.callback=t:e.values=t),r&&(e.callback=r),e}var Op=function(e){return'"'+e.replace(/"/g,'""')+'"'},Dp=function(e){let t=!1,r="'";if(e==null||typeof e!="string")return"''";for(let n=0;n<e.length;n++){let o=e[n];o==="'"?r+=o+o:o==="\\"?(r+=o+o,t=!0):r+=o}return r+="'",t===!0&&(r=" E"+r),r};ai.exports={prepareValue:function(t){return Et(t)},normalizeQueryConfig:Ip,escapeIdentifier:Op,escapeLiteral:Dp}});var li=m((vT,ci)=>{"use strict";var Te=w("crypto");function en(e){return Te.createHash("md5").update(e,"utf-8").digest("hex")}function Mp(e,t,r){let n=en(t+e);return"md5"+en(Buffer.concat([Buffer.from(n),r]))}function Pp(e){return Te.createHash("sha256").update(e).digest()}function Lp(e,t){return e=e.replace(/(\D)-/,"$1"),Te.createHash(e).update(t).digest()}function kp(e,t){return Te.createHmac("sha256",e).update(t).digest()}async function $p(e,t,r){return Te.pbkdf2Sync(e,t,r,32,"sha256")}ci.exports={postgresMd5PasswordHash:Mp,randomBytes:Te.randomBytes,deriveKey:$p,sha256:Pp,hashByName:Lp,hmacSha256:kp,md5:en}});var pi=m((IT,di)=>{var ui=w("crypto");di.exports={postgresMd5PasswordHash:Np,randomBytes:Bp,deriveKey:jp,sha256:Fp,hashByName:qp,hmacSha256:Up,md5:tn};var fi=ui.webcrypto||globalThis.crypto,fe=fi.subtle,rn=new TextEncoder;function Bp(e){return fi.getRandomValues(Buffer.alloc(e))}async function tn(e){try{return ui.createHash("md5").update(e,"utf-8").digest("hex")}catch{let r=typeof e=="string"?rn.encode(e):e,n=await fe.digest("MD5",r);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}}async function Np(e,t,r){let n=await tn(t+e);return"md5"+await tn(Buffer.concat([Buffer.from(n),r]))}async function Fp(e){return await fe.digest("SHA-256",e)}async function qp(e,t){return await fe.digest(e,t)}async function Up(e,t){let r=await fe.importKey("raw",e,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await fe.sign("HMAC",r,rn.encode(t))}async function jp(e,t,r){let n=await fe.importKey("raw",rn.encode(e),"PBKDF2",!1,["deriveBits"]),o={name:"PBKDF2",hash:"SHA-256",salt:t,iterations:r};return await fe.deriveBits(o,n,32*8,["deriveBits"])}});var on=m((OT,nn)=>{"use strict";var Gp=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Gp?nn.exports=li():nn.exports=pi()});var gi=m((DT,mi)=>{function de(e,t){return new Error("SASL channel binding: "+e+" when parsing public certificate "+t.toString("base64"))}function sn(e,t){let r=e[t++];if(r<128)return{length:r,index:t};let n=r&127;if(n>4)throw de("bad length",e);r=0;for(let o=0;o<n;o++)r=r<<8|e[t++];return{length:r,index:t}}function hi(e,t){if(e[t++]!==6)throw de("non-OID data",e);let{length:r,index:n}=sn(e,t);t=n;let o=t+r,s=e[t++],i=(s/40>>0)+"."+s%40;for(;t<o;){let a=0;for(;t<o;){let c=e[t++];if(a=a<<7|c&127,c<128)break}i+="."+a}return{oid:i,index:t}}function Ze(e,t){if(e[t++]!==48)throw de("non-sequence data",e);return sn(e,t)}function Qp(e,t){t===void 0&&(t=0),t=Ze(e,t).index;let{length:r,index:n}=Ze(e,t);t=n+r,t=Ze(e,t).index;let{oid:o,index:s}=hi(e,t);switch(o){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(t=s,t=Ze(e,t).index,e[t++]!==160)throw de("non-tag data",e);t=sn(e,t).index,t=Ze(e,t).index;let{oid:i}=hi(e,t);switch(i){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw de("unknown hash OID "+i,e)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw de("Ed448 certificate channel binding is not currently supported by Postgres")}throw de("unknown OID "+o,e)}mi.exports={signatureAlgorithmHashFromCertificate:Qp}});var wi=m((MT,Si)=>{"use strict";var ne=on(),{signatureAlgorithmHashFromCertificate:Wp}=gi();function zp(e,t){let r=["SCRAM-SHA-256"];t&&r.unshift("SCRAM-SHA-256-PLUS");let n=r.find(i=>e.includes(i));if(!n)throw new Error("SASL: Only mechanism(s) "+r.join(" and ")+" are supported");if(n==="SCRAM-SHA-256-PLUS"&&typeof t.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");let o=ne.randomBytes(18).toString("base64");return{mechanism:n,clientNonce:o,response:(n==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":t?"y":"n")+",,n=*,r="+o,message:"SASLInitialResponse"}}async function Hp(e,t,r,n){if(e.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(t==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let o=Kp(r);if(o.nonce.startsWith(e.clientNonce)){if(o.nonce.length===e.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");let s="n=*,r="+e.clientNonce,i="r="+o.nonce+",s="+o.salt+",i="+o.iteration,a=n?"eSws":"biws";if(e.mechanism==="SCRAM-SHA-256-PLUS"){let _=n.getPeerCertificate().raw,A=Wp(_);(A==="MD5"||A==="SHA-1")&&(A="SHA-256");let D=await ne.hashByName(A,_);a=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(D)]).toString("base64")}let c="c="+a+",r="+o.nonce,l=s+","+i+","+c,u=Buffer.from(o.salt,"base64"),f=await ne.deriveKey(t,u,o.iteration),d=await ne.hmacSha256(f,"Client Key"),p=await ne.sha256(d),h=await ne.hmacSha256(p,l),S=Jp(Buffer.from(d),Buffer.from(h)).toString("base64"),y=await ne.hmacSha256(f,"Server Key"),E=await ne.hmacSha256(y,l);e.message="SASLResponse",e.serverSignature=Buffer.from(E).toString("base64"),e.response=c+",p="+S}function Vp(e,t){if(e.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=Xp(t);if(r!==e.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function Yp(e){if(typeof e!="string")throw new TypeError("SASL: text must be a string");return e.split("").map((t,r)=>e.charCodeAt(r)).every(t=>t>=33&&t<=43||t>=45&&t<=126)}function yi(e){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(e)}function bi(e){if(typeof e!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(e.split(",").map(t=>{if(!/^.=/.test(t))throw new Error("SASL: Invalid attribute pair entry");let r=t[0],n=t.substring(2);return[r,n]}))}function Kp(e){let t=bi(e),r=t.get("r");if(r){if(!Yp(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=t.get("s");if(n){if(!yi(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let o=t.get("i");if(o){if(!/^[1-9][0-9]*$/.test(o))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let s=parseInt(o,10);return{nonce:r,salt:n,iteration:s}}function Xp(e){let r=bi(e).get("v");if(r){if(!yi(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}function Jp(e,t){if(!Buffer.isBuffer(e))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(t))throw new TypeError("second argument must be a Buffer");if(e.length!==t.length)throw new Error("Buffer lengths must match");if(e.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(e.map((r,n)=>e[n]^t[n]))}Si.exports={startSession:zp,continueSession:Hp,finalizeSession:Vp}});var Tt=m((PT,Ei)=>{"use strict";var Zp=Xe();function xt(e){this._types=e||Zp,this.text={},this.binary={}}xt.prototype.getOverrides=function(e){switch(e){case"text":return this.text;case"binary":return this.binary;default:return{}}};xt.prototype.setTypeParser=function(e,t,r){typeof t=="function"&&(r=t,t="text"),this.getOverrides(t)[e]=r};xt.prototype.getTypeParser=function(e,t){return t=t||"text",this.getOverrides(t)[e]||this._types.getTypeParser(e,t)};Ei.exports=xt});var Ci=m((LT,Ti)=>{"use strict";function Ce(e,t={}){if(e.charAt(0)==="/"){let c=e.split(" ");return{host:c[0],database:c[1]}}let r={},n,o=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(e)&&(e=encodeURI(e).replace(/%25(\d\d)/g,"%$1"));try{try{n=new URL(e,"postgres://base")}catch{n=new URL(e.replace("@/","@___DUMMY___/"),"postgres://base"),o=!0}}catch(c){c.input&&(c.input="*****REDACTED*****")}for(let c of n.searchParams.entries())r[c[0]]=c[1];if(r.user=r.user||decodeURIComponent(n.username),r.password=r.password||decodeURIComponent(n.password),n.protocol=="socket:")return r.host=decodeURI(n.pathname),r.database=n.searchParams.get("db"),r.client_encoding=n.searchParams.get("encoding"),r;let s=o?"":n.hostname;r.host?s&&/^%2f/i.test(s)&&(n.pathname=s+n.pathname):r.host=decodeURIComponent(s),r.port||(r.port=n.port);let i=n.pathname.slice(1)||null;r.database=i?decodeURI(i):null,(r.ssl==="true"||r.ssl==="1")&&(r.ssl=!0),r.ssl==="0"&&(r.ssl=!1),(r.sslcert||r.sslkey||r.sslrootcert||r.sslmode)&&(r.ssl={});let a=r.sslcert||r.sslkey||r.sslrootcert?w("fs"):null;if(r.sslcert&&(r.ssl.cert=a.readFileSync(r.sslcert).toString()),r.sslkey&&(r.ssl.key=a.readFileSync(r.sslkey).toString()),r.sslrootcert&&(r.ssl.ca=a.readFileSync(r.sslrootcert).toString()),t.useLibpqCompat&&r.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(r.uselibpqcompat==="true"||t.useLibpqCompat)switch(r.sslmode){case"disable":{r.ssl=!1;break}case"prefer":{r.ssl.rejectUnauthorized=!1;break}case"require":{r.sslrootcert?r.ssl.checkServerIdentity=function(){}:r.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!r.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");r.ssl.checkServerIdentity=function(){};break}case"verify-full":break}else switch(r.sslmode){case"disable":{r.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{r.ssl.rejectUnauthorized=!1;break}}return r}function eh(e){return Object.entries(e).reduce((r,[n,o])=>(o!=null&&(r[n]=o),r),{})}function xi(e){return Object.entries(e).reduce((r,[n,o])=>{if(n==="ssl"){let s=o;typeof s=="boolean"&&(r[n]=s),typeof s=="object"&&(r[n]=eh(s))}else if(o!=null)if(n==="port"){if(o!==""){let s=parseInt(o,10);if(isNaN(s))throw new Error(`Invalid ${n}: ${o}`);r[n]=s}}else r[n]=o;return r},{})}function th(e){return xi(Ce(e))}Ti.exports=Ce;Ce.parse=Ce;Ce.toClientConfig=xi;Ce.parseIntoClientConfig=th});var cn=m((kT,Ai)=>{"use strict";var rh=w("dns"),Ri=Je(),_i=Ci().parse,O=function(e,t,r){return r===void 0?r=process.env["PG"+e.toUpperCase()]:r===!1||(r=process.env[r]),t[e]||r||Ri[e]},nh=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Ri.ssl},_e=function(e){return"'"+(""+e).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},$=function(e,t,r){let n=t[r];n!=null&&e.push(r+"="+_e(n))},an=class{constructor(t){t=typeof t=="string"?_i(t):t||{},t.connectionString&&(t=Object.assign({},t,_i(t.connectionString))),this.user=O("user",t),this.database=O("database",t),this.database===void 0&&(this.database=this.user),this.port=parseInt(O("port",t),10),this.host=O("host",t),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:O("password",t)}),this.binary=O("binary",t),this.options=O("options",t),this.ssl=typeof t.ssl>"u"?nh():t.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=O("client_encoding",t),this.replication=O("replication",t),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=O("application_name",t,"PGAPPNAME"),this.fallback_application_name=O("fallback_application_name",t,!1),this.statement_timeout=O("statement_timeout",t,!1),this.lock_timeout=O("lock_timeout",t,!1),this.idle_in_transaction_session_timeout=O("idle_in_transaction_session_timeout",t,!1),this.query_timeout=O("query_timeout",t,!1),t.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(t.connectionTimeoutMillis/1e3),t.keepAlive===!1?this.keepalives=0:t.keepAlive===!0&&(this.keepalives=1),typeof t.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(t.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(t){let r=[];$(r,this,"user"),$(r,this,"password"),$(r,this,"port"),$(r,this,"application_name"),$(r,this,"fallback_application_name"),$(r,this,"connect_timeout"),$(r,this,"options");let n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if($(r,n,"sslmode"),$(r,n,"sslca"),$(r,n,"sslkey"),$(r,n,"sslcert"),$(r,n,"sslrootcert"),this.database&&r.push("dbname="+_e(this.database)),this.replication&&r.push("replication="+_e(this.replication)),this.host&&r.push("host="+_e(this.host)),this.isDomainSocket)return t(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+_e(this.client_encoding)),rh.lookup(this.host,function(o,s){return o?t(o,null):(r.push("hostaddr="+_e(s)),t(null,r.join(" ")))})}};Ai.exports=an});var un=m(($T,Ii)=>{"use strict";var oh=Xe(),vi=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,ln=class{constructor(t,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=t==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(t){let r;t.text?r=vi.exec(t.text):r=vi.exec(t.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(t){let r=new Array(t.length);for(let n=0,o=t.length;n<o;n++){let s=t[n];s!==null?r[n]=this._parsers[n](s):r[n]=null}return r}parseRow(t){let r={...this._prebuiltEmptyResultObject};for(let n=0,o=t.length;n<o;n++){let s=t[n],i=this.fields[n].name;if(s!==null){let a=this.fields[n].format==="binary"?Buffer.from(s):s;r[i]=this._parsers[n](a)}else r[i]=null}return r}addRow(t){this.rows.push(t)}addFields(t){this.fields=t,this.fields.length&&(this._parsers=new Array(t.length));let r={};for(let n=0;n<t.length;n++){let o=t[n];r[o.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(o.dataTypeID,o.format||"text"):this._parsers[n]=oh.getTypeParser(o.dataTypeID,o.format||"text")}this._prebuiltEmptyResultObject={...r}}};Ii.exports=ln});var Pi=m((BT,Mi)=>{"use strict";var{EventEmitter:sh}=w("events"),Oi=un(),Di=xe(),fn=class extends sh{constructor(t,r,n){super(),t=Di.normalizeQueryConfig(t,r,n),this.text=t.text,this.values=t.values,this.rows=t.rows,this.types=t.types,this.name=t.name,this.queryMode=t.queryMode,this.binary=t.binary,this.portal=t.portal||"",this.callback=t.callback,this._rowMode=t.rowMode,process.domain&&t.callback&&(this.callback=process.domain.bind(t.callback)),this._result=new Oi(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Oi(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(t){this._checkForMultirow(),this._result.addFields(t.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(t){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(t.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(t,r){this._checkForMultirow(),this._result.addCommandComplete(t),this.rows&&r.sync()}handleEmptyQuery(t){this.rows&&t.sync()}handleError(t,r){if(this._canceledDueToError&&(t=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(t);this.emit("error",t)}handleReadyForQuery(t){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,t);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(t){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=t.parsedStatements[this.name];if(this.text&&r&&this.text!==r)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){t.stream.cork&&t.stream.cork();try{this.prepare(t)}finally{t.stream.uncork&&t.stream.uncork()}}else t.query(this.text);return null}hasBeenParsed(t){return this.name&&t.parsedStatements[this.name]}handlePortalSuspended(t){this._getRows(t,this.rows)}_getRows(t,r){t.execute({portal:this.portal,rows:r}),r?t.flush():t.sync()}prepare(t){this.hasBeenParsed(t)||t.parse({text:this.text,name:this.name,types:this.types});try{t.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Di.prepareValue})}catch(r){this.handleError(r,t);return}t.describe({type:"P",name:this.portal||""}),this._getRows(t,this.rows)}handleCopyInResponse(t){t.sendCopyFail("No source stream defined")}handleCopyData(t,r){}};Mi.exports=fn});var Rn=m(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.NoticeMessage=g.DataRowMessage=g.CommandCompleteMessage=g.ReadyForQueryMessage=g.NotificationResponseMessage=g.BackendKeyDataMessage=g.AuthenticationMD5Password=g.ParameterStatusMessage=g.ParameterDescriptionMessage=g.RowDescriptionMessage=g.Field=g.CopyResponse=g.CopyDataMessage=g.DatabaseError=g.copyDone=g.emptyQuery=g.replicationStart=g.portalSuspended=g.noData=g.closeComplete=g.bindComplete=g.parseComplete=void 0;g.parseComplete={name:"parseComplete",length:5};g.bindComplete={name:"bindComplete",length:5};g.closeComplete={name:"closeComplete",length:5};g.noData={name:"noData",length:5};g.portalSuspended={name:"portalSuspended",length:5};g.replicationStart={name:"replicationStart",length:4};g.emptyQuery={name:"emptyQuery",length:4};g.copyDone={name:"copyDone",length:4};var dn=class extends Error{constructor(t,r,n){super(t),this.length=r,this.name=n}};g.DatabaseError=dn;var pn=class{constructor(t,r){this.length=t,this.chunk=r,this.name="copyData"}};g.CopyDataMessage=pn;var hn=class{constructor(t,r,n,o){this.length=t,this.name=r,this.binary=n,this.columnTypes=new Array(o)}};g.CopyResponse=hn;var mn=class{constructor(t,r,n,o,s,i,a){this.name=t,this.tableID=r,this.columnID=n,this.dataTypeID=o,this.dataTypeSize=s,this.dataTypeModifier=i,this.format=a}};g.Field=mn;var gn=class{constructor(t,r){this.length=t,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};g.RowDescriptionMessage=gn;var yn=class{constructor(t,r){this.length=t,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};g.ParameterDescriptionMessage=yn;var bn=class{constructor(t,r,n){this.length=t,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};g.ParameterStatusMessage=bn;var Sn=class{constructor(t,r){this.length=t,this.salt=r,this.name="authenticationMD5Password"}};g.AuthenticationMD5Password=Sn;var wn=class{constructor(t,r,n){this.length=t,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};g.BackendKeyDataMessage=wn;var En=class{constructor(t,r,n,o){this.length=t,this.processId=r,this.channel=n,this.payload=o,this.name="notification"}};g.NotificationResponseMessage=En;var xn=class{constructor(t,r){this.length=t,this.status=r,this.name="readyForQuery"}};g.ReadyForQueryMessage=xn;var Tn=class{constructor(t,r){this.length=t,this.text=r,this.name="commandComplete"}};g.CommandCompleteMessage=Tn;var Cn=class{constructor(t,r){this.length=t,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};g.DataRowMessage=Cn;var _n=class{constructor(t,r){this.length=t,this.message=r,this.name="notice"}};g.NoticeMessage=_n});var Li=m(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.Writer=void 0;var An=class{constructor(t=256){this.size=t,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(t)}ensure(t){if(this.buffer.length-this.offset<t){let n=this.buffer,o=n.length+(n.length>>1)+t;this.buffer=Buffer.allocUnsafe(o),n.copy(this.buffer)}}addInt32(t){return this.ensure(4),this.buffer[this.offset++]=t>>>24&255,this.buffer[this.offset++]=t>>>16&255,this.buffer[this.offset++]=t>>>8&255,this.buffer[this.offset++]=t>>>0&255,this}addInt16(t){return this.ensure(2),this.buffer[this.offset++]=t>>>8&255,this.buffer[this.offset++]=t>>>0&255,this}addCString(t){if(!t)this.ensure(1);else{let r=Buffer.byteLength(t);this.ensure(r+1),this.buffer.write(t,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(t=""){let r=Buffer.byteLength(t);return this.ensure(r),this.buffer.write(t,this.offset),this.offset+=r,this}add(t){return this.ensure(t.length),t.copy(this.buffer,this.offset),this.offset+=t.length,this}join(t){if(t){this.buffer[this.headerPosition]=t;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(t?0:5,this.offset)}flush(t){let r=this.join(t);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};Ct.Writer=An});var $i=m(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.serialize=void 0;var vn=Li(),x=new vn.Writer,ih=e=>{x.addInt16(3).addInt16(0);for(let n of Object.keys(e))x.addCString(n).addCString(e[n]);x.addCString("client_encoding").addCString("UTF8");let t=x.addCString("").flush(),r=t.length+4;return new vn.Writer().addInt32(r).add(t).flush()},ah=()=>{let e=Buffer.allocUnsafe(8);return e.writeInt32BE(8,0),e.writeInt32BE(80877103,4),e},ch=e=>x.addCString(e).flush(112),lh=function(e,t){return x.addCString(e).addInt32(Buffer.byteLength(t)).addString(t),x.flush(112)},uh=function(e){return x.addString(e).flush(112)},fh=e=>x.addCString(e).flush(81),ki=[],dh=e=>{let t=e.name||"";t.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",t,t.length),console.error("This can cause conflicts and silent errors executing queries"));let r=e.types||ki,n=r.length,o=x.addCString(t).addCString(e.text).addInt16(n);for(let s=0;s<n;s++)o.addInt32(r[s]);return x.flush(80)},Re=new vn.Writer,ph=function(e,t){for(let r=0;r<e.length;r++){let n=t?t(e[r],r):e[r];n==null?(x.addInt16(0),Re.addInt32(-1)):n instanceof Buffer?(x.addInt16(1),Re.addInt32(n.length),Re.add(n)):(x.addInt16(0),Re.addInt32(Buffer.byteLength(n)),Re.addString(n))}},hh=(e={})=>{let t=e.portal||"",r=e.statement||"",n=e.binary||!1,o=e.values||ki,s=o.length;return x.addCString(t).addCString(r),x.addInt16(s),ph(o,e.valueMapper),x.addInt16(s),x.add(Re.flush()),x.addInt16(1),x.addInt16(n?1:0),x.flush(66)},mh=Buffer.from([69,0,0,0,9,0,0,0,0,0]),gh=e=>{if(!e||!e.portal&&!e.rows)return mh;let t=e.portal||"",r=e.rows||0,n=Buffer.byteLength(t),o=4+n+1+4,s=Buffer.allocUnsafe(1+o);return s[0]=69,s.writeInt32BE(o,1),s.write(t,5,"utf-8"),s[n+5]=0,s.writeUInt32BE(r,s.length-4),s},yh=(e,t)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(e,8),r.writeInt32BE(t,12),r},In=(e,t)=>{let n=4+Buffer.byteLength(t)+1,o=Buffer.allocUnsafe(1+n);return o[0]=e,o.writeInt32BE(n,1),o.write(t,5,"utf-8"),o[n]=0,o},bh=x.addCString("P").flush(68),Sh=x.addCString("S").flush(68),wh=e=>e.name?In(68,`${e.type}${e.name||""}`):e.type==="P"?bh:Sh,Eh=e=>{let t=`${e.type}${e.name||""}`;return In(67,t)},xh=e=>x.add(e).flush(100),Th=e=>In(102,e),_t=e=>Buffer.from([e,0,0,0,4]),Ch=_t(72),_h=_t(83),Rh=_t(88),Ah=_t(99),vh={startup:ih,password:ch,requestSsl:ah,sendSASLInitialResponseMessage:lh,sendSCRAMClientFinalMessage:uh,query:fh,parse:dh,bind:hh,execute:gh,describe:wh,close:Eh,flush:()=>Ch,sync:()=>_h,end:()=>Rh,copyData:xh,copyDone:()=>Ah,copyFail:Th,cancel:yh};Rt.serialize=vh});var Bi=m(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.BufferReader=void 0;var Ih=Buffer.allocUnsafe(0),On=class{constructor(t=0){this.offset=t,this.buffer=Ih,this.encoding="utf-8"}setBuffer(t,r){this.offset=t,this.buffer=r}int16(){let t=this.buffer.readInt16BE(this.offset);return this.offset+=2,t}byte(){let t=this.buffer[this.offset];return this.offset++,t}int32(){let t=this.buffer.readInt32BE(this.offset);return this.offset+=4,t}uint32(){let t=this.buffer.readUInt32BE(this.offset);return this.offset+=4,t}string(t){let r=this.buffer.toString(this.encoding,this.offset,this.offset+t);return this.offset+=t,r}cstring(){let t=this.offset,r=t;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,t,r-1)}bytes(t){let r=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,r}};At.BufferReader=On});var qi=m(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.Parser=void 0;var C=Rn(),Oh=Bi(),Dn=1,Dh=4,Ni=Dn+Dh,Fi=Buffer.allocUnsafe(0),Mn=class{constructor(t){if(this.buffer=Fi,this.bufferLength=0,this.bufferOffset=0,this.reader=new Oh.BufferReader,t?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=t?.mode||"text"}parse(t,r){this.mergeBuffer(t);let n=this.bufferOffset+this.bufferLength,o=this.bufferOffset;for(;o+Ni<=n;){let s=this.buffer[o],i=this.buffer.readUInt32BE(o+Dn),a=Dn+i;if(a+o<=n){let c=this.handlePacket(o+Ni,s,i,this.buffer);r(c),o+=a}else break}o===n?(this.buffer=Fi,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-o,this.bufferOffset=o)}mergeBuffer(t){if(this.bufferLength>0){let r=this.bufferLength+t.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let o;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)o=this.buffer;else{let s=this.buffer.byteLength*2;for(;r>=s;)s*=2;o=Buffer.allocUnsafe(s)}this.buffer.copy(o,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=o,this.bufferOffset=0}t.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=t,this.bufferOffset=0,this.bufferLength=t.byteLength}handlePacket(t,r,n,o){switch(r){case 50:return C.bindComplete;case 49:return C.parseComplete;case 51:return C.closeComplete;case 110:return C.noData;case 115:return C.portalSuspended;case 99:return C.copyDone;case 87:return C.replicationStart;case 73:return C.emptyQuery;case 68:return this.parseDataRowMessage(t,n,o);case 67:return this.parseCommandCompleteMessage(t,n,o);case 90:return this.parseReadyForQueryMessage(t,n,o);case 65:return this.parseNotificationMessage(t,n,o);case 82:return this.parseAuthenticationResponse(t,n,o);case 83:return this.parseParameterStatusMessage(t,n,o);case 75:return this.parseBackendKeyData(t,n,o);case 69:return this.parseErrorMessage(t,n,o,"error");case 78:return this.parseErrorMessage(t,n,o,"notice");case 84:return this.parseRowDescriptionMessage(t,n,o);case 116:return this.parseParameterDescriptionMessage(t,n,o);case 71:return this.parseCopyInMessage(t,n,o);case 72:return this.parseCopyOutMessage(t,n,o);case 100:return this.parseCopyData(t,n,o);default:return new C.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.string(1);return new C.ReadyForQueryMessage(r,o)}parseCommandCompleteMessage(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.cstring();return new C.CommandCompleteMessage(r,o)}parseCopyData(t,r,n){let o=n.slice(t,t+(r-4));return new C.CopyDataMessage(r,o)}parseCopyInMessage(t,r,n){return this.parseCopyMessage(t,r,n,"copyInResponse")}parseCopyOutMessage(t,r,n){return this.parseCopyMessage(t,r,n,"copyOutResponse")}parseCopyMessage(t,r,n,o){this.reader.setBuffer(t,n);let s=this.reader.byte()!==0,i=this.reader.int16(),a=new C.CopyResponse(r,o,s,i);for(let c=0;c<i;c++)a.columnTypes[c]=this.reader.int16();return a}parseNotificationMessage(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.int32(),s=this.reader.cstring(),i=this.reader.cstring();return new C.NotificationResponseMessage(r,o,s,i)}parseRowDescriptionMessage(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.int16(),s=new C.RowDescriptionMessage(r,o);for(let i=0;i<o;i++)s.fields[i]=this.parseField();return s}parseField(){let t=this.reader.cstring(),r=this.reader.uint32(),n=this.reader.int16(),o=this.reader.uint32(),s=this.reader.int16(),i=this.reader.int32(),a=this.reader.int16()===0?"text":"binary";return new C.Field(t,r,n,o,s,i,a)}parseParameterDescriptionMessage(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.int16(),s=new C.ParameterDescriptionMessage(r,o);for(let i=0;i<o;i++)s.dataTypeIDs[i]=this.reader.int32();return s}parseDataRowMessage(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.int16(),s=new Array(o);for(let i=0;i<o;i++){let a=this.reader.int32();s[i]=a===-1?null:this.reader.string(a)}return new C.DataRowMessage(r,s)}parseParameterStatusMessage(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.cstring(),s=this.reader.cstring();return new C.ParameterStatusMessage(r,o,s)}parseBackendKeyData(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.int32(),s=this.reader.int32();return new C.BackendKeyDataMessage(r,o,s)}parseAuthenticationResponse(t,r,n){this.reader.setBuffer(t,n);let o=this.reader.int32(),s={name:"authenticationOk",length:r};switch(o){case 0:break;case 3:s.length===8&&(s.name="authenticationCleartextPassword");break;case 5:if(s.length===12){s.name="authenticationMD5Password";let i=this.reader.bytes(4);return new C.AuthenticationMD5Password(r,i)}break;case 10:{s.name="authenticationSASL",s.mechanisms=[];let i;do i=this.reader.cstring(),i&&s.mechanisms.push(i);while(i)}break;case 11:s.name="authenticationSASLContinue",s.data=this.reader.string(r-8);break;case 12:s.name="authenticationSASLFinal",s.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+o)}return s}parseErrorMessage(t,r,n,o){this.reader.setBuffer(t,n);let s={},i=this.reader.string(1);for(;i!=="\0";)s[i]=this.reader.cstring(),i=this.reader.string(1);let a=s.M,c=o==="notice"?new C.NoticeMessage(r,a):new C.DatabaseError(a,r,o);return c.severity=s.S,c.code=s.C,c.detail=s.D,c.hint=s.H,c.position=s.P,c.internalPosition=s.p,c.internalQuery=s.q,c.where=s.W,c.schema=s.s,c.table=s.t,c.column=s.c,c.dataType=s.d,c.constraint=s.n,c.file=s.F,c.line=s.L,c.routine=s.R,c}};vt.Parser=Mn});var Pn=m(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.DatabaseError=oe.serialize=oe.parse=void 0;var Mh=Rn();Object.defineProperty(oe,"DatabaseError",{enumerable:!0,get:function(){return Mh.DatabaseError}});var Ph=$i();Object.defineProperty(oe,"serialize",{enumerable:!0,get:function(){return Ph.serialize}});var Lh=qi();function kh(e,t){let r=new Lh.Parser;return e.on("data",n=>r.parse(n,t)),new Promise(n=>e.on("end",()=>n()))}oe.parse=kh});var Ui=m(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.default={}});var Gi=m((WT,ji)=>{var{getStream:$h,getSecureStream:Bh}=Uh();ji.exports={getStream:$h,getSecureStream:Bh};function Nh(){function e(r){let n=w("net");return new n.Socket}function t(r){return w("tls").connect(r)}return{getStream:e,getSecureStream:t}}function Fh(){function e(r){let{CloudflareSocket:n}=Ui();return new n(r)}function t(r){return r.socket.startTls(r),r.socket}return{getStream:e,getSecureStream:t}}function qh(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){let e=new Response(null,{cf:{thing:!0}});if(typeof e.cf=="object"&&e.cf!==null&&e.cf.thing)return!0}return!1}function Uh(){return qh()?Fh():Nh()}});var $n=m((zT,Qi)=>{"use strict";var jh=w("events").EventEmitter,{parse:Gh,serialize:I}=Pn(),{getStream:Qh,getSecureStream:Wh}=Gi(),zh=I.flush(),Hh=I.sync(),Vh=I.end(),kn=class extends jh{constructor(t){super(),t=t||{},this.stream=t.stream||Qh(t.ssl),typeof this.stream=="function"&&(this.stream=this.stream(t)),this._keepAlive=t.keepAlive,this._keepAliveInitialDelayMillis=t.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=t.ssl||!1,this._ending=!1,this._emitMessage=!1;let r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(t,r){let n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(t,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let o=function(s){n._ending&&(s.code==="ECONNRESET"||s.code==="EPIPE")||n.emit("error",s)};if(this.stream.on("error",o),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(s){switch(s.toString("utf8")){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let a={socket:n.stream};n.ssl!==!0&&(Object.assign(a,n.ssl),"key"in n.ssl&&(a.key=n.ssl.key));let c=w("net");c.isIP&&c.isIP(r)===0&&(a.servername=r);try{n.stream=Wh(a)}catch(l){return n.emit("error",l)}n.attachListeners(n.stream),n.stream.on("error",o),n.emit("sslconnect")})}attachListeners(t){Gh(t,r=>{let n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(I.requestSsl())}startup(t){this.stream.write(I.startup(t))}cancel(t,r){this._send(I.cancel(t,r))}password(t){this._send(I.password(t))}sendSASLInitialResponseMessage(t,r){this._send(I.sendSASLInitialResponseMessage(t,r))}sendSCRAMClientFinalMessage(t){this._send(I.sendSCRAMClientFinalMessage(t))}_send(t){return this.stream.writable?this.stream.write(t):!1}query(t){this._send(I.query(t))}parse(t){this._send(I.parse(t))}bind(t){this._send(I.bind(t))}execute(t){this._send(I.execute(t))}flush(){this.stream.writable&&this.stream.write(zh)}sync(){this._ending=!0,this._send(Hh)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(Vh,()=>{this.stream.end()})}close(t){this._send(I.close(t))}describe(t){this._send(I.describe(t))}sendCopyFromChunk(t){this._send(I.copyData(t))}endCopyFrom(){this._send(I.copyDone())}sendCopyFail(t){this._send(I.copyFail(t))}};Qi.exports=kn});var Vi=m((HT,Hi)=>{"use strict";var{Transform:Yh}=w("stream"),{StringDecoder:Kh}=w("string_decoder"),se=Symbol("last"),It=Symbol("decoder");function Xh(e,t,r){let n;if(this.overflow){if(n=this[It].write(e).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[se]+=this[It].write(e),n=this[se].split(this.matcher);this[se]=n.pop();for(let o=0;o<n.length;o++)try{zi(this,this.mapper(n[o]))}catch(s){return r(s)}if(this.overflow=this[se].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}function Jh(e){if(this[se]+=this[It].end(),this[se])try{zi(this,this.mapper(this[se]))}catch(t){return e(t)}e()}function zi(e,t){t!==void 0&&e.push(t)}function Wi(e){return e}function Zh(e,t,r){switch(e=e||/\r?\n/,t=t||Wi,r=r||{},arguments.length){case 1:typeof e=="function"?(t=e,e=/\r?\n/):typeof e=="object"&&!(e instanceof RegExp)&&!e[Symbol.split]&&(r=e,e=/\r?\n/);break;case 2:typeof e=="function"?(r=t,t=e,e=/\r?\n/):typeof t=="object"&&(r=t,t=Wi)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=Xh,r.flush=Jh,r.readableObjectMode=!0;let n=new Yh(r);return n[se]="",n[It]=new Kh("utf8"),n.matcher=e,n.mapper=t,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(o,s){this._writableState.errorEmitted=!1,s(o)},n}Hi.exports=Zh});var Xi=m((VT,K)=>{"use strict";var Yi=w("path"),em=w("stream").Stream,tm=Vi(),Ki=w("util"),rm=5432,Ot=process.platform==="win32",et=process.stderr,nm=56,om=7,sm=61440,im=32768;function am(e){return(e&sm)==im}var Ae=["host","port","database","user","password"],Bn=Ae.length,cm=Ae[Bn-1];function Nn(){var e=et instanceof em&&et.writable===!0;if(e){var t=Array.prototype.slice.call(arguments).concat(`
`);et.write(Ki.format.apply(Ki,t))}}Object.defineProperty(K.exports,"isWin",{get:function(){return Ot},set:function(e){Ot=e}});K.exports.warnTo=function(e){var t=et;return et=e,t};K.exports.getFileName=function(e){var t=e||process.env,r=t.PGPASSFILE||(Ot?Yi.join(t.APPDATA||"./","postgresql","pgpass.conf"):Yi.join(t.HOME||"./",".pgpass"));return r};K.exports.usePgPass=function(e,t){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Ot?!0:(t=t||"<unkn>",am(e.mode)?e.mode&(nm|om)?(Nn('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',t),!1):!0:(Nn('WARNING: password file "%s" is not a plain file',t),!1))};var lm=K.exports.match=function(e,t){return Ae.slice(0,-1).reduce(function(r,n,o){return o==1&&Number(e[n]||rm)===Number(t[n])?r&&!0:r&&(t[n]==="*"||t[n]===e[n])},!0)};K.exports.getPassword=function(e,t,r){var n,o=t.pipe(tm());function s(c){var l=um(c);l&&fm(l)&&lm(e,l)&&(n=l[cm],o.end())}var i=function(){t.destroy(),r(n)},a=function(c){t.destroy(),Nn("WARNING: error on reading file: %s",c),r(void 0)};t.on("error",a),o.on("data",s).on("end",i).on("error",a)};var um=K.exports.parseLine=function(e){if(e.length<11||e.match(/^\s+#/))return null;for(var t="",r="",n=0,o=0,s=0,i={},a=!1,c=function(u,f,d){var p=e.substring(f,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(p=p.replace(/\\([:\\])/g,"$1")),i[Ae[u]]=p},l=0;l<e.length-1;l+=1){if(t=e.charAt(l+1),r=e.charAt(l),a=n==Bn-1,a){c(n,o);break}l>=0&&t==":"&&r!=="\\"&&(c(n,o,l+1),o=l+2,n+=1)}return i=Object.keys(i).length===Bn?i:null,i},fm=K.exports.isValidEntry=function(e){for(var t={0:function(i){return i.length>0},1:function(i){return i==="*"?!0:(i=Number(i),isFinite(i)&&i>0&&i<9007199254740992&&Math.floor(i)===i)},2:function(i){return i.length>0},3:function(i){return i.length>0},4:function(i){return i.length>0}},r=0;r<Ae.length;r+=1){var n=t[r],o=e[Ae[r]]||"",s=n(o);if(!s)return!1}return!0}});var Zi=m((KT,Fn)=>{"use strict";var YT=w("path"),Ji=w("fs"),Dt=Xi();Fn.exports=function(e,t){var r=Dt.getFileName();Ji.stat(r,function(n,o){if(n||!Dt.usePgPass(o,r))return t(void 0);var s=Ji.createReadStream(r);Dt.getPassword(e,s,t)})};Fn.exports.warnTo=Dt.warnTo});var na=m((XT,ra)=>{"use strict";var dm=w("events").EventEmitter,ea=xe(),qn=wi(),pm=Tt(),hm=cn(),ta=Pi(),mm=Je(),gm=$n(),ym=on(),Mt=class extends dm{constructor(t){super(),this.connectionParameters=new hm(t),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=t||{};this._Promise=r.Promise||global.Promise,this._types=new pm(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gm({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||mm.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(t){let r=n=>{process.nextTick(()=>{n.handleError(t,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(t){let r=this,n=this.connection;if(this._connectionCallback=t,this._connecting||this._connected){let o=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{t(o)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let o=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(o),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(o):this._handleErrorEvent(o):this._connectionError||this._handleErrorEvent(o)),process.nextTick(()=>{this.emit("end")})})}connect(t){if(t){this._connect(t);return}return new this._Promise((r,n)=>{this._connect(o=>{o?n(o):r()})})}_attachListeners(t){t.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),t.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),t.on("authenticationSASL",this._handleAuthSASL.bind(this)),t.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),t.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),t.on("backendKeyData",this._handleBackendKeyData.bind(this)),t.on("error",this._handleErrorEvent.bind(this)),t.on("errorMessage",this._handleErrorMessage.bind(this)),t.on("readyForQuery",this._handleReadyForQuery.bind(this)),t.on("notice",this._handleNotice.bind(this)),t.on("rowDescription",this._handleRowDescription.bind(this)),t.on("dataRow",this._handleDataRow.bind(this)),t.on("portalSuspended",this._handlePortalSuspended.bind(this)),t.on("emptyQuery",this._handleEmptyQuery.bind(this)),t.on("commandComplete",this._handleCommandComplete.bind(this)),t.on("parseComplete",this._handleParseComplete.bind(this)),t.on("copyInResponse",this._handleCopyInResponse.bind(this)),t.on("copyData",this._handleCopyData.bind(this)),t.on("notification",this._handleNotification.bind(this))}_checkPgPass(t){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;t()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)t();else try{Zi()(this.connectionParameters,o=>{o!==void 0&&(this.connectionParameters.password=this.password=o),t()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(t){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(t){this._checkPgPass(async()=>{try{let r=await ym.postgresMd5PasswordHash(this.user,this.password,t.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(t){this._checkPgPass(()=>{try{this.saslSession=qn.startSession(t.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(t){try{await qn.continueSession(this.saslSession,this.password,t.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(t){try{qn.finalizeSession(this.saslSession,t.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(t){this.processID=t.processID,this.secretKey=t.secretKey}_handleReadyForQuery(t){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(t){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(t);this.emit("error",t)}}_handleErrorEvent(t){if(this._connecting)return this._handleErrorWhileConnecting(t);this._queryable=!1,this._errorAllQueries(t),this.emit("error",t)}_handleErrorMessage(t){if(this._connecting)return this._handleErrorWhileConnecting(t);let r=this.activeQuery;if(!r){this._handleErrorEvent(t);return}this.activeQuery=null,r.handleError(t,this.connection)}_handleRowDescription(t){this.activeQuery.handleRowDescription(t)}_handleDataRow(t){this.activeQuery.handleDataRow(t)}_handlePortalSuspended(t){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(t){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(t){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(t,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let t=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(t);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(t){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(t){this.activeQuery.handleCopyData(t,this.connection)}_handleNotification(t){this.emit("notification",t)}_handleNotice(t){this.emit("notice",t)}getStartupConf(){let t=this.connectionParameters,r={user:t.user,database:t.database},n=t.application_name||t.fallback_application_name;return n&&(r.application_name=n),t.replication&&(r.replication=""+t.replication),t.statement_timeout&&(r.statement_timeout=String(parseInt(t.statement_timeout,10))),t.lock_timeout&&(r.lock_timeout=String(parseInt(t.lock_timeout,10))),t.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(t.idle_in_transaction_session_timeout,10))),t.options&&(r.options=t.options),r}cancel(t,r){if(t.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(t.processID,t.secretKey)})}else t.queryQueue.indexOf(r)!==-1&&t.queryQueue.splice(t.queryQueue.indexOf(r),1)}setTypeParser(t,r,n){return this._types.setTypeParser(t,r,n)}getTypeParser(t,r){return this._types.getTypeParser(t,r)}escapeIdentifier(t){return ea.escapeIdentifier(t)}escapeLiteral(t){return ea.escapeLiteral(t)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let t=this.activeQuery.submit(this.connection);t&&process.nextTick(()=>{this.activeQuery.handleError(t,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(t,r,n){let o,s,i,a,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");return typeof t.submit=="function"?(i=t.query_timeout||this.connectionParameters.query_timeout,s=o=t,typeof r=="function"&&(o.callback=o.callback||r)):(i=t.query_timeout||this.connectionParameters.query_timeout,o=new ta(t,r,n),o.callback||(s=new this._Promise((l,u)=>{o.callback=(f,d)=>f?u(f):l(d)}).catch(l=>{throw Error.captureStackTrace(l),l}))),i&&(c=o.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{o.handleError(l,this.connection)}),c(l),o.callback=()=>{};let u=this.queryQueue.indexOf(o);u>-1&&this.queryQueue.splice(u,1),this._pulseQueryQueue()},i),o.callback=(l,u)=>{clearTimeout(a),c(l,u)}),this.binary&&!o.binary&&(o.binary=!0),o._result&&!o._result._types&&(o._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{o.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(o),this._pulseQueryQueue(),s):(process.nextTick(()=>{o.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(t){if(this._ending=!0,!this.connection._connecting||this._ended)if(t)t();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),t)this.connection.once("end",t);else return new this._Promise(r=>{this.connection.once("end",r)})}};Mt.Query=ta;ra.exports=Mt});var aa=m((JT,ia)=>{"use strict";var bm=w("events").EventEmitter,oa=function(){},sa=(e,t)=>{let r=e.findIndex(t);return r===-1?void 0:e.splice(r,1)[0]},Un=class{constructor(t,r,n){this.client=t,this.idleListener=r,this.timeoutId=n}},ve=class{constructor(t){this.callback=t}};function Sm(){throw new Error("Release called on client which has already been released to the pool.")}function Pt(e,t){if(t)return{callback:t,result:void 0};let r,n,o=function(i,a){i?r(i):n(a)},s=new e(function(i,a){n=i,r=a}).catch(i=>{throw Error.captureStackTrace(i),i});return{callback:o,result:s}}function wm(e,t){return function r(n){n.client=t,t.removeListener("error",r),t.on("error",()=>{e.log("additional client error after disconnection due to error",n)}),e._remove(t),e.emit("error",n,t)}}var jn=class extends bm{constructor(t,r){super(),this.options=Object.assign({},t),t!=null&&"password"in t&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:t.password}),t!=null&&t.ssl&&t.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||Gn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let t=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let o=r.idleListener;return this._acquireClient(n,t,o,!1)}if(!this._isFull())return this.newClient(t);throw new Error("unexpected condition")}_remove(t,r){let n=sa(this._idle,s=>s.client===t);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==t);let o=this;t.end(()=>{o.emit("remove",t),typeof r=="function"&&r()})}connect(t){if(this.ending){let o=new Error("Cannot use a pool after calling end on the pool");return t?t(o):this.Promise.reject(o)}let r=Pt(this.Promise,t),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new ve(r.callback)),n;let o=(a,c,l)=>{clearTimeout(i),r.callback(a,c,l)},s=new ve(o),i=setTimeout(()=>{sa(this._pendingQueue,a=>a.callback===o),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return i.unref&&i.unref(),this._pendingQueue.push(s),n}return this.newClient(new ve(r.callback)),n}newClient(t){let r=new this.Client(this.options);this._clients.push(r);let n=wm(this,r);this.log("checking client timeout");let o,s=!1;this.options.connectionTimeoutMillis&&(o=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(i=>{if(o&&clearTimeout(o),r.on("error",n),i)this.log("client failed to connect",i),this._clients=this._clients.filter(a=>a!==r),s&&(i=new Error("Connection terminated due to connection timeout",{cause:i})),this._pulseQueue(),t.timedOut||t.callback(i,void 0,oa);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let a=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(l=>l.client===r)!==-1&&this._acquireClient(r,new ve((l,u,f)=>f()),n,!1)},this.options.maxLifetimeSeconds*1e3);a.unref(),r.once("end",()=>clearTimeout(a))}return this._acquireClient(r,t,n,!0)}})}_acquireClient(t,r,n,o){o&&this.emit("connect",t),this.emit("acquire",t),t.release=this._releaseOnce(t,n),t.removeListener("error",n),r.timedOut?o&&this.options.verify?this.options.verify(t,t.release):t.release():o&&this.options.verify?this.options.verify(t,s=>{if(s)return t.release(s),r.callback(s,void 0,oa);r.callback(void 0,t,t.release)}):r.callback(void 0,t,t.release)}_releaseOnce(t,r){let n=!1;return o=>{n&&Sm(),n=!0,this._release(t,r,o)}}_release(t,r,n){if(t.on("error",r),t._poolUseCount=(t._poolUseCount||0)+1,this.emit("release",n,t),n||this.ending||!t._queryable||t._ending||t._poolUseCount>=this.options.maxUses)return t._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(t,this._pulseQueue.bind(this));if(this._expired.has(t))return this.log("remove expired client"),this._expired.delete(t),this._remove(t,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(t,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&t.unref(),this._idle.push(new Un(t,r,s)),this._pulseQueue()}query(t,r,n){if(typeof t=="function"){let s=Pt(this.Promise,t);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let o=Pt(this.Promise,n);return n=o.callback,this.connect((s,i)=>{if(s)return n(s);let a=!1,c=l=>{a||(a=!0,i.release(l),n(l))};i.once("error",c),this.log("dispatching query");try{i.query(t,r,(l,u)=>{if(this.log("query dispatched"),i.removeListener("error",c),!a)return a=!0,i.release(l),l?n(l):n(void 0,u)})}catch(l){return i.release(l),n(l)}}),o.result}end(t){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return t?t(n):this.Promise.reject(n)}this.ending=!0;let r=Pt(this.Promise,t);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((t,r)=>t+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};ia.exports=jn});var ua=m((ZT,la)=>{"use strict";var ca=w("events").EventEmitter,Em=w("util"),Qn=xe(),Ie=la.exports=function(e,t,r){ca.call(this),e=Qn.normalizeQueryConfig(e,t,r),this.text=e.text,this.values=e.values,this.name=e.name,this.queryMode=e.queryMode,this.callback=e.callback,this.state="new",this._arrayMode=e.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};Em.inherits(Ie,ca);var xm={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Ie.prototype.handleError=function(e){let t=this.native.pq.resultErrorFields();if(t)for(let r in t){let n=xm[r]||r;e[n]=t[r]}this.callback?this.callback(e):this.emit("error",e),this.state="error"};Ie.prototype.then=function(e,t){return this._getPromise().then(e,t)};Ie.prototype.catch=function(e){return this._getPromise().catch(e)};Ie.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(e,t){this._once("end",e),this._once("error",t)}.bind(this)),this._promise)};Ie.prototype.submit=function(e){this.state="running";let t=this;this.native=e.native,e.native.arrayMode=this._arrayMode;let r=function(n,o,s){if(e.native.arrayMode=!1,setImmediate(function(){t.emit("_done")}),n)return t.handleError(n);t._emitRowEvents&&(s.length>1?o.forEach((i,a)=>{i.forEach(c=>{t.emit("row",c,s[a])})}):o.forEach(function(i){t.emit("row",i,s)})),t.state="end",t.emit("end",s),t.callback&&t.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qn.prepareValue);if(e.namedQueries[this.name]){if(this.text&&e.namedQueries[this.name]!==this.text){let o=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(o)}return e.native.execute(this.name,n,r)}return e.native.prepare(this.name,this.text,n.length,function(o){return o?r(o):(e.namedQueries[t.name]=t.text,t.native.execute(t.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let o=new Error("Query values must be an array");return r(o)}let n=this.values.map(Qn.prepareValue);e.native.query(this.text,n,r)}else this.queryMode==="extended"?e.native.query(this.text,[],r):e.native.query(this.text,r)}});var ma=m((e0,ha)=>{"use strict";var fa;try{fa=w("pg-native")}catch(e){throw e}var Tm=Tt(),da=w("events").EventEmitter,Cm=w("util"),_m=cn(),pa=ua(),P=ha.exports=function(e){da.call(this),e=e||{},this._Promise=e.Promise||global.Promise,this._types=new Tm(e.types),this.native=new fa({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let t=this.connectionParameters=new _m(e);e.nativeConnectionString&&(t.nativeConnectionString=e.nativeConnectionString),this.user=t.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:t.password}),this.database=t.database,this.host=t.host,this.port=t.port,this.namedQueries={}};P.Query=pa;Cm.inherits(P,da);P.prototype._errorAllQueries=function(e){let t=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(e)})};this._hasActiveQuery()&&(t(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(t),this._queryQueue.length=0};P.prototype._connect=function(e){let t=this;if(this._connecting){process.nextTick(()=>e(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(t.connectionParameters.nativeConnectionString&&(n=t.connectionParameters.nativeConnectionString),r)return e(r);t.native.connect(n,function(o){if(o)return t.native.end(),e(o);t._connected=!0,t.native.on("error",function(s){t._queryable=!1,t._errorAllQueries(s),t.emit("error",s)}),t.native.on("notification",function(s){t.emit("notification",{channel:s.relname,payload:s.extra})}),t.emit("connect"),t._pulseQueryQueue(!0),e()})})};P.prototype.connect=function(e){if(e){this._connect(e);return}return new this._Promise((t,r)=>{this._connect(n=>{n?r(n):t()})})};P.prototype.query=function(e,t,r){let n,o,s,i,a;if(e==null)throw new TypeError("Client was passed a null or undefined query");if(typeof e.submit=="function")s=e.query_timeout||this.connectionParameters.query_timeout,o=n=e,typeof t=="function"&&(e.callback=t);else if(s=e.query_timeout||this.connectionParameters.query_timeout,n=new pa(e,t,r),!n.callback){let c,l;o=new this._Promise((u,f)=>{c=u,l=f}).catch(u=>{throw Error.captureStackTrace(u),u}),n.callback=(u,f)=>u?l(u):c(f)}return s&&(a=n.callback,i=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{n.handleError(c,this.connection)}),a(c),n.callback=()=>{};let l=this._queryQueue.indexOf(n);l>-1&&this._queryQueue.splice(l,1),this._pulseQueryQueue()},s),n.callback=(c,l)=>{clearTimeout(i),a(c,l)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),o):(this._queryQueue.push(n),this._pulseQueryQueue(),o):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),o)};P.prototype.end=function(e){let t=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,e));let r;return e||(r=new this._Promise(function(n,o){e=s=>s?o(s):n()})),this.native.end(function(){t._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{t.emit("end"),e&&e()})}),r};P.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};P.prototype._pulseQueryQueue=function(e){if(!this._connected||this._hasActiveQuery())return;let t=this._queryQueue.shift();if(!t){e||this.emit("drain");return}this._activeQuery=t,t.submit(this);let r=this;t.once("_done",function(){r._pulseQueryQueue()})};P.prototype.cancel=function(e){this._activeQuery===e?this.native.cancel(function(){}):this._queryQueue.indexOf(e)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(e),1)};P.prototype.ref=function(){};P.prototype.unref=function(){};P.prototype.setTypeParser=function(e,t,r){return this._types.setTypeParser(e,t,r)};P.prototype.getTypeParser=function(e,t){return this._types.getTypeParser(e,t)}});var Wn=m((t0,ga)=>{"use strict";ga.exports=ma()});var Gn=m((n0,tt)=>{"use strict";var Rm=na(),Am=Je(),vm=$n(),Im=un(),Om=xe(),Dm=aa(),Mm=Tt(),{DatabaseError:Pm}=Pn(),{escapeIdentifier:Lm,escapeLiteral:km}=xe(),$m=e=>class extends Dm{constructor(r){super(r,e)}},zn=function(e){this.defaults=Am,this.Client=e,this.Query=this.Client.Query,this.Pool=$m(this.Client),this._pools=[],this.Connection=vm,this.types=Xe(),this.DatabaseError=Pm,this.TypeOverrides=Mm,this.escapeIdentifier=Lm,this.escapeLiteral=km,this.Result=Im,this.utils=Om};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?tt.exports=new zn(Wn()):(tt.exports=new zn(Rm),Object.defineProperty(tt.exports,"native",{configurable:!0,enumerable:!1,get(){let e=null;try{e=new zn(Wn())}catch(t){if(t.code!=="MODULE_NOT_FOUND")throw t}return Object.defineProperty(tt.exports,"native",{value:e}),e}}))});var Ya=m((XC,Va)=>{Va.exports=Ha;Ha.sync=Ng;var Wa=w("fs");function Bg(e,t){var r=t.pathExt!==void 0?t.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var n=0;n<r.length;n++){var o=r[n].toLowerCase();if(o&&e.substr(-o.length).toLowerCase()===o)return!0}return!1}function za(e,t,r){return!e.isSymbolicLink()&&!e.isFile()?!1:Bg(t,r)}function Ha(e,t,r){Wa.stat(e,function(n,o){r(n,n?!1:za(o,e,t))})}function Ng(e,t){return za(Wa.statSync(e),e,t)}});var ec=m((JC,Za)=>{Za.exports=Xa;Xa.sync=Fg;var Ka=w("fs");function Xa(e,t,r){Ka.stat(e,function(n,o){r(n,n?!1:Ja(o,t))})}function Fg(e,t){return Ja(Ka.statSync(e),t)}function Ja(e,t){return e.isFile()&&qg(e,t)}function qg(e,t){var r=e.mode,n=e.uid,o=e.gid,s=t.uid!==void 0?t.uid:process.getuid&&process.getuid(),i=t.gid!==void 0?t.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),l=parseInt("001",8),u=a|c,f=r&l||r&c&&o===i||r&a&&n===s||r&u&&s===0;return f}});var rc=m((e_,tc)=>{var ZC=w("fs"),zt;process.platform==="win32"||global.TESTING_WINDOWS?zt=Ya():zt=ec();tc.exports=no;no.sync=Ug;function no(e,t,r){if(typeof t=="function"&&(r=t,t={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(n,o){no(e,t||{},function(s,i){s?o(s):n(i)})})}zt(e,t||{},function(n,o){n&&(n.code==="EACCES"||t&&t.ignoreErrors)&&(n=null,o=!1),r(n,o)})}function Ug(e,t){try{return zt.sync(e,t||{})}catch(r){if(t&&t.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var lc=m((t_,cc)=>{var Pe=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",nc=w("path"),jg=Pe?";":":",oc=rc(),sc=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),ic=(e,t)=>{let r=t.colon||jg,n=e.match(/\//)||Pe&&e.match(/\\/)?[""]:[...Pe?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(r)],o=Pe?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",s=Pe?o.split(r):[""];return Pe&&e.indexOf(".")!==-1&&s[0]!==""&&s.unshift(""),{pathEnv:n,pathExt:s,pathExtExe:o}},ac=(e,t,r)=>{typeof t=="function"&&(r=t,t={}),t||(t={});let{pathEnv:n,pathExt:o,pathExtExe:s}=ic(e,t),i=[],a=l=>new Promise((u,f)=>{if(l===n.length)return t.all&&i.length?u(i):f(sc(e));let d=n[l],p=/^".*"$/.test(d)?d.slice(1,-1):d,h=nc.join(p,e),S=!p&&/^\.[\\\/]/.test(e)?e.slice(0,2)+h:h;u(c(S,l,0))}),c=(l,u,f)=>new Promise((d,p)=>{if(f===o.length)return d(a(u+1));let h=o[f];oc(l+h,{pathExt:s},(S,y)=>{if(!S&&y)if(t.all)i.push(l+h);else return d(l+h);return d(c(l,u,f+1))})});return r?a(0).then(l=>r(null,l),r):a(0)},Gg=(e,t)=>{t=t||{};let{pathEnv:r,pathExt:n,pathExtExe:o}=ic(e,t),s=[];for(let i=0;i<r.length;i++){let a=r[i],c=/^".*"$/.test(a)?a.slice(1,-1):a,l=nc.join(c,e),u=!c&&/^\.[\\\/]/.test(e)?e.slice(0,2)+l:l;for(let f=0;f<n.length;f++){let d=u+n[f];try{if(oc.sync(d,{pathExt:o}))if(t.all)s.push(d);else return d}catch{}}}if(t.all&&s.length)return s;if(t.nothrow)return null;throw sc(e)};cc.exports=ac;ac.sync=Gg});var fc=m((r_,oo)=>{"use strict";var uc=(e={})=>{let t=e.env||process.env;return(e.platform||process.platform)!=="win32"?"PATH":Object.keys(t).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};oo.exports=uc;oo.exports.default=uc});var mc=m((n_,hc)=>{"use strict";var dc=w("path"),Qg=lc(),Wg=fc();function pc(e,t){let r=e.options.env||process.env,n=process.cwd(),o=e.options.cwd!=null,s=o&&process.chdir!==void 0&&!process.chdir.disabled;if(s)try{process.chdir(e.options.cwd)}catch{}let i;try{i=Qg.sync(e.command,{path:r[Wg({env:r})],pathExt:t?dc.delimiter:void 0})}catch{}finally{s&&process.chdir(n)}return i&&(i=dc.resolve(o?e.options.cwd:"",i)),i}function zg(e){return pc(e)||pc(e,!0)}hc.exports=zg});var gc=m((o_,io)=>{"use strict";var so=/([()\][%!^"`<>&|;, *?])/g;function Hg(e){return e=e.replace(so,"^$1"),e}function Vg(e,t){return e=`${e}`,e=e.replace(/(\\*)"/g,'$1$1\\"'),e=e.replace(/(\\*)$/,"$1$1"),e=`"${e}"`,e=e.replace(so,"^$1"),t&&(e=e.replace(so,"^$1")),e}io.exports.command=Hg;io.exports.argument=Vg});var bc=m((s_,yc)=>{"use strict";yc.exports=/^#!(.*)/});var wc=m((i_,Sc)=>{"use strict";var Yg=bc();Sc.exports=(e="")=>{let t=e.match(Yg);if(!t)return null;let[r,n]=t[0].replace(/#! ?/,"").split(" "),o=r.split("/").pop();return o==="env"?n:n?`${o} ${n}`:o}});var xc=m((a_,Ec)=>{"use strict";var ao=w("fs"),Kg=wc();function Xg(e){let r=Buffer.alloc(150),n;try{n=ao.openSync(e,"r"),ao.readSync(n,r,0,150,0),ao.closeSync(n)}catch{}return Kg(r.toString())}Ec.exports=Xg});var Rc=m((c_,_c)=>{"use strict";var Jg=w("path"),Tc=mc(),Cc=gc(),Zg=xc(),ey=process.platform==="win32",ty=/\.(?:com|exe)$/i,ry=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function ny(e){e.file=Tc(e);let t=e.file&&Zg(e.file);return t?(e.args.unshift(e.file),e.command=t,Tc(e)):e.file}function oy(e){if(!ey)return e;let t=ny(e),r=!ty.test(t);if(e.options.forceShell||r){let n=ry.test(t);e.command=Jg.normalize(e.command),e.command=Cc.command(e.command),e.args=e.args.map(s=>Cc.argument(s,n));let o=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${o}"`],e.command=process.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}function sy(e,t,r){t&&!Array.isArray(t)&&(r=t,t=null),t=t?t.slice(0):[],r=Object.assign({},r);let n={command:e,args:t,options:r,file:void 0,original:{command:e,args:t}};return r.shell?n:oy(n)}_c.exports=sy});var Ic=m((l_,vc)=>{"use strict";var co=process.platform==="win32";function lo(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function iy(e,t){if(!co)return;let r=e.emit;e.emit=function(n,o){if(n==="exit"){let s=Ac(o,t,"spawn");if(s)return r.call(e,"error",s)}return r.apply(e,arguments)}}function Ac(e,t){return co&&e===1&&!t.file?lo(t.original,"spawn"):null}function ay(e,t){return co&&e===1&&!t.file?lo(t.original,"spawnSync"):null}vc.exports={hookChildProcess:iy,verifyENOENT:Ac,verifyENOENTSync:ay,notFoundError:lo}});var Mc=m((u_,Le)=>{"use strict";var Oc=w("child_process"),uo=Rc(),fo=Ic();function Dc(e,t,r){let n=uo(e,t,r),o=Oc.spawn(n.command,n.args,n.options);return fo.hookChildProcess(o,n),o}function cy(e,t,r){let n=uo(e,t,r),o=Oc.spawnSync(n.command,n.args,n.options);return o.error=o.error||fo.verifyENOENTSync(o.status,n),o}Le.exports=Dc;Le.exports.spawn=Dc;Le.exports.sync=cy;Le.exports._parse=uo;Le.exports._enoent=fo});var B=Is(Gn(),1),ya=B.default.Client,Hn=B.default.Pool,o0=B.default.Connection,s0=B.default.types,i0=B.default.Query,a0=B.default.DatabaseError,c0=B.default.escapeIdentifier,l0=B.default.escapeLiteral,u0=B.default.Result,f0=B.default.TypeOverrides,d0=B.default.defaults;import{parseArgs as lT}from"util";function R(e){if(typeof e!="object"||e===null)return!1;let t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}import{fileURLToPath as Bm}from"url";var Oe=(e,t)=>{let r=Vn(e);if(typeof r!="string")throw new TypeError(`${t} must be a string or a file URL: ${r}.`);return r},Vn=e=>e instanceof URL?Bm(e):e;var Lt=(e,t=[],r={})=>{let n=Oe(e,"First argument"),[o,s]=R(t)?[[],t]:[t,r];if(!Array.isArray(o))throw new TypeError(`Second argument must be either an array of arguments or an options object: ${o}`);if(o.some(c=>typeof c=="object"&&c!==null))throw new TypeError(`Second argument must be an array of strings: ${o}`);let i=o.map(String),a=i.find(c=>c.includes("\0"));if(a!==void 0)throw new TypeError(`Arguments cannot contain null bytes ("\\0"): ${a}`);if(!R(s))throw new TypeError(`Last argument must be an options object: ${s}`);return[n,i,s]};import{ChildProcess as Qm}from"child_process";import{StringDecoder as Nm}from"string_decoder";var{toString:ba}=Object.prototype,Sa=e=>ba.call(e)==="[object ArrayBuffer]",v=e=>ba.call(e)==="[object Uint8Array]",X=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),Fm=new TextEncoder,wa=e=>Fm.encode(e),qm=new TextDecoder,kt=e=>qm.decode(e),Ea=(e,t)=>Um(e,t).join(""),Um=(e,t)=>{if(t==="utf8"&&e.every(s=>typeof s=="string"))return e;let r=new Nm(t),n=e.map(s=>typeof s=="string"?wa(s):s).map(s=>r.write(s)),o=r.end();return o===""?n:[...n,o]},rt=e=>e.length===1&&v(e[0])?e[0]:Yn(jm(e)),jm=e=>e.map(t=>typeof t=="string"?wa(t):t),Yn=e=>{let t=new Uint8Array(Gm(e)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t},Gm=e=>{let t=0;for(let r of e)t+=r.length;return t};var _a=e=>Array.isArray(e)&&Array.isArray(e.raw),Ra=(e,t)=>{let r=[];for(let[s,i]of e.entries())r=Wm({templates:e,expressions:t,tokens:r,index:s,template:i});if(r.length===0)throw new TypeError("Template script must not be empty");let[n,...o]=r;return[n,o,{}]},Wm=({templates:e,expressions:t,tokens:r,index:n,template:o})=>{if(o===void 0)throw new TypeError(`Invalid backslash sequence: ${e.raw[n]}`);let{nextTokens:s,leadingWhitespaces:i,trailingWhitespaces:a}=zm(o,e.raw[n]),c=Ta(r,s,i);if(n===t.length)return c;let l=t[n],u=Array.isArray(l)?l.map(f=>Ca(f)):[Ca(l)];return Ta(c,u,a)},zm=(e,t)=>{if(t.length===0)return{nextTokens:[],leadingWhitespaces:!1,trailingWhitespaces:!1};let r=[],n=0,o=xa.has(t[0]);for(let i=0,a=0;i<e.length;i+=1,a+=1){let c=t[a];if(xa.has(c))n!==i&&r.push(e.slice(n,i)),n=i+1;else if(c==="\\"){let l=t[a+1];l==="u"&&t[a+2]==="{"?a=t.indexOf("}",a+3):a+=Hm[l]??1}}let s=n===e.length;return s||r.push(e.slice(n)),{nextTokens:r,leadingWhitespaces:o,trailingWhitespaces:s}},xa=new Set([" ","	","\r",`
`]),Hm={x:3,u:5},Ta=(e,t,r)=>r||e.length===0||t.length===0?[...e,...t]:[...e.slice(0,-1),`${e.at(-1)}${t[0]}`,...t.slice(1)],Ca=e=>{let t=typeof e;if(t==="string")return e;if(t==="number")return String(e);if(R(e)&&("stdout"in e||"isMaxBuffer"in e))return Vm(e);throw e instanceof Qm||Object.prototype.toString.call(e)==="[object Promise]"?new TypeError("Unexpected subprocess in template expression. Please use ${await subprocess} instead of ${subprocess}."):new TypeError(`Unexpected "${t}" in template expression`)},Vm=({stdout:e})=>{if(typeof e=="string")return e;if(v(e))return kt(e);throw e===void 0?new TypeError(`Missing result.stdout in template expression. This is probably due to the previous subprocess' "stdout" option.`):new TypeError(`Unexpected "${typeof e}" stdout in template expression`)};import{spawnSync as Kw}from"child_process";import{debuglog as Ym}from"util";import Kn from"process";var q=e=>$t.includes(e),$t=[Kn.stdin,Kn.stdout,Kn.stderr],N=["stdin","stdout","stderr"],Bt=e=>N[e]??`stdio[${e}]`;var va=e=>{let t={...e};for(let r of Zn)t[r]=Xn(e,r);return t},Xn=(e,t)=>{let r=Array.from({length:Km(e)+1}),n=Xm(e[t],r,t);return rg(n,t)},Km=({stdio:e})=>Array.isArray(e)?Math.max(e.length,N.length):N.length,Xm=(e,t,r)=>R(e)?Jm(e,t,r):t.fill(e),Jm=(e,t,r)=>{for(let n of Object.keys(e).sort(Zm))for(let o of eg(n,r,t))t[o]=e[n];return t},Zm=(e,t)=>Aa(e)<Aa(t)?1:-1,Aa=e=>e==="stdout"||e==="stderr"?0:e==="all"?2:1,eg=(e,t,r)=>{if(e==="ipc")return[r.length-1];let n=Jn(e);if(n===void 0||n===0)throw new TypeError(`"${t}.${e}" is invalid.
It must be "${t}.stdout", "${t}.stderr", "${t}.all", "${t}.ipc", or "${t}.fd3", "${t}.fd4" (and so on).`);if(n>=r.length)throw new TypeError(`"${t}.${e}" is invalid: that file descriptor does not exist.
Please set the "stdio" option to ensure that file descriptor exists.`);return n==="all"?[1,2]:[n]},Jn=e=>{if(e==="all")return e;if(N.includes(e))return N.indexOf(e);let t=tg.exec(e);if(t!==null)return Number(t[1])},tg=/^fd(\d+)$/,rg=(e,t)=>e.map(r=>r===void 0?og[t]:r),ng=Ym("execa").enabled?"full":"none",og={lines:!1,buffer:!0,maxBuffer:1e3*1e3*100,verbose:ng,stripFinalNewline:!0},Zn=["lines","buffer","maxBuffer","verbose","stripFinalNewline"],J=(e,t)=>t==="ipc"?e.at(-1):e[t];var De=({verbose:e},t)=>eo(e,t)!=="none",Me=({verbose:e},t)=>!["none","short"].includes(eo(e,t)),Ia=({verbose:e},t)=>{let r=eo(e,t);return Nt(r)?r:void 0},eo=(e,t)=>t===void 0?sg(e):J(e,t),sg=e=>e.find(t=>Nt(t))??Ft.findLast(t=>e.includes(t)),Nt=e=>typeof e=="function",Ft=["none","short","full"];import{writeFileSync as Ag}from"fs";import{inspect as vg}from"util";import{platform as ig}from"process";import{stripVTControlCharacters as ag}from"util";var Oa=(e,t)=>{let r=[e,...t],n=r.join(" "),o=r.map(s=>pg(Da(s))).join(" ");return{command:n,escapedCommand:o}},nt=e=>ag(e).split(`
`).map(t=>Da(t)).join(`
`),Da=e=>e.replaceAll(ug,t=>cg(t)),cg=e=>{let t=fg[e];if(t!==void 0)return t;let r=e.codePointAt(0),n=r.toString(16);return r<=dg?`\\u${n.padStart(4,"0")}`:`\\U${n}`},lg=()=>{try{return new RegExp("\\p{Separator}|\\p{Other}","gu")}catch{return/[\s\u0000-\u001F\u007F-\u009F\u00AD]/g}},ug=lg(),fg={" ":" ","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},dg=65535,pg=e=>hg.test(e)?e:ig==="win32"?`"${e.replaceAll('"','""')}"`:`'${e.replaceAll("'","'\\''")}'`,hg=/^[\w./-]+$/;import Ma from"process";function to(){let{env:e}=Ma,{TERM:t,TERM_PROGRAM:r}=e;return Ma.platform!=="win32"?t!=="linux":!!e.WT_SESSION||!!e.TERMINUS_SUBLIME||e.ConEmuTask==="{cmd::Cmder}"||r==="Terminus-Sublime"||r==="vscode"||t==="xterm-256color"||t==="alacritty"||t==="rxvt-unicode"||t==="rxvt-unicode-256color"||e.TERMINAL_EMULATOR==="JetBrains-JediTerm"}var Pa={circleQuestionMark:"(?)",questionMarkPrefix:"(?)",square:"\u2588",squareDarkShade:"\u2593",squareMediumShade:"\u2592",squareLightShade:"\u2591",squareTop:"\u2580",squareBottom:"\u2584",squareLeft:"\u258C",squareRight:"\u2590",squareCenter:"\u25A0",bullet:"\u25CF",dot:"\u2024",ellipsis:"\u2026",pointerSmall:"\u203A",triangleUp:"\u25B2",triangleUpSmall:"\u25B4",triangleDown:"\u25BC",triangleDownSmall:"\u25BE",triangleLeftSmall:"\u25C2",triangleRightSmall:"\u25B8",home:"\u2302",heart:"\u2665",musicNote:"\u266A",musicNoteBeamed:"\u266B",arrowUp:"\u2191",arrowDown:"\u2193",arrowLeft:"\u2190",arrowRight:"\u2192",arrowLeftRight:"\u2194",arrowUpDown:"\u2195",almostEqual:"\u2248",notEqual:"\u2260",lessOrEqual:"\u2264",greaterOrEqual:"\u2265",identical:"\u2261",infinity:"\u221E",subscriptZero:"\u2080",subscriptOne:"\u2081",subscriptTwo:"\u2082",subscriptThree:"\u2083",subscriptFour:"\u2084",subscriptFive:"\u2085",subscriptSix:"\u2086",subscriptSeven:"\u2087",subscriptEight:"\u2088",subscriptNine:"\u2089",oneHalf:"\xBD",oneThird:"\u2153",oneQuarter:"\xBC",oneFifth:"\u2155",oneSixth:"\u2159",oneEighth:"\u215B",twoThirds:"\u2154",twoFifths:"\u2156",threeQuarters:"\xBE",threeFifths:"\u2157",threeEighths:"\u215C",fourFifths:"\u2158",fiveSixths:"\u215A",fiveEighths:"\u215D",sevenEighths:"\u215E",line:"\u2500",lineBold:"\u2501",lineDouble:"\u2550",lineDashed0:"\u2504",lineDashed1:"\u2505",lineDashed2:"\u2508",lineDashed3:"\u2509",lineDashed4:"\u254C",lineDashed5:"\u254D",lineDashed6:"\u2574",lineDashed7:"\u2576",lineDashed8:"\u2578",lineDashed9:"\u257A",lineDashed10:"\u257C",lineDashed11:"\u257E",lineDashed12:"\u2212",lineDashed13:"\u2013",lineDashed14:"\u2010",lineDashed15:"\u2043",lineVertical:"\u2502",lineVerticalBold:"\u2503",lineVerticalDouble:"\u2551",lineVerticalDashed0:"\u2506",lineVerticalDashed1:"\u2507",lineVerticalDashed2:"\u250A",lineVerticalDashed3:"\u250B",lineVerticalDashed4:"\u254E",lineVerticalDashed5:"\u254F",lineVerticalDashed6:"\u2575",lineVerticalDashed7:"\u2577",lineVerticalDashed8:"\u2579",lineVerticalDashed9:"\u257B",lineVerticalDashed10:"\u257D",lineVerticalDashed11:"\u257F",lineDownLeft:"\u2510",lineDownLeftArc:"\u256E",lineDownBoldLeftBold:"\u2513",lineDownBoldLeft:"\u2512",lineDownLeftBold:"\u2511",lineDownDoubleLeftDouble:"\u2557",lineDownDoubleLeft:"\u2556",lineDownLeftDouble:"\u2555",lineDownRight:"\u250C",lineDownRightArc:"\u256D",lineDownBoldRightBold:"\u250F",lineDownBoldRight:"\u250E",lineDownRightBold:"\u250D",lineDownDoubleRightDouble:"\u2554",lineDownDoubleRight:"\u2553",lineDownRightDouble:"\u2552",lineUpLeft:"\u2518",lineUpLeftArc:"\u256F",lineUpBoldLeftBold:"\u251B",lineUpBoldLeft:"\u251A",lineUpLeftBold:"\u2519",lineUpDoubleLeftDouble:"\u255D",lineUpDoubleLeft:"\u255C",lineUpLeftDouble:"\u255B",lineUpRight:"\u2514",lineUpRightArc:"\u2570",lineUpBoldRightBold:"\u2517",lineUpBoldRight:"\u2516",lineUpRightBold:"\u2515",lineUpDoubleRightDouble:"\u255A",lineUpDoubleRight:"\u2559",lineUpRightDouble:"\u2558",lineUpDownLeft:"\u2524",lineUpBoldDownBoldLeftBold:"\u252B",lineUpBoldDownBoldLeft:"\u2528",lineUpDownLeftBold:"\u2525",lineUpBoldDownLeftBold:"\u2529",lineUpDownBoldLeftBold:"\u252A",lineUpDownBoldLeft:"\u2527",lineUpBoldDownLeft:"\u2526",lineUpDoubleDownDoubleLeftDouble:"\u2563",lineUpDoubleDownDoubleLeft:"\u2562",lineUpDownLeftDouble:"\u2561",lineUpDownRight:"\u251C",lineUpBoldDownBoldRightBold:"\u2523",lineUpBoldDownBoldRight:"\u2520",lineUpDownRightBold:"\u251D",lineUpBoldDownRightBold:"\u2521",lineUpDownBoldRightBold:"\u2522",lineUpDownBoldRight:"\u251F",lineUpBoldDownRight:"\u251E",lineUpDoubleDownDoubleRightDouble:"\u2560",lineUpDoubleDownDoubleRight:"\u255F",lineUpDownRightDouble:"\u255E",lineDownLeftRight:"\u252C",lineDownBoldLeftBoldRightBold:"\u2533",lineDownLeftBoldRightBold:"\u252F",lineDownBoldLeftRight:"\u2530",lineDownBoldLeftBoldRight:"\u2531",lineDownBoldLeftRightBold:"\u2532",lineDownLeftRightBold:"\u252E",lineDownLeftBoldRight:"\u252D",lineDownDoubleLeftDoubleRightDouble:"\u2566",lineDownDoubleLeftRight:"\u2565",lineDownLeftDoubleRightDouble:"\u2564",lineUpLeftRight:"\u2534",lineUpBoldLeftBoldRightBold:"\u253B",lineUpLeftBoldRightBold:"\u2537",lineUpBoldLeftRight:"\u2538",lineUpBoldLeftBoldRight:"\u2539",lineUpBoldLeftRightBold:"\u253A",lineUpLeftRightBold:"\u2536",lineUpLeftBoldRight:"\u2535",lineUpDoubleLeftDoubleRightDouble:"\u2569",lineUpDoubleLeftRight:"\u2568",lineUpLeftDoubleRightDouble:"\u2567",lineUpDownLeftRight:"\u253C",lineUpBoldDownBoldLeftBoldRightBold:"\u254B",lineUpDownBoldLeftBoldRightBold:"\u2548",lineUpBoldDownLeftBoldRightBold:"\u2547",lineUpBoldDownBoldLeftRightBold:"\u254A",lineUpBoldDownBoldLeftBoldRight:"\u2549",lineUpBoldDownLeftRight:"\u2540",lineUpDownBoldLeftRight:"\u2541",lineUpDownLeftBoldRight:"\u253D",lineUpDownLeftRightBold:"\u253E",lineUpBoldDownBoldLeftRight:"\u2542",lineUpDownLeftBoldRightBold:"\u253F",lineUpBoldDownLeftBoldRight:"\u2543",lineUpBoldDownLeftRightBold:"\u2544",lineUpDownBoldLeftBoldRight:"\u2545",lineUpDownBoldLeftRightBold:"\u2546",lineUpDoubleDownDoubleLeftDoubleRightDouble:"\u256C",lineUpDoubleDownDoubleLeftRight:"\u256B",lineUpDownLeftDoubleRightDouble:"\u256A",lineCross:"\u2573",lineBackslash:"\u2572",lineSlash:"\u2571"},La={tick:"\u2714",info:"\u2139",warning:"\u26A0",cross:"\u2718",squareSmall:"\u25FB",squareSmallFilled:"\u25FC",circle:"\u25EF",circleFilled:"\u25C9",circleDotted:"\u25CC",circleDouble:"\u25CE",circleCircle:"\u24DE",circleCross:"\u24E7",circlePipe:"\u24BE",radioOn:"\u25C9",radioOff:"\u25EF",checkboxOn:"\u2612",checkboxOff:"\u2610",checkboxCircleOn:"\u24E7",checkboxCircleOff:"\u24BE",pointer:"\u276F",triangleUpOutline:"\u25B3",triangleLeft:"\u25C0",triangleRight:"\u25B6",lozenge:"\u25C6",lozengeOutline:"\u25C7",hamburger:"\u2630",smiley:"\u32E1",mustache:"\u0DF4",star:"\u2605",play:"\u25B6",nodejs:"\u2B22",oneSeventh:"\u2150",oneNinth:"\u2151",oneTenth:"\u2152"},mg={tick:"\u221A",info:"i",warning:"\u203C",cross:"\xD7",squareSmall:"\u25A1",squareSmallFilled:"\u25A0",circle:"( )",circleFilled:"(*)",circleDotted:"( )",circleDouble:"( )",circleCircle:"(\u25CB)",circleCross:"(\xD7)",circlePipe:"(\u2502)",radioOn:"(*)",radioOff:"( )",checkboxOn:"[\xD7]",checkboxOff:"[ ]",checkboxCircleOn:"(\xD7)",checkboxCircleOff:"( )",pointer:">",triangleUpOutline:"\u2206",triangleLeft:"\u25C4",triangleRight:"\u25BA",lozenge:"\u2666",lozengeOutline:"\u25CA",hamburger:"\u2261",smiley:"\u263A",mustache:"\u250C\u2500\u2510",star:"\u2736",play:"\u25BA",nodejs:"\u2666",oneSeventh:"1/7",oneNinth:"1/9",oneTenth:"1/10"},gg={...Pa,...La},yg={...Pa,...mg},bg=to(),Sg=bg?gg:yg,qt=Sg,q0=Object.entries(La);import wg from"tty";var Eg=wg?.WriteStream?.prototype?.hasColors?.()??!1,b=(e,t)=>{if(!Eg)return o=>o;let r=`\x1B[${e}m`,n=`\x1B[${t}m`;return o=>{let s=o+"",i=s.indexOf(n);if(i===-1)return r+s+n;let a=r,c=0;for(;i!==-1;)a+=s.slice(c,i)+r,c=i+n.length,i=s.indexOf(n,c);return a+=s.slice(c)+n,a}},G0=b(0,0),ka=b(1,22),Q0=b(2,22),W0=b(3,23),z0=b(4,24),H0=b(53,55),V0=b(7,27),Y0=b(8,28),K0=b(9,29),X0=b(30,39),J0=b(31,39),Z0=b(32,39),eC=b(33,39),tC=b(34,39),rC=b(35,39),nC=b(36,39),oC=b(37,39),Ut=b(90,39),sC=b(40,49),iC=b(41,49),aC=b(42,49),cC=b(43,49),lC=b(44,49),uC=b(45,49),fC=b(46,49),dC=b(47,49),pC=b(100,49),$a=b(91,39),hC=b(92,39),Ba=b(93,39),mC=b(94,39),gC=b(95,39),yC=b(96,39),bC=b(97,39),SC=b(101,49),wC=b(102,49),EC=b(103,49),xC=b(104,49),TC=b(105,49),CC=b(106,49),_C=b(107,49);var qa=({type:e,message:t,timestamp:r,piped:n,commandId:o,result:{failed:s=!1}={},options:{reject:i=!0}})=>{let a=xg(r),c=Tg[e]({failed:s,reject:i,piped:n}),l=Cg[e]({reject:i});return`${Ut(`[${a}]`)} ${Ut(`[${o}]`)} ${l(c)} ${l(t)}`},xg=e=>`${jt(e.getHours(),2)}:${jt(e.getMinutes(),2)}:${jt(e.getSeconds(),2)}.${jt(e.getMilliseconds(),3)}`,jt=(e,t)=>String(e).padStart(t,"0"),Na=({failed:e,reject:t})=>e?t?qt.cross:qt.warning:qt.tick,Tg={command:({piped:e})=>e?"|":"$",output:()=>" ",ipc:()=>"*",error:Na,duration:Na},Fa=e=>e,Cg={command:()=>ka,output:()=>Fa,ipc:()=>Fa,error:({reject:e})=>e?$a:Ba,duration:()=>Ut};var Ua=(e,t,r)=>{let n=Ia(t,r);return e.map(({verboseLine:o,verboseObject:s})=>_g(o,s,n)).filter(o=>o!==void 0).map(o=>Rg(o)).join("")},_g=(e,t,r)=>{if(r===void 0)return e;let n=r(e,t);if(typeof n=="string")return n},Rg=e=>e.endsWith(`
`)?e:`${e}
`;var W=({type:e,verboseMessage:t,fdNumber:r,verboseInfo:n,result:o})=>{let s=Ig({type:e,result:o,verboseInfo:n}),i=Og(t,s),a=Ua(i,n,r);Ag(Mg,a)},Ig=({type:e,result:t,verboseInfo:{escapedCommand:r,commandId:n,rawOptions:{piped:o=!1,...s}}})=>({type:e,escapedCommand:r,commandId:`${n}`,timestamp:new Date,piped:o,result:t,options:s}),Og=(e,t)=>e.split(`
`).map(r=>Dg({...t,message:r})),Dg=e=>({verboseLine:qa(e),verboseObject:e}),Mg=2,Gt=e=>{let t=typeof e=="string"?e:vg(e);return nt(t).replaceAll("	"," ".repeat(Pg))},Pg=2;var ja=(e,t)=>{De(t)&&W({type:"command",verboseMessage:e,verboseInfo:t})};var Ga=(e,t,r)=>{$g(e);let n=Lg(e);return{verbose:e,escapedCommand:t,commandId:n,rawOptions:r}},Lg=e=>De({verbose:e})?kg++:void 0,kg=0n,$g=e=>{for(let t of e){if(t===!1)throw new TypeError(`The "verbose: false" option was renamed to "verbose: 'none'".`);if(t===!0)throw new TypeError(`The "verbose: true" option was renamed to "verbose: 'short'".`);if(!Ft.includes(t)&&!Nt(t)){let r=Ft.map(n=>`'${n}'`).join(", ");throw new TypeError(`The "verbose" option must not be ${t}. Allowed values are: ${r} or a function.`)}}};import{hrtime as Qa}from"process";var Qt=()=>Qa.bigint(),ro=e=>Number(Qa.bigint()-e)/1e6;var Wt=(e,t,r)=>{let n=Qt(),{command:o,escapedCommand:s}=Oa(e,t),i=Xn(r,"verbose"),a=Ga(i,s,{...r});return ja(s,a),{command:o,escapedCommand:s,startTime:n,verboseInfo:a}};var jl=Is(Mc(),1);import gb from"path";import Ul from"process";import Vt from"process";import ot from"path";import{fileURLToPath as Pc}from"url";function Ht(e={}){let{env:t=process.env,platform:r=process.platform}=e;return r!=="win32"?"PATH":Object.keys(t).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"}var ly=({cwd:e=Vt.cwd(),path:t=Vt.env[Ht()],preferLocal:r=!0,execPath:n=Vt.execPath,addExecPath:o=!0}={})=>{let s=e instanceof URL?Pc(e):e,i=ot.resolve(s),a=[];return r&&uy(a,i),o&&fy(a,n,i),[...a,t].join(ot.delimiter)},uy=(e,t)=>{let r;for(;r!==t;)e.push(ot.join(t,"node_modules/.bin")),r=t,t=ot.resolve(t,"..")},fy=(e,t,r)=>{let n=t instanceof URL?Pc(t):t;e.push(ot.resolve(r,n,".."))},Lc=({env:e=Vt.env,...t}={})=>{e={...e};let r=Ht({env:e});return t.path=e[r],e[r]=ly(t),e};import{setTimeout as Ry}from"timers/promises";var kc=(e,t,r)=>{let n=r?it:st,o=e instanceof U?{}:{cause:e};return new n(t,o)},U=class extends Error{},$c=(e,t)=>{Object.defineProperty(e.prototype,"name",{value:t,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,Nc,{value:!0,writable:!1,enumerable:!1,configurable:!1})},Bc=e=>Yt(e)&&Nc in e,Nc=Symbol("isExecaError"),Yt=e=>Object.prototype.toString.call(e)==="[object Error]",st=class extends Error{};$c(st,st.name);var it=class extends Error{};$c(it,it.name);import{constants as at}from"os";import{constants as my}from"os";var Fc=()=>{let e=Uc-qc+1;return Array.from({length:e},dy)},dy=(e,t)=>({name:`SIGRT${t+1}`,number:qc+t,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}),qc=34,Uc=64;import{constants as py}from"os";var jc=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}];var po=()=>{let e=Fc();return[...jc,...e].map(hy)},hy=({name:e,number:t,description:r,action:n,forced:o=!1,standard:s})=>{let{signals:{[e]:i}}=py,a=i!==void 0;return{name:e,number:a?i:t,description:r,supported:a,action:n,forced:o,standard:s}};var gy=()=>{let e=po();return Object.fromEntries(e.map(yy))},yy=({name:e,number:t,description:r,supported:n,action:o,forced:s,standard:i})=>[e,{name:e,number:t,description:r,supported:n,action:o,forced:s,standard:i}],Gc=gy(),by=()=>{let e=po(),t=65,r=Array.from({length:t},(n,o)=>Sy(o,e));return Object.assign({},...r)},Sy=(e,t)=>{let r=wy(e,t);if(r===void 0)return{};let{name:n,description:o,supported:s,action:i,forced:a,standard:c}=r;return{[e]:{name:n,number:e,description:o,supported:s,action:i,forced:a,standard:c}}},wy=(e,t)=>{let r=t.find(({name:n})=>my.signals[n]===e);return r!==void 0?r:t.find(n=>n.number===e)},R_=by();var Wc=e=>{let t="option `killSignal`";if(e===0)throw new TypeError(`Invalid ${t}: 0 cannot be used.`);return Hc(e,t)},zc=e=>e===0?e:Hc(e,"`subprocess.kill()`'s argument"),Hc=(e,t)=>{if(Number.isInteger(e))return Ey(e,t);if(typeof e=="string")return Ty(e,t);throw new TypeError(`Invalid ${t} ${String(e)}: it must be a string or an integer.
${ho()}`)},Ey=(e,t)=>{if(Qc.has(e))return Qc.get(e);throw new TypeError(`Invalid ${t} ${e}: this signal integer does not exist.
${ho()}`)},xy=()=>new Map(Object.entries(at.signals).reverse().map(([e,t])=>[t,e])),Qc=xy(),Ty=(e,t)=>{if(e in at.signals)return e;throw e.toUpperCase()in at.signals?new TypeError(`Invalid ${t} '${e}': please rename it to '${e.toUpperCase()}'.`):new TypeError(`Invalid ${t} '${e}': this signal name does not exist.
${ho()}`)},ho=()=>`Available signal names: ${Cy()}.
Available signal numbers: ${_y()}.`,Cy=()=>Object.keys(at.signals).sort().map(e=>`'${e}'`).join(", "),_y=()=>[...new Set(Object.values(at.signals).sort((e,t)=>e-t))].join(", "),Kt=e=>Gc[e].description;var Vc=e=>{if(e===!1)return e;if(e===!0)return Ay;if(!Number.isFinite(e)||e<0)throw new TypeError(`Expected the \`forceKillAfterDelay\` option to be a non-negative integer, got \`${e}\` (${typeof e})`);return e},Ay=1e3*5,Yc=({kill:e,options:{forceKillAfterDelay:t,killSignal:r},onInternalError:n,context:o,controller:s},i,a)=>{let{signal:c,error:l}=vy(i,a,r);Iy(l,n);let u=e(c);return Oy({kill:e,signal:c,forceKillAfterDelay:t,killSignal:r,killResult:u,context:o,controller:s}),u},vy=(e,t,r)=>{let[n=r,o]=Yt(e)?[void 0,e]:[e,t];if(typeof n!="string"&&!Number.isInteger(n))throw new TypeError(`The first argument must be an error instance or a signal name string/integer: ${String(n)}`);if(o!==void 0&&!Yt(o))throw new TypeError(`The second argument is optional. If specified, it must be an error instance: ${o}`);return{signal:zc(n),error:o}},Iy=(e,t)=>{e!==void 0&&t.reject(e)},Oy=async({kill:e,signal:t,forceKillAfterDelay:r,killSignal:n,killResult:o,context:s,controller:i})=>{t===n&&o&&mo({kill:e,forceKillAfterDelay:r,context:s,controllerSignal:i.signal})},mo=async({kill:e,forceKillAfterDelay:t,context:r,controllerSignal:n})=>{if(t!==!1)try{await Ry(t,void 0,{signal:n}),e("SIGKILL")&&(r.isForcefullyTerminated??=!0)}catch{}};import{once as Dy}from"events";var Xt=async(e,t)=>{e.aborted||await Dy(e,"abort",{signal:t})};var Kc=({cancelSignal:e})=>{if(e!==void 0&&Object.prototype.toString.call(e)!=="[object AbortSignal]")throw new Error(`The \`cancelSignal\` option must be an AbortSignal: ${String(e)}`)},Xc=({subprocess:e,cancelSignal:t,gracefulCancel:r,context:n,controller:o})=>t===void 0||r?[]:[My(e,t,n,o)],My=async(e,t,r,{signal:n})=>{throw await Xt(t,n),r.terminationReason??="cancel",e.kill(),t.reason};import{scheduler as Zy}from"timers/promises";import{promisify as Ky}from"util";var ke=({methodName:e,isSubprocess:t,ipc:r,isConnected:n})=>{Py(e,t,r),go(e,t,n)},Py=(e,t,r)=>{if(!r)throw new Error(`${j(e,t)} can only be used if the \`ipc\` option is \`true\`.`)},go=(e,t,r)=>{if(!r)throw new Error(`${j(e,t)} cannot be used: the ${ie(t)} has already exited or disconnected.`)},Jc=e=>{throw new Error(`${j("getOneMessage",e)} could not complete: the ${ie(e)} exited or disconnected.`)},Zc=e=>{throw new Error(`${j("sendMessage",e)} failed: the ${ie(e)} is sending a message too, instead of listening to incoming messages.
This can be fixed by both sending a message and listening to incoming messages at the same time:

const [receivedMessage] = await Promise.all([
	${j("getOneMessage",e)},
	${j("sendMessage",e,"message, {strict: true}")},
]);`)},Jt=(e,t)=>new Error(`${j("sendMessage",t)} failed when sending an acknowledgment response to the ${ie(t)}.`,{cause:e}),el=e=>{throw new Error(`${j("sendMessage",e)} failed: the ${ie(e)} is not listening to incoming messages.`)},tl=e=>{throw new Error(`${j("sendMessage",e)} failed: the ${ie(e)} exited without listening to incoming messages.`)},rl=()=>new Error(`\`cancelSignal\` aborted: the ${ie(!0)} disconnected.`),nl=()=>{throw new Error("`getCancelSignal()` cannot be used without setting the `cancelSignal` subprocess option.")},ol=({error:e,methodName:t,isSubprocess:r})=>{if(e.code==="EPIPE")throw new Error(`${j(t,r)} cannot be used: the ${ie(r)} is disconnecting.`,{cause:e})},sl=({error:e,methodName:t,isSubprocess:r,message:n})=>{if(Ly(e))throw new Error(`${j(t,r)}'s argument type is invalid: the message cannot be serialized: ${String(n)}.`,{cause:e})},Ly=({code:e,message:t})=>ky.has(e)||$y.some(r=>t.includes(r)),ky=new Set(["ERR_MISSING_ARGS","ERR_INVALID_ARG_TYPE"]),$y=["could not be cloned","circular structure","call stack size exceeded"],j=(e,t,r="")=>e==="cancelSignal"?"`cancelSignal`'s `controller.abort()`":`${By(t)}${e}(${r})`,By=e=>e?"":"subprocess.",ie=e=>e?"parent process":"subprocess",$e=e=>{e.connected&&e.disconnect()};var z=()=>{let e={},t=new Promise((r,n)=>{Object.assign(e,{resolve:r,reject:n})});return Object.assign(t,e)};var er=(e,t="stdin")=>{let{options:n,fileDescriptors:o}=H.get(e),s=il(o,t,!0),i=e.stdio[s];if(i===null)throw new TypeError(al(s,t,n,!0));return i},Be=(e,t="stdout")=>{let{options:n,fileDescriptors:o}=H.get(e),s=il(o,t,!1),i=s==="all"?e.all:e.stdio[s];if(i==null)throw new TypeError(al(s,t,n,!1));return i},H=new WeakMap,il=(e,t,r)=>{let n=Ny(t,r);return Fy(n,t,r,e),n},Ny=(e,t)=>{let r=Jn(e);if(r!==void 0)return r;let{validOptions:n,defaultValue:o}=t?{validOptions:'"stdin"',defaultValue:"stdin"}:{validOptions:'"stdout", "stderr", "all"',defaultValue:"stdout"};throw new TypeError(`"${ct(t)}" must not be "${e}".
It must be ${n} or "fd3", "fd4" (and so on).
It is optional and defaults to "${o}".`)},Fy=(e,t,r,n)=>{let o=n[cl(e)];if(o===void 0)throw new TypeError(`"${ct(r)}" must not be ${t}. That file descriptor does not exist.
Please set the "stdio" option to ensure that file descriptor exists.`);if(o.direction==="input"&&!r)throw new TypeError(`"${ct(r)}" must not be ${t}. It must be a readable stream, not writable.`);if(o.direction!=="input"&&r)throw new TypeError(`"${ct(r)}" must not be ${t}. It must be a writable stream, not readable.`)},al=(e,t,r,n)=>{if(e==="all"&&!r.all)return`The "all" option must be true to use "from: 'all'".`;let{optionName:o,optionValue:s}=qy(e,r);return`The "${o}: ${Zt(s)}" option is incompatible with using "${ct(n)}: ${Zt(t)}".
Please set this option with "pipe" instead.`},qy=(e,{stdin:t,stdout:r,stderr:n,stdio:o})=>{let s=cl(e);return s===0&&t!==void 0?{optionName:"stdin",optionValue:t}:s===1&&r!==void 0?{optionName:"stdout",optionValue:r}:s===2&&n!==void 0?{optionName:"stderr",optionValue:n}:{optionName:`stdio[${s}]`,optionValue:o[s]}},cl=e=>e==="all"?1:e,ct=e=>e?"to":"from",Zt=e=>typeof e=="string"?`'${e}'`:typeof e=="number"?`${e}`:"Stream";import{once as zy}from"events";import{addAbortListener as Uy}from"events";var pe=(e,t,r)=>{let n=e.getMaxListeners();n===0||n===Number.POSITIVE_INFINITY||(e.setMaxListeners(n+t),Uy(r,()=>{e.setMaxListeners(e.getMaxListeners()-t)}))};import{EventEmitter as Qy}from"events";import{once as jy}from"events";import{scheduler as Gy}from"timers/promises";var tr=(e,t)=>{t&&yo(e)},yo=e=>{e.refCounted()},rr=(e,t)=>{t&&bo(e)},bo=e=>{e.unrefCounted()},ll=(e,t)=>{t&&(bo(e),bo(e))},ul=(e,t)=>{t&&(yo(e),yo(e))};var fl=async({anyProcess:e,channel:t,isSubprocess:r,ipcEmitter:n},o)=>{if(hl(o)||gl(o))return;nr.has(e)||nr.set(e,[]);let s=nr.get(e);if(s.push(o),!(s.length>1))for(;s.length>0;){await ml(e,n,o),await Gy.yield();let i=await pl({wrappedMessage:s[0],anyProcess:e,channel:t,isSubprocess:r,ipcEmitter:n});s.shift(),n.emit("message",i),n.emit("message:done")}},dl=async({anyProcess:e,channel:t,isSubprocess:r,ipcEmitter:n,boundOnMessage:o})=>{So();let s=nr.get(e);for(;s?.length>0;)await jy(n,"message:done");e.removeListener("message",o),ul(t,r),n.connected=!1,n.emit("disconnect")},nr=new WeakMap;var ae=(e,t,r)=>{if(or.has(e))return or.get(e);let n=new Qy;return n.connected=!0,or.set(e,n),Wy({ipcEmitter:n,anyProcess:e,channel:t,isSubprocess:r}),n},or=new WeakMap,Wy=({ipcEmitter:e,anyProcess:t,channel:r,isSubprocess:n})=>{let o=fl.bind(void 0,{anyProcess:t,channel:r,isSubprocess:n,ipcEmitter:e});t.on("message",o),t.once("disconnect",dl.bind(void 0,{anyProcess:t,channel:r,isSubprocess:n,ipcEmitter:e,boundOnMessage:o})),ll(r,n)},sr=e=>{let t=or.get(e);return t===void 0?e.channel!==null:t.connected};var yl=({anyProcess:e,channel:t,isSubprocess:r,message:n,strict:o})=>{if(!o)return n;let s=ae(e,t,r),i=cr(e,s);return{id:Hy++,type:ar,message:n,hasListeners:i}},Hy=0n,bl=(e,t)=>{if(!(t?.type!==ar||t.hasListeners))for(let{id:r}of e)r!==void 0&&ir[r].resolve({isDeadlock:!0,hasListeners:!1})},pl=async({wrappedMessage:e,anyProcess:t,channel:r,isSubprocess:n,ipcEmitter:o})=>{if(e?.type!==ar||!t.connected)return e;let{id:s,message:i}=e,a={id:s,type:wl,message:cr(t,o)};try{await lr({anyProcess:t,channel:r,isSubprocess:n,ipc:!0},a)}catch(c){o.emit("strict:error",c)}return i},hl=e=>{if(e?.type!==wl)return!1;let{id:t,message:r}=e;return ir[t]?.resolve({isDeadlock:!1,hasListeners:r}),!0},Sl=async(e,t,r)=>{if(e?.type!==ar)return;let n=z();ir[e.id]=n;let o=new AbortController;try{let{isDeadlock:s,hasListeners:i}=await Promise.race([n,Vy(t,r,o)]);s&&Zc(r),i||el(r)}finally{o.abort(),delete ir[e.id]}},ir={},Vy=async(e,t,{signal:r})=>{pe(e,1,r),await zy(e,"disconnect",{signal:r}),tl(t)},ar="execa:ipc:request",wl="execa:ipc:response";var El=(e,t,r)=>{lt.has(e)||lt.set(e,new Set);let n=lt.get(e),o=z(),s=r?t.id:void 0,i={onMessageSent:o,id:s};return n.add(i),{outgoingMessages:n,outgoingMessage:i}},xl=({outgoingMessages:e,outgoingMessage:t})=>{e.delete(t),t.onMessageSent.resolve()},ml=async(e,t,r)=>{for(;!cr(e,t)&&lt.get(e)?.size>0;){let n=[...lt.get(e)];bl(n,r),await Promise.all(n.map(({onMessageSent:o})=>o))}},lt=new WeakMap,cr=(e,t)=>t.listenerCount("message")>Yy(e),Yy=e=>H.has(e)&&!J(H.get(e).options.buffer,"ipc")?1:0;var lr=({anyProcess:e,channel:t,isSubprocess:r,ipc:n},o,{strict:s=!1}={})=>{let i="sendMessage";return ke({methodName:i,isSubprocess:r,ipc:n,isConnected:e.connected}),Xy({anyProcess:e,channel:t,methodName:i,isSubprocess:r,message:o,strict:s})},Xy=async({anyProcess:e,channel:t,methodName:r,isSubprocess:n,message:o,strict:s})=>{let i=yl({anyProcess:e,channel:t,isSubprocess:n,message:o,strict:s}),a=El(e,i,s);try{await Eo({anyProcess:e,methodName:r,isSubprocess:n,wrappedMessage:i,message:o})}catch(c){throw $e(e),c}finally{xl(a)}},Eo=async({anyProcess:e,methodName:t,isSubprocess:r,wrappedMessage:n,message:o})=>{let s=Jy(e);try{await Promise.all([Sl(n,e,r),s(n)])}catch(i){throw ol({error:i,methodName:t,isSubprocess:r}),sl({error:i,methodName:t,isSubprocess:r,message:o}),i}},Jy=e=>{if(wo.has(e))return wo.get(e);let t=Ky(e.send.bind(e));return wo.set(e,t),t},wo=new WeakMap;var Cl=(e,t)=>{let r="cancelSignal";return go(r,!1,e.connected),Eo({anyProcess:e,methodName:r,isSubprocess:!1,wrappedMessage:{type:Rl,message:t},message:t})},_l=async({anyProcess:e,channel:t,isSubprocess:r,ipc:n})=>(await eb({anyProcess:e,channel:t,isSubprocess:r,ipc:n}),xo.signal),eb=async({anyProcess:e,channel:t,isSubprocess:r,ipc:n})=>{if(!Tl){if(Tl=!0,!n){nl();return}if(t===null){So();return}ae(e,t,r),await Zy.yield()}},Tl=!1,gl=e=>e?.type!==Rl?!1:(xo.abort(e.message),!0),Rl="execa:ipc:cancel",So=()=>{xo.abort(rl())},xo=new AbortController;var Al=({gracefulCancel:e,cancelSignal:t,ipc:r,serialization:n})=>{if(e){if(t===void 0)throw new Error("The `cancelSignal` option must be defined when setting the `gracefulCancel` option.");if(!r)throw new Error("The `ipc` option cannot be false when setting the `gracefulCancel` option.");if(n==="json")throw new Error("The `serialization` option cannot be 'json' when setting the `gracefulCancel` option.")}},vl=({subprocess:e,cancelSignal:t,gracefulCancel:r,forceKillAfterDelay:n,context:o,controller:s})=>r?[tb({subprocess:e,cancelSignal:t,forceKillAfterDelay:n,context:o,controller:s})]:[],tb=async({subprocess:e,cancelSignal:t,forceKillAfterDelay:r,context:n,controller:{signal:o}})=>{await Xt(t,o);let s=rb(t);throw await Cl(e,s),mo({kill:e.kill,forceKillAfterDelay:r,context:n,controllerSignal:o}),n.terminationReason??="gracefulCancel",t.reason},rb=({reason:e})=>{if(!(e instanceof DOMException))return e;let t=new Error(e.message);return Object.defineProperty(t,"stack",{value:e.stack,enumerable:!1,configurable:!0,writable:!0}),t};import{setTimeout as nb}from"timers/promises";var Il=({timeout:e})=>{if(e!==void 0&&(!Number.isFinite(e)||e<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`)},Ol=(e,t,r,n)=>t===0||t===void 0?[]:[ob(e,t,r,n)],ob=async(e,t,r,{signal:n})=>{throw await nb(t,void 0,{signal:n}),r.terminationReason??="timeout",e.kill(),new U};import{execPath as sb,execArgv as ib}from"process";import Dl from"path";var Ml=({options:e})=>{if(e.node===!1)throw new TypeError('The "node" option cannot be false with `execaNode()`.');return{options:{...e,node:!0}}},Pl=(e,t,{node:r=!1,nodePath:n=sb,nodeOptions:o=ib.filter(c=>!c.startsWith("--inspect")),cwd:s,execPath:i,...a})=>{if(i!==void 0)throw new TypeError('The "execPath" option has been removed. Please use the "nodePath" option instead.');let c=Oe(n,'The "nodePath" option'),l=Dl.resolve(s,c),u={...a,nodePath:l,node:r,cwd:s};if(!r)return[e,t,u];if(Dl.basename(e,".exe")==="node")throw new TypeError('When the "node" option is true, the first argument does not need to be "node".');return[l,[...o,e,...t],{ipc:!0,...u,shell:!1}]};import{serialize as ab}from"v8";var Ll=({ipcInput:e,ipc:t,serialization:r})=>{if(e!==void 0){if(!t)throw new Error("The `ipcInput` option cannot be set unless the `ipc` option is `true`.");ub[r](e)}},cb=e=>{try{ab(e)}catch(t){throw new Error("The `ipcInput` option is not serializable with a structured clone.",{cause:t})}},lb=e=>{try{JSON.stringify(e)}catch(t){throw new Error("The `ipcInput` option is not serializable with JSON.",{cause:t})}},ub={advanced:cb,json:lb},kl=async(e,t)=>{t!==void 0&&await e.sendMessage(t)};var Bl=({encoding:e})=>{if(To.has(e))return;let t=db(e);if(t!==void 0)throw new TypeError(`Invalid option \`encoding: ${ur(e)}\`.
Please rename it to ${ur(t)}.`);let r=[...To].map(n=>ur(n)).join(", ");throw new TypeError(`Invalid option \`encoding: ${ur(e)}\`.
Please rename it to one of: ${r}.`)},fb=new Set(["utf8","utf16le"]),L=new Set(["buffer","hex","base64","base64url","latin1","ascii"]),To=new Set([...fb,...L]),db=e=>{if(e===null)return"buffer";if(typeof e!="string")return;let t=e.toLowerCase();if(t in $l)return $l[t];if(To.has(t))return t},$l={"utf-8":"utf8","utf-16le":"utf16le","ucs-2":"utf16le",ucs2:"utf16le",binary:"latin1"},ur=e=>typeof e=="string"?`"${e}"`:String(e);import{statSync as pb}from"fs";import hb from"path";import mb from"process";var Nl=(e=Fl())=>{let t=Oe(e,'The "cwd" option');return hb.resolve(t)},Fl=()=>{try{return mb.cwd()}catch(e){throw e.message=`The current directory does not exist.
${e.message}`,e}},ql=(e,t)=>{if(t===Fl())return e;let r;try{r=pb(t)}catch(n){return`The "cwd" option is invalid: ${t}.
${n.message}
${e}`}return r.isDirectory()?e:`The "cwd" option is not a directory: ${t}.
${e}`};var fr=(e,t,r)=>{r.cwd=Nl(r.cwd);let[n,o,s]=Pl(e,t,r),{command:i,args:a,options:c}=jl.default._parse(n,o,s),l=va(c),u=yb(l);return Il(u),Bl(u),Ll(u),Kc(u),Al(u),u.shell=Vn(u.shell),u.env=bb(u),u.killSignal=Wc(u.killSignal),u.forceKillAfterDelay=Vc(u.forceKillAfterDelay),u.lines=u.lines.map((f,d)=>f&&!L.has(u.encoding)&&u.buffer[d]),Ul.platform==="win32"&&gb.basename(i,".exe")==="cmd"&&a.unshift("/q"),{file:i,commandArguments:a,options:u}},yb=({extendEnv:e=!0,preferLocal:t=!1,cwd:r,localDir:n=r,encoding:o="utf8",reject:s=!0,cleanup:i=!0,all:a=!1,windowsHide:c=!0,killSignal:l="SIGTERM",forceKillAfterDelay:u=!0,gracefulCancel:f=!1,ipcInput:d,ipc:p=d!==void 0||f,serialization:h="advanced",...S})=>({...S,extendEnv:e,preferLocal:t,cwd:r,localDirectory:n,encoding:o,reject:s,cleanup:i,all:a,windowsHide:c,killSignal:l,forceKillAfterDelay:u,gracefulCancel:f,ipcInput:d,ipc:p,serialization:h}),bb=({env:e,extendEnv:t,preferLocal:r,node:n,localDirectory:o,nodePath:s})=>{let i=t?{...Ul.env,...e}:e;return r||n?Lc({env:i,cwd:o,execPath:s,preferLocal:r,addExecPath:n}):i};import{inspect as Jb}from"util";function Ne(e){if(typeof e=="string")return Sb(e);if(!(ArrayBuffer.isView(e)&&e.BYTES_PER_ELEMENT===1))throw new Error("Input must be a string or a Uint8Array");return wb(e)}var Sb=e=>e.at(-1)===Gl?e.slice(0,e.at(-2)===Ql?-2:-1):e,wb=e=>e.at(-1)===Eb?e.subarray(0,e.at(-2)===xb?-2:-1):e,Gl=`
`,Eb=Gl.codePointAt(0),Ql="\r",xb=Ql.codePointAt(0);import{on as Vb}from"events";import{finished as Yb}from"stream/promises";function G(e,{checkOpen:t=!0}={}){return e!==null&&typeof e=="object"&&(e.writable||e.readable||!t||e.writable===void 0&&e.readable===void 0)&&typeof e.pipe=="function"}function Co(e,{checkOpen:t=!0}={}){return G(e,{checkOpen:t})&&(e.writable||!t)&&typeof e.write=="function"&&typeof e.end=="function"&&typeof e.writable=="boolean"&&typeof e.writableObjectMode=="boolean"&&typeof e.destroy=="function"&&typeof e.destroyed=="boolean"}function he(e,{checkOpen:t=!0}={}){return G(e,{checkOpen:t})&&(e.readable||!t)&&typeof e.read=="function"&&typeof e.readable=="boolean"&&typeof e.readableObjectMode=="boolean"&&typeof e.destroy=="function"&&typeof e.destroyed=="boolean"}function _o(e,t){return Co(e,t)&&he(e,t)}var Tb=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype),Ro=class{#t;#r;#e=!1;#n=void 0;constructor(t,r){this.#t=t,this.#r=r}next(){let t=()=>this.#s();return this.#n=this.#n?this.#n.then(t,t):t(),this.#n}return(t){let r=()=>this.#o(t);return this.#n?this.#n.then(r,r):r()}async#s(){if(this.#e)return{done:!0,value:void 0};let t;try{t=await this.#t.read()}catch(r){throw this.#n=void 0,this.#e=!0,this.#t.releaseLock(),r}return t.done&&(this.#n=void 0,this.#e=!0,this.#t.releaseLock()),t}async#o(t){if(this.#e)return{done:!0,value:t};if(this.#e=!0,!this.#r){let r=this.#t.cancel(t);return this.#t.releaseLock(),await r,{done:!0,value:t}}return this.#t.releaseLock(),{done:!0,value:t}}},Ao=Symbol();function Wl(){return this[Ao].next()}Object.defineProperty(Wl,"name",{value:"next"});function zl(e){return this[Ao].return(e)}Object.defineProperty(zl,"name",{value:"return"});var Cb=Object.create(Tb,{next:{enumerable:!0,configurable:!0,writable:!0,value:Wl},return:{enumerable:!0,configurable:!0,writable:!0,value:zl}});function vo({preventCancel:e=!1}={}){let t=this.getReader(),r=new Ro(t,e),n=Object.create(Cb);return n[Ao]=r,n}var Hl=e=>{if(he(e,{checkOpen:!1})&&ut.on!==void 0)return Rb(e);if(typeof e?.[Symbol.asyncIterator]=="function")return e;if(_b.call(e)==="[object ReadableStream]")return vo.call(e);throw new TypeError("The first argument must be a Readable, a ReadableStream, or an async iterable.")},{toString:_b}=Object.prototype,Rb=async function*(e){let t=new AbortController,r={};Ab(e,t,r);try{for await(let[n]of ut.on(e,"data",{signal:t.signal}))yield n}catch(n){if(r.error!==void 0)throw r.error;if(!t.signal.aborted)throw n}finally{e.destroy()}},Ab=async(e,t,r)=>{try{await ut.finished(e,{cleanup:!0,readable:!0,writable:!1,error:!1})}catch(n){r.error=n}finally{t.abort()}},ut={};var Fe=async(e,{init:t,convertChunk:r,getSize:n,truncateChunk:o,addChunk:s,getFinalChunk:i,finalize:a},{maxBuffer:c=Number.POSITIVE_INFINITY}={})=>{let l=Hl(e),u=t();u.length=0;try{for await(let f of l){let d=Ib(f),p=r[d](f,u);Kl({convertedChunk:p,state:u,getSize:n,truncateChunk:o,addChunk:s,maxBuffer:c})}return vb({state:u,convertChunk:r,getSize:n,truncateChunk:o,addChunk:s,getFinalChunk:i,maxBuffer:c}),a(u)}catch(f){let d=typeof f=="object"&&f!==null?f:new Error(f);throw d.bufferedData=a(u),d}},vb=({state:e,getSize:t,truncateChunk:r,addChunk:n,getFinalChunk:o,maxBuffer:s})=>{let i=o(e);i!==void 0&&Kl({convertedChunk:i,state:e,getSize:t,truncateChunk:r,addChunk:n,maxBuffer:s})},Kl=({convertedChunk:e,state:t,getSize:r,truncateChunk:n,addChunk:o,maxBuffer:s})=>{let i=r(e),a=t.length+i;if(a<=s){Vl(e,t,o,a);return}let c=n(e,s-t.length);throw c!==void 0&&Vl(c,t,o,s),new V},Vl=(e,t,r,n)=>{t.contents=r(e,t,n),t.length=n},Ib=e=>{let t=typeof e;if(t==="string")return"string";if(t!=="object"||e===null)return"others";if(globalThis.Buffer?.isBuffer(e))return"buffer";let r=Yl.call(e);return r==="[object ArrayBuffer]"?"arrayBuffer":r==="[object DataView]"?"dataView":Number.isInteger(e.byteLength)&&Number.isInteger(e.byteOffset)&&Yl.call(e.buffer)==="[object ArrayBuffer]"?"typedArray":"others"},{toString:Yl}=Object.prototype,V=class extends Error{name="MaxBufferError";constructor(){super("maxBuffer exceeded")}};var Z=e=>e,ft=()=>{},dr=({contents:e})=>e,pr=e=>{throw new Error(`Streams in object mode are not supported: ${String(e)}`)},hr=e=>e.length;async function mr(e,t){return Fe(e,Pb,t)}var Ob=()=>({contents:[]}),Db=()=>1,Mb=(e,{contents:t})=>(t.push(e),t),Pb={init:Ob,convertChunk:{string:Z,buffer:Z,arrayBuffer:Z,dataView:Z,typedArray:Z,others:Z},getSize:Db,truncateChunk:ft,addChunk:Mb,getFinalChunk:ft,finalize:dr};async function gr(e,t){return Fe(e,jb,t)}var Lb=()=>({contents:new ArrayBuffer(0)}),kb=e=>$b.encode(e),$b=new TextEncoder,Xl=e=>new Uint8Array(e),Jl=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),Bb=(e,t)=>e.slice(0,t),Nb=(e,{contents:t,length:r},n)=>{let o=tu()?qb(t,n):Fb(t,n);return new Uint8Array(o).set(e,r),o},Fb=(e,t)=>{if(t<=e.byteLength)return e;let r=new ArrayBuffer(eu(t));return new Uint8Array(r).set(new Uint8Array(e),0),r},qb=(e,t)=>{if(t<=e.maxByteLength)return e.resize(t),e;let r=new ArrayBuffer(t,{maxByteLength:eu(t)});return new Uint8Array(r).set(new Uint8Array(e),0),r},eu=e=>Zl**Math.ceil(Math.log(e)/Math.log(Zl)),Zl=2,Ub=({contents:e,length:t})=>tu()?e:e.slice(0,t),tu=()=>"resize"in ArrayBuffer.prototype,jb={init:Lb,convertChunk:{string:kb,buffer:Xl,arrayBuffer:Xl,dataView:Jl,typedArray:Jl,others:pr},getSize:hr,truncateChunk:Bb,addChunk:Nb,getFinalChunk:ft,finalize:Ub};async function br(e,t){return Fe(e,Hb,t)}var Gb=()=>({contents:"",textDecoder:new TextDecoder}),yr=(e,{textDecoder:t})=>t.decode(e,{stream:!0}),Qb=(e,{contents:t})=>t+e,Wb=(e,t)=>e.slice(0,t),zb=({textDecoder:e})=>{let t=e.decode();return t===""?void 0:t},Hb={init:Gb,convertChunk:{string:Z,buffer:yr,arrayBuffer:yr,dataView:yr,typedArray:yr,others:pr},getSize:hr,truncateChunk:Wb,addChunk:Qb,getFinalChunk:zb,finalize:dr};Object.assign(ut,{on:Vb,finished:Yb});var ru=({error:e,stream:t,readableObjectMode:r,lines:n,encoding:o,fdNumber:s})=>{if(!(e instanceof V))throw e;if(s==="all")return e;let i=Kb(r,n,o);throw e.maxBufferInfo={fdNumber:s,unit:i},t.destroy(),e},Kb=(e,t,r)=>e?"objects":t?"lines":r==="buffer"?"bytes":"characters",nu=(e,t,r)=>{if(t.length!==r)return;let n=new V;throw n.maxBufferInfo={fdNumber:"ipc"},n},ou=(e,t)=>{let{streamName:r,threshold:n,unit:o}=Xb(e,t);return`Command's ${r} was larger than ${n} ${o}`},Xb=(e,t)=>{if(e?.maxBufferInfo===void 0)return{streamName:"output",threshold:t[1],unit:"bytes"};let{maxBufferInfo:{fdNumber:r,unit:n}}=e;delete e.maxBufferInfo;let o=J(t,r);return r==="ipc"?{streamName:"IPC output",threshold:o,unit:"messages"}:{streamName:Bt(r),threshold:o,unit:n}},su=(e,t,r)=>e?.code==="ENOBUFS"&&t!==null&&t.some(n=>n!==null&&n.length>Sr(r)),iu=(e,t,r)=>{if(!t)return e;let n=Sr(r);return e.length>n?e.slice(0,n):e},Sr=([,e])=>e;var cu=({stdio:e,all:t,ipcOutput:r,originalError:n,signal:o,signalDescription:s,exitCode:i,escapedCommand:a,timedOut:c,isCanceled:l,isGracefullyCanceled:u,isMaxBuffer:f,isForcefullyTerminated:d,forceKillAfterDelay:p,killSignal:h,maxBuffer:S,timeout:y,cwd:E})=>{let _=n?.code,A=Zb({originalError:n,timedOut:c,timeout:y,isMaxBuffer:f,maxBuffer:S,errorCode:_,signal:o,signalDescription:s,exitCode:i,isCanceled:l,isGracefullyCanceled:u,isForcefullyTerminated:d,forceKillAfterDelay:p,killSignal:h}),D=tS(n,E),Q=D===void 0?"":`
${D}`,te=`${A}: ${a}${Q}`,ue=t===void 0?[e[2],e[1]]:[t],Se=[te,...ue,...e.slice(3),r.map(re=>rS(re)).join(`
`)].map(re=>nt(Ne(nS(re)))).filter(Boolean).join(`

`);return{originalMessage:D,shortMessage:te,message:Se}},Zb=({originalError:e,timedOut:t,timeout:r,isMaxBuffer:n,maxBuffer:o,errorCode:s,signal:i,signalDescription:a,exitCode:c,isCanceled:l,isGracefullyCanceled:u,isForcefullyTerminated:f,forceKillAfterDelay:d,killSignal:p})=>{let h=eS(f,d);return t?`Command timed out after ${r} milliseconds${h}`:u?i===void 0?`Command was gracefully canceled with exit code ${c}`:f?`Command was gracefully canceled${h}`:`Command was gracefully canceled with ${i} (${a})`:l?`Command was canceled${h}`:n?`${ou(e,o)}${h}`:s!==void 0?`Command failed with ${s}${h}`:f?`Command was killed with ${p} (${Kt(p)})${h}`:i!==void 0?`Command was killed with ${i} (${a})`:c!==void 0?`Command failed with exit code ${c}`:"Command failed"},eS=(e,t)=>e?` and was forcefully terminated after ${t} milliseconds`:"",tS=(e,t)=>{if(e instanceof U)return;let r=Bc(e)?e.originalMessage:String(e?.message??e),n=nt(ql(r,t));return n===""?void 0:n},rS=e=>typeof e=="string"?e:Jb(e),nS=e=>Array.isArray(e)?e.map(t=>Ne(au(t))).filter(Boolean).join(`
`):au(e),au=e=>typeof e=="string"?e:v(e)?kt(e):"";var wr=({command:e,escapedCommand:t,stdio:r,all:n,ipcOutput:o,options:{cwd:s},startTime:i})=>lu({command:e,escapedCommand:t,cwd:s,durationMs:ro(i),failed:!1,timedOut:!1,isCanceled:!1,isGracefullyCanceled:!1,isTerminated:!1,isMaxBuffer:!1,isForcefullyTerminated:!1,exitCode:0,stdout:r[1],stderr:r[2],all:n,stdio:r,ipcOutput:o,pipedFrom:[]}),qe=({error:e,command:t,escapedCommand:r,fileDescriptors:n,options:o,startTime:s,isSync:i})=>dt({error:e,command:t,escapedCommand:r,startTime:s,timedOut:!1,isCanceled:!1,isGracefullyCanceled:!1,isMaxBuffer:!1,isForcefullyTerminated:!1,stdio:Array.from({length:n.length}),ipcOutput:[],options:o,isSync:i}),dt=({error:e,command:t,escapedCommand:r,startTime:n,timedOut:o,isCanceled:s,isGracefullyCanceled:i,isMaxBuffer:a,isForcefullyTerminated:c,exitCode:l,signal:u,stdio:f,all:d,ipcOutput:p,options:{timeoutDuration:h,timeout:S=h,forceKillAfterDelay:y,killSignal:E,cwd:_,maxBuffer:A},isSync:D})=>{let{exitCode:Q,signal:te,signalDescription:ue}=sS(l,u),{originalMessage:Se,shortMessage:re,message:jr}=cu({stdio:f,all:d,ipcOutput:p,originalError:e,signal:te,signalDescription:ue,exitCode:Q,escapedCommand:r,timedOut:o,isCanceled:s,isGracefullyCanceled:i,isMaxBuffer:a,isForcefullyTerminated:c,forceKillAfterDelay:y,killSignal:E,maxBuffer:A,timeout:S,cwd:_}),We=kc(e,jr,D);return Object.assign(We,oS({error:We,command:t,escapedCommand:r,startTime:n,timedOut:o,isCanceled:s,isGracefullyCanceled:i,isMaxBuffer:a,isForcefullyTerminated:c,exitCode:Q,signal:te,signalDescription:ue,stdio:f,all:d,ipcOutput:p,cwd:_,originalMessage:Se,shortMessage:re})),We},oS=({error:e,command:t,escapedCommand:r,startTime:n,timedOut:o,isCanceled:s,isGracefullyCanceled:i,isMaxBuffer:a,isForcefullyTerminated:c,exitCode:l,signal:u,signalDescription:f,stdio:d,all:p,ipcOutput:h,cwd:S,originalMessage:y,shortMessage:E})=>lu({shortMessage:E,originalMessage:y,command:t,escapedCommand:r,cwd:S,durationMs:ro(n),failed:!0,timedOut:o,isCanceled:s,isGracefullyCanceled:i,isTerminated:u!==void 0,isMaxBuffer:a,isForcefullyTerminated:c,exitCode:l,signal:u,signalDescription:f,code:e.cause?.code,stdout:d[1],stderr:d[2],all:p,stdio:d,ipcOutput:h,pipedFrom:[]}),lu=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),sS=(e,t)=>{let r=e===null?void 0:e,n=t===null?void 0:t,o=n===void 0?void 0:Kt(t);return{exitCode:r,signal:n,signalDescription:o}};var uu=e=>Number.isFinite(e)?e:0;function iS(e){return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5%24),minutes:Math.trunc(e/6e4%60),seconds:Math.trunc(e/1e3%60),milliseconds:Math.trunc(e%1e3),microseconds:Math.trunc(uu(e*1e3)%1e3),nanoseconds:Math.trunc(uu(e*1e6)%1e3)}}function aS(e){return{days:e/86400000n,hours:e/3600000n%24n,minutes:e/60000n%60n,seconds:e/1000n%60n,milliseconds:e%1000n,microseconds:0n,nanoseconds:0n}}function Io(e){switch(typeof e){case"number":{if(Number.isFinite(e))return iS(e);break}case"bigint":return aS(e)}throw new TypeError("Expected a finite number or bigint")}var cS=e=>e===0||e===0n,lS=(e,t)=>t===1||t===1n?e:`${e}s`,uS=1e-7,fS=24n*60n*60n*1000n;function Oo(e,t){let r=typeof e=="bigint";if(!r&&!Number.isFinite(e))throw new TypeError("Expected a finite number or bigint");t={...t};let n=e<0?"-":"";e=e<0?-e:e,t.colonNotation&&(t.compact=!1,t.formatSubMilliseconds=!1,t.separateMilliseconds=!1,t.verbose=!1),t.compact&&(t.unitCount=1,t.secondsDecimalDigits=0,t.millisecondsDecimalDigits=0);let o=[],s=(u,f)=>{let d=Math.floor(u*10**f+uS);return(Math.round(d)/10**f).toFixed(f)},i=(u,f,d,p)=>{if(!((o.length===0||!t.colonNotation)&&cS(u)&&!(t.colonNotation&&d==="m"))){if(p??=String(u),t.colonNotation){let h=p.includes(".")?p.split(".")[0].length:p.length,S=o.length>0?2:1;p="0".repeat(Math.max(0,S-h))+p}else p+=t.verbose?" "+lS(f,u):d;o.push(p)}},a=Io(e),c=BigInt(a.days);if(i(c/365n,"year","y"),i(c%365n,"day","d"),i(Number(a.hours),"hour","h"),i(Number(a.minutes),"minute","m"),t.separateMilliseconds||t.formatSubMilliseconds||!t.colonNotation&&e<1e3){let u=Number(a.seconds),f=Number(a.milliseconds),d=Number(a.microseconds),p=Number(a.nanoseconds);if(i(u,"second","s"),t.formatSubMilliseconds)i(f,"millisecond","ms"),i(d,"microsecond","\xB5s"),i(p,"nanosecond","ns");else{let h=f+d/1e3+p/1e6,S=typeof t.millisecondsDecimalDigits=="number"?t.millisecondsDecimalDigits:0,y=h>=1?Math.round(h):Math.ceil(h),E=S?h.toFixed(S):y;i(Number.parseFloat(E),"millisecond","ms",E)}}else{let u=(r?Number(e%fS):e)/1e3%60,f=typeof t.secondsDecimalDigits=="number"?t.secondsDecimalDigits:1,d=s(u,f),p=t.keepDecimalsOnWholeSeconds?d:d.replace(/\.0+$/,"");i(Number.parseFloat(p),"second","s",p)}if(o.length===0)return n+"0"+(t.verbose?" milliseconds":"ms");let l=t.colonNotation?":":" ";return typeof t.unitCount=="number"&&(o=o.slice(0,Math.max(t.unitCount,1))),n+o.join(l)}var fu=(e,t)=>{e.failed&&W({type:"error",verboseMessage:e.shortMessage,verboseInfo:t,result:e})};var du=(e,t)=>{De(t)&&(fu(e,t),dS(e,t))},dS=(e,t)=>{let r=`(done in ${Oo(e.durationMs)})`;W({type:"duration",verboseMessage:r,verboseInfo:t,result:e})};var Ue=(e,t,{reject:r})=>{if(du(e,t),e.failed&&r)throw e;return e};import{readFileSync as Fu}from"fs";var mu=(e,t)=>me(e)?"asyncGenerator":bu(e)?"generator":Er(e)?"fileUrl":yS(e)?"filePath":SS(e)?"webStream":G(e,{checkOpen:!1})?"native":v(e)?"uint8Array":wS(e)?"asyncIterable":ES(e)?"iterable":Po(e)?gu({transform:e},t):gS(e)?pS(e,t):"native",pS=(e,t)=>_o(e.transform,{checkOpen:!1})?hS(e,t):Po(e.transform)?gu(e,t):mS(e,t),hS=(e,t)=>(yu(e,t,"Duplex stream"),"duplex"),gu=(e,t)=>(yu(e,t,"web TransformStream"),"webTransform"),yu=({final:e,binary:t,objectMode:r},n,o)=>{pu(e,`${n}.final`,o),pu(t,`${n}.binary`,o),Do(r,`${n}.objectMode`)},pu=(e,t,r)=>{if(e!==void 0)throw new TypeError(`The \`${t}\` option can only be defined when using a generator, not a ${r}.`)},mS=({transform:e,final:t,binary:r,objectMode:n},o)=>{if(e!==void 0&&!hu(e))throw new TypeError(`The \`${o}.transform\` option must be a generator, a Duplex stream or a web TransformStream.`);if(_o(t,{checkOpen:!1}))throw new TypeError(`The \`${o}.final\` option must not be a Duplex stream.`);if(Po(t))throw new TypeError(`The \`${o}.final\` option must not be a web TransformStream.`);if(t!==void 0&&!hu(t))throw new TypeError(`The \`${o}.final\` option must be a generator.`);return Do(r,`${o}.binary`),Do(n,`${o}.objectMode`),me(e)||me(t)?"asyncGenerator":"generator"},Do=(e,t)=>{if(e!==void 0&&typeof e!="boolean")throw new TypeError(`The \`${t}\` option must use a boolean.`)},hu=e=>me(e)||bu(e),me=e=>Object.prototype.toString.call(e)==="[object AsyncGeneratorFunction]",bu=e=>Object.prototype.toString.call(e)==="[object GeneratorFunction]",gS=e=>R(e)&&(e.transform!==void 0||e.final!==void 0),Er=e=>Object.prototype.toString.call(e)==="[object URL]",Su=e=>Er(e)&&e.protocol!=="file:",yS=e=>R(e)&&Object.keys(e).length===1&&Mo(e.file),Mo=e=>typeof e=="string",wu=(e,t)=>e==="native"&&typeof t=="string"&&!bS.has(t),bS=new Set(["ipc","ignore","inherit","overlapped","pipe"]),Eu=e=>Object.prototype.toString.call(e)==="[object ReadableStream]",xr=e=>Object.prototype.toString.call(e)==="[object WritableStream]",SS=e=>Eu(e)||xr(e),Po=e=>Eu(e?.readable)&&xr(e?.writable),wS=e=>xu(e)&&typeof e[Symbol.asyncIterator]=="function",ES=e=>xu(e)&&typeof e[Symbol.iterator]=="function",xu=e=>typeof e=="object"&&e!==null,F=new Set(["generator","asyncGenerator","duplex","webTransform"]),Tr=new Set(["fileUrl","filePath","fileNumber"]),Lo=new Set(["fileUrl","filePath"]),Tu=new Set([...Lo,"webStream","nodeStream"]),Cu=new Set(["webTransform","duplex"]),ce={generator:"a generator",asyncGenerator:"an async generator",fileUrl:"a file URL",filePath:"a file path string",fileNumber:"a file descriptor number",webStream:"a web stream",nodeStream:"a Node.js stream",webTransform:"a web TransformStream",duplex:"a Duplex stream",native:"any value",iterable:"an iterable",asyncIterable:"an async iterable",string:"a string",uint8Array:"a Uint8Array"};var ko=(e,t,r,n)=>n==="output"?xS(e,t,r):TS(e,t,r),xS=(e,t,r)=>{let n=t!==0&&r[t-1].value.readableObjectMode;return{writableObjectMode:n,readableObjectMode:e??n}},TS=(e,t,r)=>{let n=t===0?e===!0:r[t-1].value.readableObjectMode,o=t!==r.length-1&&(e??n);return{writableObjectMode:n,readableObjectMode:o}},_u=(e,t)=>{let r=e.findLast(({type:n})=>F.has(n));return r===void 0?!1:t==="input"?r.value.writableObjectMode:r.value.readableObjectMode};var Ru=(e,t,r,n)=>[...e.filter(({type:o})=>!F.has(o)),...CS(e,t,r,n)],CS=(e,t,r,{encoding:n})=>{let o=e.filter(({type:i})=>F.has(i)),s=Array.from({length:o.length});for(let[i,a]of Object.entries(o))s[i]=_S({stdioItem:a,index:Number(i),newTransforms:s,optionName:t,direction:r,encoding:n});return IS(s,r)},_S=({stdioItem:e,stdioItem:{type:t},index:r,newTransforms:n,optionName:o,direction:s,encoding:i})=>t==="duplex"?RS({stdioItem:e,optionName:o}):t==="webTransform"?AS({stdioItem:e,index:r,newTransforms:n,direction:s}):vS({stdioItem:e,index:r,newTransforms:n,direction:s,encoding:i}),RS=({stdioItem:e,stdioItem:{value:{transform:t,transform:{writableObjectMode:r,readableObjectMode:n},objectMode:o=n}},optionName:s})=>{if(o&&!n)throw new TypeError(`The \`${s}.objectMode\` option can only be \`true\` if \`new Duplex({objectMode: true})\` is used.`);if(!o&&n)throw new TypeError(`The \`${s}.objectMode\` option cannot be \`false\` if \`new Duplex({objectMode: true})\` is used.`);return{...e,value:{transform:t,writableObjectMode:r,readableObjectMode:n}}},AS=({stdioItem:e,stdioItem:{value:t},index:r,newTransforms:n,direction:o})=>{let{transform:s,objectMode:i}=R(t)?t:{transform:t},{writableObjectMode:a,readableObjectMode:c}=ko(i,r,n,o);return{...e,value:{transform:s,writableObjectMode:a,readableObjectMode:c}}},vS=({stdioItem:e,stdioItem:{value:t},index:r,newTransforms:n,direction:o,encoding:s})=>{let{transform:i,final:a,binary:c=!1,preserveNewlines:l=!1,objectMode:u}=R(t)?t:{transform:t},f=c||L.has(s),{writableObjectMode:d,readableObjectMode:p}=ko(u,r,n,o);return{...e,value:{transform:i,final:a,binary:f,preserveNewlines:l,writableObjectMode:d,readableObjectMode:p}}},IS=(e,t)=>t==="input"?e.reverse():e;import $o from"process";var Au=(e,t,r)=>{let n=e.map(o=>OS(o,t));if(n.includes("input")&&n.includes("output"))throw new TypeError(`The \`${r}\` option must not be an array of both readable and writable values.`);return n.find(Boolean)??PS},OS=({type:e,value:t},r)=>DS[r]??vu[e](t),DS=["input","output","output"],je=()=>{},Bo=()=>"input",vu={generator:je,asyncGenerator:je,fileUrl:je,filePath:je,iterable:Bo,asyncIterable:Bo,uint8Array:Bo,webStream:e=>xr(e)?"output":"input",nodeStream(e){return he(e,{checkOpen:!1})?Co(e,{checkOpen:!1})?void 0:"input":"output"},webTransform:je,duplex:je,native(e){let t=MS(e);if(t!==void 0)return t;if(G(e,{checkOpen:!1}))return vu.nodeStream(e)}},MS=e=>{if([0,$o.stdin].includes(e))return"input";if([1,2,$o.stdout,$o.stderr].includes(e))return"output"},PS="output";var Iu=(e,t)=>t&&!e.includes("ipc")?[...e,"ipc"]:e;var Ou=({stdio:e,ipc:t,buffer:r,...n},o,s)=>{let i=LS(e,n).map((a,c)=>Du(a,c));return s?$S(i,r,o):Iu(i,t)},LS=(e,t)=>{if(e===void 0)return N.map(n=>t[n]);if(kS(t))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${N.map(n=>`\`${n}\``).join(", ")}`);if(typeof e=="string")return[e,e,e];if(!Array.isArray(e))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof e}\``);let r=Math.max(e.length,N.length);return Array.from({length:r},(n,o)=>e[o])},kS=e=>N.some(t=>e[t]!==void 0),Du=(e,t)=>Array.isArray(e)?e.map(r=>Du(r,t)):e??(t>=N.length?"ignore":"pipe"),$S=(e,t,r)=>e.map((n,o)=>!t[o]&&o!==0&&!Me(r,o)&&BS(n)?"ignore":n),BS=e=>e==="pipe"||Array.isArray(e)&&e.every(t=>t==="pipe");import{readFileSync as NS}from"fs";import FS from"tty";var Pu=({stdioItem:e,stdioItem:{type:t},isStdioArray:r,fdNumber:n,direction:o,isSync:s})=>!r||t!=="native"?e:s?qS({stdioItem:e,fdNumber:n,direction:o}):GS({stdioItem:e,fdNumber:n}),qS=({stdioItem:e,stdioItem:{value:t,optionName:r},fdNumber:n,direction:o})=>{let s=US({value:t,optionName:r,fdNumber:n,direction:o});if(s!==void 0)return s;if(G(t,{checkOpen:!1}))throw new TypeError(`The \`${r}: Stream\` option cannot both be an array and include a stream with synchronous methods.`);return e},US=({value:e,optionName:t,fdNumber:r,direction:n})=>{let o=jS(e,r);if(o!==void 0){if(n==="output")return{type:"fileNumber",value:o,optionName:t};if(FS.isatty(o))throw new TypeError(`The \`${t}: ${Zt(e)}\` option is invalid: it cannot be a TTY with synchronous methods.`);return{type:"uint8Array",value:X(NS(o)),optionName:t}}},jS=(e,t)=>{if(e==="inherit")return t;if(typeof e=="number")return e;let r=$t.indexOf(e);if(r!==-1)return r},GS=({stdioItem:e,stdioItem:{value:t,optionName:r},fdNumber:n})=>t==="inherit"?{type:"nodeStream",value:Mu(n,t,r),optionName:r}:typeof t=="number"?{type:"nodeStream",value:Mu(t,t,r),optionName:r}:G(t,{checkOpen:!1})?{type:"nodeStream",value:t,optionName:r}:e,Mu=(e,t,r)=>{let n=$t[e];if(n===void 0)throw new TypeError(`The \`${r}: ${t}\` option is invalid: no such standard stream.`);return n};var Lu=({input:e,inputFile:t},r)=>r===0?[...QS(e),...zS(t)]:[],QS=e=>e===void 0?[]:[{type:WS(e),value:e,optionName:"input"}],WS=e=>{if(he(e,{checkOpen:!1}))return"nodeStream";if(typeof e=="string")return"string";if(v(e))return"uint8Array";throw new Error("The `input` option must be a string, a Uint8Array or a Node.js Readable stream.")},zS=e=>e===void 0?[]:[{...HS(e),optionName:"inputFile"}],HS=e=>{if(Er(e))return{type:"fileUrl",value:e};if(Mo(e))return{type:"filePath",value:{file:e}};throw new Error("The `inputFile` option must be a file path string or a file URL.")};var ku=e=>e.filter((t,r)=>e.every((n,o)=>t.value!==n.value||r>=o||t.type==="generator"||t.type==="asyncGenerator")),$u=({stdioItem:{type:e,value:t,optionName:r},direction:n,fileDescriptors:o,isSync:s})=>{let i=VS(o,e);if(i.length!==0){if(s){YS({otherStdioItems:i,type:e,value:t,optionName:r,direction:n});return}if(Tu.has(e))return Bu({otherStdioItems:i,type:e,value:t,optionName:r,direction:n});Cu.has(e)&&XS({otherStdioItems:i,type:e,value:t,optionName:r})}},VS=(e,t)=>e.flatMap(({direction:r,stdioItems:n})=>n.filter(o=>o.type===t).map(o=>({...o,direction:r}))),YS=({otherStdioItems:e,type:t,value:r,optionName:n,direction:o})=>{Lo.has(t)&&Bu({otherStdioItems:e,type:t,value:r,optionName:n,direction:o})},Bu=({otherStdioItems:e,type:t,value:r,optionName:n,direction:o})=>{let s=e.filter(a=>KS(a,r));if(s.length===0)return;let i=s.find(a=>a.direction!==o);return Nu(i,n,t),o==="output"?s[0].stream:void 0},KS=({type:e,value:t},r)=>e==="filePath"?t.file===r.file:e==="fileUrl"?t.href===r.href:t===r,XS=({otherStdioItems:e,type:t,value:r,optionName:n})=>{let o=e.find(({value:{transform:s}})=>s===r.transform);Nu(o,n,t)},Nu=(e,t,r)=>{if(e!==void 0)throw new TypeError(`The \`${e.optionName}\` and \`${t}\` options must not target ${ce[r]} that is the same.`)};var Cr=(e,t,r,n)=>{let s=Ou(t,r,n).map((a,c)=>JS({stdioOption:a,fdNumber:c,options:t,isSync:n})),i=iw({initialFileDescriptors:s,addProperties:e,options:t,isSync:n});return t.stdio=i.map(({stdioItems:a})=>lw(a)),i},JS=({stdioOption:e,fdNumber:t,options:r,isSync:n})=>{let o=Bt(t),{stdioItems:s,isStdioArray:i}=ZS({stdioOption:e,fdNumber:t,options:r,optionName:o}),a=Au(s,t,o),c=s.map(f=>Pu({stdioItem:f,isStdioArray:i,fdNumber:t,direction:a,isSync:n})),l=Ru(c,o,a,r),u=_u(l,a);return sw(l,u),{direction:a,objectMode:u,stdioItems:l}},ZS=({stdioOption:e,fdNumber:t,options:r,optionName:n})=>{let s=[...(Array.isArray(e)?e:[e]).map(c=>ew(c,n)),...Lu(r,t)],i=ku(s),a=i.length>1;return tw(i,a,n),nw(i),{stdioItems:i,isStdioArray:a}},ew=(e,t)=>({type:mu(e,t),value:e,optionName:t}),tw=(e,t,r)=>{if(e.length===0)throw new TypeError(`The \`${r}\` option must not be an empty array.`);if(t){for(let{value:n,optionName:o}of e)if(rw.has(n))throw new Error(`The \`${o}\` option must not include \`${n}\`.`)}},rw=new Set(["ignore","ipc"]),nw=e=>{for(let t of e)ow(t)},ow=({type:e,value:t,optionName:r})=>{if(Su(t))throw new TypeError(`The \`${r}: URL\` option must use the \`file:\` scheme.
For example, you can use the \`pathToFileURL()\` method of the \`url\` core module.`);if(wu(e,t))throw new TypeError(`The \`${r}: { file: '...' }\` option must be used instead of \`${r}: '...'\`.`)},sw=(e,t)=>{if(!t)return;let r=e.find(({type:n})=>Tr.has(n));if(r!==void 0)throw new TypeError(`The \`${r.optionName}\` option cannot use both files and transforms in objectMode.`)},iw=({initialFileDescriptors:e,addProperties:t,options:r,isSync:n})=>{let o=[];try{for(let s of e)o.push(aw({fileDescriptor:s,fileDescriptors:o,addProperties:t,options:r,isSync:n}));return o}catch(s){throw No(o),s}},aw=({fileDescriptor:{direction:e,objectMode:t,stdioItems:r},fileDescriptors:n,addProperties:o,options:s,isSync:i})=>{let a=r.map(c=>cw({stdioItem:c,addProperties:o,direction:e,options:s,fileDescriptors:n,isSync:i}));return{direction:e,objectMode:t,stdioItems:a}},cw=({stdioItem:e,addProperties:t,direction:r,options:n,fileDescriptors:o,isSync:s})=>{let i=$u({stdioItem:e,direction:r,fileDescriptors:o,isSync:s});return i!==void 0?{...e,stream:i}:{...e,...t[r][e.type](e,n)}},No=e=>{for(let{stdioItems:t}of e)for(let{stream:r}of t)r!==void 0&&!q(r)&&r.destroy()},lw=e=>{if(e.length>1)return e.some(({value:n})=>n==="overlapped")?"overlapped":"pipe";let[{type:t,value:r}]=e;return t==="native"?r:"pipe"};var Uu=(e,t)=>Cr(fw,e,t,!0),Y=({type:e,optionName:t})=>{ju(t,ce[e])},uw=({optionName:e,value:t})=>((t==="ipc"||t==="overlapped")&&ju(e,`"${t}"`),{}),ju=(e,t)=>{throw new TypeError(`The \`${e}\` option cannot be ${t} with synchronous methods.`)},qu={generator(){},asyncGenerator:Y,webStream:Y,nodeStream:Y,webTransform:Y,duplex:Y,asyncIterable:Y,native:uw},fw={input:{...qu,fileUrl:({value:e})=>({contents:[X(Fu(e))]}),filePath:({value:{file:e}})=>({contents:[X(Fu(e))]}),fileNumber:Y,iterable:({value:e})=>({contents:[...e]}),string:({value:e})=>({contents:[e]}),uint8Array:({value:e})=>({contents:[e]})},output:{...qu,fileUrl:({value:e})=>({path:e}),filePath:({value:{file:e}})=>({path:e}),fileNumber:({value:e})=>({path:e}),iterable:Y,string:Y,uint8Array:Y}};var ee=(e,{stripFinalNewline:t},r)=>Fo(t,r)&&e!==void 0&&!Array.isArray(e)?Ne(e):e,Fo=(e,t)=>t==="all"?e[1]||e[2]:e[t];import{Transform as Mw,getDefaultHighWaterMark as Zu}from"stream";var _r=(e,t,r,n)=>e||r?void 0:Qu(t,n),Uo=(e,t,r)=>r?e.flatMap(n=>Gu(n,t)):Gu(e,t),Gu=(e,t)=>{let{transform:r,final:n}=Qu(t,{});return[...r(e),...n()]},Qu=(e,t)=>(t.previousChunks="",{transform:dw.bind(void 0,t,e),final:hw.bind(void 0,t)}),dw=function*(e,t,r){if(typeof r!="string"){yield r;return}let{previousChunks:n}=e,o=-1;for(let s=0;s<r.length;s+=1)if(r[s]===`
`){let i=pw(r,s,t,e),a=r.slice(o+1,s+1-i);n.length>0&&(a=qo(n,a),n=""),yield a,o=s}o!==r.length-1&&(n=qo(n,r.slice(o+1))),e.previousChunks=n},pw=(e,t,r,n)=>r?0:(n.isWindowsNewline=t!==0&&e[t-1]==="\r",n.isWindowsNewline?2:1),hw=function*({previousChunks:e}){e.length>0&&(yield e)},Wu=({binary:e,preserveNewlines:t,readableObjectMode:r,state:n})=>e||t||r?void 0:{transform:mw.bind(void 0,n)},mw=function*({isWindowsNewline:e=!1},t){let{unixNewline:r,windowsNewline:n,LF:o,concatBytes:s}=typeof t=="string"?gw:bw;if(t.at(-1)===o){yield t;return}yield s(t,e?n:r)},qo=(e,t)=>`${e}${t}`,gw={windowsNewline:`\r
`,unixNewline:`
`,LF:`
`,concatBytes:qo},yw=(e,t)=>{let r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},bw={windowsNewline:new Uint8Array([13,10]),unixNewline:new Uint8Array([10]),LF:10,concatBytes:yw};import{Buffer as Sw}from"buffer";var zu=(e,t)=>e?void 0:ww.bind(void 0,t),ww=function*(e,t){if(typeof t!="string"&&!v(t)&&!Sw.isBuffer(t))throw new TypeError(`The \`${e}\` option's transform must use "objectMode: true" to receive as input: ${typeof t}.`);yield t},Hu=(e,t)=>e?Ew.bind(void 0,t):xw.bind(void 0,t),Ew=function*(e,t){Vu(e,t),yield t},xw=function*(e,t){if(Vu(e,t),typeof t!="string"&&!v(t))throw new TypeError(`The \`${e}\` option's function must yield a string or an Uint8Array, not ${typeof t}.`);yield t},Vu=(e,t)=>{if(t==null)throw new TypeError(`The \`${e}\` option's function must not call \`yield ${t}\`.
Instead, \`yield\` should either be called with a value, or not be called at all. For example:
  if (condition) { yield value; }`)};import{Buffer as Tw}from"buffer";import{StringDecoder as Cw}from"string_decoder";var Rr=(e,t,r)=>{if(r)return;if(e)return{transform:_w.bind(void 0,new TextEncoder)};let n=new Cw(t);return{transform:Rw.bind(void 0,n),final:Aw.bind(void 0,n)}},_w=function*(e,t){Tw.isBuffer(t)?yield X(t):typeof t=="string"?yield e.encode(t):yield t},Rw=function*(e,t){yield v(t)?e.write(t):t},Aw=function*(e){let t=e.end();t!==""&&(yield t)};import{callbackify as Yu}from"util";var jo=Yu(async(e,t,r,n)=>{t.currentIterable=e(...r);try{for await(let o of t.currentIterable)n.push(o)}finally{delete t.currentIterable}}),Ar=async function*(e,t,r){if(r===t.length){yield e;return}let{transform:n=Iw}=t[r];for await(let o of n(e))yield*Ar(o,t,r+1)},Ku=async function*(e){for(let[t,{final:r}]of Object.entries(e))yield*vw(r,Number(t),e)},vw=async function*(e,t,r){if(e!==void 0)for await(let n of e())yield*Ar(n,r,t+1)},Xu=Yu(async({currentIterable:e},t)=>{if(e!==void 0){await(t?e.throw(t):e.return());return}if(t)throw t}),Iw=function*(e){yield e};var Go=(e,t,r,n)=>{try{for(let o of e(...t))r.push(o);n()}catch(o){n(o)}},Ju=(e,t)=>[...t.flatMap(r=>[...ge(r,e,0)]),...pt(e)],ge=function*(e,t,r){if(r===t.length){yield e;return}let{transform:n=Dw}=t[r];for(let o of n(e))yield*ge(o,t,r+1)},pt=function*(e){for(let[t,{final:r}]of Object.entries(e))yield*Ow(r,Number(t),e)},Ow=function*(e,t,r){if(e!==void 0)for(let n of e())yield*ge(n,r,t+1)},Dw=function*(e){yield e};var Qo=({value:e,value:{transform:t,final:r,writableObjectMode:n,readableObjectMode:o},optionName:s},{encoding:i})=>{let a={},c=ef(e,i,s),l=me(t),u=me(r),f=l?jo.bind(void 0,Ar,a):Go.bind(void 0,ge),d=l||u?jo.bind(void 0,Ku,a):Go.bind(void 0,pt),p=l||u?Xu.bind(void 0,a):void 0;return{stream:new Mw({writableObjectMode:n,writableHighWaterMark:Zu(n),readableObjectMode:o,readableHighWaterMark:Zu(o),transform(S,y,E){f([S,c,0],this,E)},flush(S){d([c],this,S)},destroy:p})}},vr=(e,t,r,n)=>{let o=t.filter(({type:i})=>i==="generator"),s=n?o.reverse():o;for(let{value:i,optionName:a}of s){let c=ef(i,r,a);e=Ju(c,e)}return e},ef=({transform:e,final:t,binary:r,writableObjectMode:n,readableObjectMode:o,preserveNewlines:s},i,a)=>{let c={};return[{transform:zu(n,a)},Rr(r,i,n),_r(r,s,n,c),{transform:e,final:t},{transform:Hu(o,a)},Wu({binary:r,preserveNewlines:s,readableObjectMode:o,state:c})].filter(Boolean)};var tf=(e,t)=>{for(let r of Pw(e))Lw(e,r,t)},Pw=e=>new Set(Object.entries(e).filter(([,{direction:t}])=>t==="input").map(([t])=>Number(t))),Lw=(e,t,r)=>{let{stdioItems:n}=e[t],o=n.filter(({contents:a})=>a!==void 0);if(o.length===0)return;if(t!==0){let[{type:a,optionName:c}]=o;throw new TypeError(`Only the \`stdin\` option, not \`${c}\`, can be ${ce[a]} with synchronous methods.`)}let i=o.map(({contents:a})=>a).map(a=>kw(a,n));r.input=rt(i)},kw=(e,t)=>{let r=vr(e,t,"utf8",!0);return $w(r),rt(r)},$w=e=>{let t=e.find(r=>typeof r!="string"&&!v(r));if(t!==void 0)throw new TypeError(`The \`stdin\` option is invalid: when passing objects as input, a transform must be used to serialize them to strings or Uint8Arrays: ${t}.`)};import{writeFileSync as qw,appendFileSync as Uw}from"fs";var Ir=({stdioItems:e,encoding:t,verboseInfo:r,fdNumber:n})=>n!=="all"&&Me(r,n)&&!L.has(t)&&Bw(n)&&(e.some(({type:o,value:s})=>o==="native"&&Nw.has(s))||e.every(({type:o})=>F.has(o))),Bw=e=>e===1||e===2,Nw=new Set(["pipe","overlapped"]),rf=async(e,t,r,n)=>{for await(let o of e)Fw(t)||of(o,r,n)},nf=(e,t,r)=>{for(let n of e)of(n,t,r)},Fw=e=>e._readableState.pipes.length>0,of=(e,t,r)=>{let n=Gt(e);W({type:"output",verboseMessage:n,fdNumber:t,verboseInfo:r})};var sf=({fileDescriptors:e,syncResult:{output:t},options:r,isMaxBuffer:n,verboseInfo:o})=>{if(t===null)return{output:Array.from({length:3})};let s={},i=new Set([]);return{output:t.map((c,l)=>jw({result:c,fileDescriptors:e,fdNumber:l,state:s,outputFiles:i,isMaxBuffer:n,verboseInfo:o},r)),...s}},jw=({result:e,fileDescriptors:t,fdNumber:r,state:n,outputFiles:o,isMaxBuffer:s,verboseInfo:i},{buffer:a,encoding:c,lines:l,stripFinalNewline:u,maxBuffer:f})=>{if(e===null)return;let d=iu(e,s,f),p=X(d),{stdioItems:h,objectMode:S}=t[r],y=Gw([p],h,c,n),{serializedResult:E,finalResult:_=E}=Qw({chunks:y,objectMode:S,encoding:c,lines:l,stripFinalNewline:u,fdNumber:r});Ww({serializedResult:E,fdNumber:r,state:n,verboseInfo:i,encoding:c,stdioItems:h,objectMode:S});let A=a[r]?_:void 0;try{return n.error===void 0&&zw(E,h,o),A}catch(D){return n.error=D,A}},Gw=(e,t,r,n)=>{try{return vr(e,t,r,!1)}catch(o){return n.error=o,e}},Qw=({chunks:e,objectMode:t,encoding:r,lines:n,stripFinalNewline:o,fdNumber:s})=>{if(t)return{serializedResult:e};if(r==="buffer")return{serializedResult:rt(e)};let i=Ea(e,r);return n[s]?{serializedResult:i,finalResult:Uo(i,!o[s],t)}:{serializedResult:i}},Ww=({serializedResult:e,fdNumber:t,state:r,verboseInfo:n,encoding:o,stdioItems:s,objectMode:i})=>{if(!Ir({stdioItems:s,encoding:o,verboseInfo:n,fdNumber:t}))return;let a=Uo(e,!1,i);try{nf(a,t,n)}catch(c){r.error??=c}},zw=(e,t,r)=>{for(let{path:n}of t.filter(({type:o})=>Tr.has(o))){let o=typeof n=="string"?n:n.toString();r.has(o)?Uw(n,e):(r.add(o),qw(n,e))}};var af=([,e,t],r)=>{if(r.all)return e===void 0?t:t===void 0?e:Array.isArray(e)?Array.isArray(t)?[...e,...t]:[...e,ee(t,r,"all")]:Array.isArray(t)?[ee(e,r,"all"),...t]:v(e)&&v(t)?Yn([e,t]):`${e}${t}`};import{once as Wo}from"events";var cf=async(e,t)=>{let[r,n]=await Hw(e);return t.isForcefullyTerminated??=!1,[r,n]},Hw=async e=>{let[t,r]=await Promise.allSettled([Wo(e,"spawn"),Wo(e,"exit")]);return t.status==="rejected"?[]:r.status==="rejected"?lf(e):r.value},lf=async e=>{try{return await Wo(e,"exit")}catch{return lf(e)}},uf=async e=>{let[t,r]=await e;if(!Vw(t,r)&&zo(t,r))throw new U;return[t,r]},Vw=(e,t)=>e===void 0&&t===void 0,zo=(e,t)=>e!==0||t!==null;var ff=({error:e,status:t,signal:r,output:n},{maxBuffer:o})=>{let s=Yw(e,t,r),i=s?.code==="ETIMEDOUT",a=su(s,n,o);return{resultError:s,exitCode:t,signal:r,timedOut:i,isMaxBuffer:a}},Yw=(e,t,r)=>e!==void 0?e:zo(t,r)?new U:void 0;var df=(e,t,r)=>{let{file:n,commandArguments:o,command:s,escapedCommand:i,startTime:a,verboseInfo:c,options:l,fileDescriptors:u}=Xw(e,t,r),f=eE({file:n,commandArguments:o,options:l,command:s,escapedCommand:i,verboseInfo:c,fileDescriptors:u,startTime:a});return Ue(f,c,l)},Xw=(e,t,r)=>{let{command:n,escapedCommand:o,startTime:s,verboseInfo:i}=Wt(e,t,r),a=Jw(r),{file:c,commandArguments:l,options:u}=fr(e,t,a);Zw(u);let f=Uu(u,i);return{file:c,commandArguments:l,command:n,escapedCommand:o,startTime:s,verboseInfo:i,options:u,fileDescriptors:f}},Jw=e=>e.node&&!e.ipc?{...e,ipc:!1}:e,Zw=({ipc:e,ipcInput:t,detached:r,cancelSignal:n})=>{t&&Or("ipcInput"),e&&Or("ipc: true"),r&&Or("detached: true"),n&&Or("cancelSignal")},Or=e=>{throw new TypeError(`The "${e}" option cannot be used with synchronous methods.`)},eE=({file:e,commandArguments:t,options:r,command:n,escapedCommand:o,verboseInfo:s,fileDescriptors:i,startTime:a})=>{let c=tE({file:e,commandArguments:t,options:r,command:n,escapedCommand:o,fileDescriptors:i,startTime:a});if(c.failed)return c;let{resultError:l,exitCode:u,signal:f,timedOut:d,isMaxBuffer:p}=ff(c,r),{output:h,error:S=l}=sf({fileDescriptors:i,syncResult:c,options:r,isMaxBuffer:p,verboseInfo:s}),y=h.map((_,A)=>ee(_,r,A)),E=ee(af(h,r),r,"all");return nE({error:S,exitCode:u,signal:f,timedOut:d,isMaxBuffer:p,stdio:y,all:E,options:r,command:n,escapedCommand:o,startTime:a})},tE=({file:e,commandArguments:t,options:r,command:n,escapedCommand:o,fileDescriptors:s,startTime:i})=>{try{tf(s,r);let a=rE(r);return Kw(e,t,a)}catch(a){return qe({error:a,command:n,escapedCommand:o,fileDescriptors:s,options:r,startTime:i,isSync:!0})}},rE=({encoding:e,maxBuffer:t,...r})=>({...r,encoding:"buffer",maxBuffer:Sr(t)}),nE=({error:e,exitCode:t,signal:r,timedOut:n,isMaxBuffer:o,stdio:s,all:i,options:a,command:c,escapedCommand:l,startTime:u})=>e===void 0?wr({command:c,escapedCommand:l,stdio:s,all:i,ipcOutput:[],options:a,startTime:u}):dt({error:e,command:c,escapedCommand:l,timedOut:n,isCanceled:!1,isGracefullyCanceled:!1,isMaxBuffer:o,isForcefullyTerminated:!1,exitCode:t,signal:r,stdio:s,all:i,ipcOutput:[],options:a,startTime:u,isSync:!0});import{setMaxListeners as Qx}from"events";import{spawn as Wx}from"child_process";import yf from"process";import{once as Ho,on as oE}from"events";var pf=({anyProcess:e,channel:t,isSubprocess:r,ipc:n},{reference:o=!0,filter:s}={})=>(ke({methodName:"getOneMessage",isSubprocess:r,ipc:n,isConnected:sr(e)}),sE({anyProcess:e,channel:t,isSubprocess:r,filter:s,reference:o})),sE=async({anyProcess:e,channel:t,isSubprocess:r,filter:n,reference:o})=>{tr(t,o);let s=ae(e,t,r),i=new AbortController;try{return await Promise.race([iE(s,n,i),aE(s,r,i),cE(s,r,i)])}catch(a){throw $e(e),a}finally{i.abort(),rr(t,o)}},iE=async(e,t,{signal:r})=>{if(t===void 0){let[n]=await Ho(e,"message",{signal:r});return n}for await(let[n]of oE(e,"message",{signal:r}))if(t(n))return n},aE=async(e,t,{signal:r})=>{await Ho(e,"disconnect",{signal:r}),Jc(t)},cE=async(e,t,{signal:r})=>{let[n]=await Ho(e,"strict:error",{signal:r});throw Jt(n,t)};import{once as mf,on as lE}from"events";var gf=({anyProcess:e,channel:t,isSubprocess:r,ipc:n},{reference:o=!0}={})=>Vo({anyProcess:e,channel:t,isSubprocess:r,ipc:n,shouldAwait:!r,reference:o}),Vo=({anyProcess:e,channel:t,isSubprocess:r,ipc:n,shouldAwait:o,reference:s})=>{ke({methodName:"getEachMessage",isSubprocess:r,ipc:n,isConnected:sr(e)}),tr(t,s);let i=ae(e,t,r),a=new AbortController,c={};return uE(e,i,a),fE({ipcEmitter:i,isSubprocess:r,controller:a,state:c}),dE({anyProcess:e,channel:t,ipcEmitter:i,isSubprocess:r,shouldAwait:o,controller:a,state:c,reference:s})},uE=async(e,t,r)=>{try{await mf(t,"disconnect",{signal:r.signal}),r.abort()}catch{}},fE=async({ipcEmitter:e,isSubprocess:t,controller:r,state:n})=>{try{let[o]=await mf(e,"strict:error",{signal:r.signal});n.error=Jt(o,t),r.abort()}catch{}},dE=async function*({anyProcess:e,channel:t,ipcEmitter:r,isSubprocess:n,shouldAwait:o,controller:s,state:i,reference:a}){try{for await(let[c]of lE(r,"message",{signal:s.signal}))hf(i),yield c}catch{hf(i)}finally{s.abort(),rr(t,a),n||$e(e),o&&await e}},hf=({error:e})=>{if(e)throw e};var bf=(e,{ipc:t})=>{Object.assign(e,wf(e,!1,t))},Sf=()=>{let e=yf,t=!0,r=yf.channel!==void 0;return{...wf(e,t,r),getCancelSignal:_l.bind(void 0,{anyProcess:e,channel:e.channel,isSubprocess:t,ipc:r})}},wf=(e,t,r)=>({sendMessage:lr.bind(void 0,{anyProcess:e,channel:e.channel,isSubprocess:t,ipc:r}),getOneMessage:pf.bind(void 0,{anyProcess:e,channel:e.channel,isSubprocess:t,ipc:r}),getEachMessage:gf.bind(void 0,{anyProcess:e,channel:e.channel,isSubprocess:t,ipc:r})});import{ChildProcess as pE}from"child_process";import{PassThrough as hE,Readable as mE,Writable as gE,Duplex as yE}from"stream";var Ef=({error:e,command:t,escapedCommand:r,fileDescriptors:n,options:o,startTime:s,verboseInfo:i})=>{No(n);let a=new pE;bE(a,n),Object.assign(a,{readable:SE,writable:wE,duplex:EE});let c=qe({error:e,command:t,escapedCommand:r,fileDescriptors:n,options:o,startTime:s,isSync:!1}),l=xE(c,i,o);return{subprocess:a,promise:l}},bE=(e,t)=>{let r=ht(),n=ht(),o=ht(),s=Array.from({length:t.length-3},ht),i=ht(),a=[r,n,o,...s];Object.assign(e,{stdin:r,stdout:n,stderr:o,all:i,stdio:a})},ht=()=>{let e=new hE;return e.end(),e},SE=()=>new mE({read(){}}),wE=()=>new gE({write(){}}),EE=()=>new yE({read(){},write(){}}),xE=async(e,t,r)=>Ue(e,t,r);import{createReadStream as xf,createWriteStream as Tf}from"fs";import{Buffer as TE}from"buffer";import{Readable as mt,Writable as CE,Duplex as _E}from"stream";var _f=(e,t)=>Cr(RE,e,t,!1),gt=({type:e,optionName:t})=>{throw new TypeError(`The \`${t}\` option cannot be ${ce[e]}.`)},Cf={fileNumber:gt,generator:Qo,asyncGenerator:Qo,nodeStream:({value:e})=>({stream:e}),webTransform({value:{transform:e,writableObjectMode:t,readableObjectMode:r}}){let n=t||r;return{stream:_E.fromWeb(e,{objectMode:n})}},duplex:({value:{transform:e}})=>({stream:e}),native(){}},RE={input:{...Cf,fileUrl:({value:e})=>({stream:xf(e)}),filePath:({value:{file:e}})=>({stream:xf(e)}),webStream:({value:e})=>({stream:mt.fromWeb(e)}),iterable:({value:e})=>({stream:mt.from(e)}),asyncIterable:({value:e})=>({stream:mt.from(e)}),string:({value:e})=>({stream:mt.from(e)}),uint8Array:({value:e})=>({stream:mt.from(TE.from(e))})},output:{...Cf,fileUrl:({value:e})=>({stream:Tf(e)}),filePath:({value:{file:e}})=>({stream:Tf(e)}),webStream:({value:e})=>({stream:CE.fromWeb(e)}),iterable:gt,asyncIterable:gt,string:gt,uint8Array:gt}};import{on as AE,once as Rf}from"events";import{PassThrough as vE,getDefaultHighWaterMark as IE}from"stream";import{finished as If}from"stream/promises";function ye(e){if(!Array.isArray(e))throw new TypeError(`Expected an array, got \`${typeof e}\`.`);for(let o of e)Ko(o);let t=e.some(({readableObjectMode:o})=>o),r=OE(e,t),n=new Yo({objectMode:t,writableHighWaterMark:r,readableHighWaterMark:r});for(let o of e)n.add(o);return n}var OE=(e,t)=>{if(e.length===0)return IE(t);let r=e.filter(({readableObjectMode:n})=>n===t).map(({readableHighWaterMark:n})=>n);return Math.max(...r)},Yo=class extends vE{#t=new Set([]);#r=new Set([]);#e=new Set([]);#n;#s=Symbol("unpipe");#o=new WeakMap;add(t){if(Ko(t),this.#t.has(t))return;this.#t.add(t),this.#n??=DE(this,this.#t,this.#s);let r=LE({passThroughStream:this,stream:t,streams:this.#t,ended:this.#r,aborted:this.#e,onFinished:this.#n,unpipeEvent:this.#s});this.#o.set(t,r),t.pipe(this,{end:!1})}async remove(t){if(Ko(t),!this.#t.has(t))return!1;let r=this.#o.get(t);return r===void 0?!1:(this.#o.delete(t),t.unpipe(this),await r,!0)}},DE=async(e,t,r)=>{Dr(e,Af);let n=new AbortController;try{await Promise.race([ME(e,n),PE(e,t,r,n)])}finally{n.abort(),Dr(e,-Af)}},ME=async(e,{signal:t})=>{try{await If(e,{signal:t,cleanup:!0})}catch(r){throw Of(e,r),r}},PE=async(e,t,r,{signal:n})=>{for await(let[o]of AE(e,"unpipe",{signal:n}))t.has(o)&&o.emit(r)},Ko=e=>{if(typeof e?.pipe!="function")throw new TypeError(`Expected a readable stream, got: \`${typeof e}\`.`)},LE=async({passThroughStream:e,stream:t,streams:r,ended:n,aborted:o,onFinished:s,unpipeEvent:i})=>{Dr(e,vf);let a=new AbortController;try{await Promise.race([kE(s,t,a),$E({passThroughStream:e,stream:t,streams:r,ended:n,aborted:o,controller:a}),BE({stream:t,streams:r,ended:n,aborted:o,unpipeEvent:i,controller:a})])}finally{a.abort(),Dr(e,-vf)}r.size>0&&r.size===n.size+o.size&&(n.size===0&&o.size>0?Xo(e):NE(e))},kE=async(e,t,{signal:r})=>{try{await e,r.aborted||Xo(t)}catch(n){r.aborted||Of(t,n)}},$E=async({passThroughStream:e,stream:t,streams:r,ended:n,aborted:o,controller:{signal:s}})=>{try{await If(t,{signal:s,cleanup:!0,readable:!0,writable:!1}),r.has(t)&&n.add(t)}catch(i){if(s.aborted||!r.has(t))return;Df(i)?o.add(t):Mf(e,i)}},BE=async({stream:e,streams:t,ended:r,aborted:n,unpipeEvent:o,controller:{signal:s}})=>{if(await Rf(e,o,{signal:s}),!e.readable)return Rf(s,"abort",{signal:s});t.delete(e),r.delete(e),n.delete(e)},NE=e=>{e.writable&&e.end()},Of=(e,t)=>{Df(t)?Xo(e):Mf(e,t)},Df=e=>e?.code==="ERR_STREAM_PREMATURE_CLOSE",Xo=e=>{(e.readable||e.writable)&&e.destroy()},Mf=(e,t)=>{e.destroyed||(e.once("error",FE),e.destroy(t))},FE=()=>{},Dr=(e,t)=>{let r=e.getMaxListeners();r!==0&&r!==Number.POSITIVE_INFINITY&&e.setMaxListeners(r+t)},Af=2,vf=1;import{finished as Pf}from"stream/promises";var Ge=(e,t)=>{e.pipe(t),qE(e,t),UE(e,t)},qE=async(e,t)=>{if(!(q(e)||q(t))){try{await Pf(e,{cleanup:!0,readable:!0,writable:!1})}catch{}Jo(t)}},Jo=e=>{e.writable&&e.end()},UE=async(e,t)=>{if(!(q(e)||q(t))){try{await Pf(t,{cleanup:!0,readable:!1,writable:!0})}catch{}Zo(e)}},Zo=e=>{e.readable&&e.destroy()};var Lf=(e,t,r)=>{let n=new Map;for(let[o,{stdioItems:s,direction:i}]of Object.entries(t)){for(let{stream:a}of s.filter(({type:c})=>F.has(c)))jE(e,a,i,o);for(let{stream:a}of s.filter(({type:c})=>!F.has(c)))QE({subprocess:e,stream:a,direction:i,fdNumber:o,pipeGroups:n,controller:r})}for(let[o,s]of n.entries()){let i=s.length===1?s[0]:ye(s);Ge(i,o)}},jE=(e,t,r,n)=>{r==="output"?Ge(e.stdio[n],t):Ge(t,e.stdio[n]);let o=GE[n];o!==void 0&&(e[o]=t),e.stdio[n]=t},GE=["stdin","stdout","stderr"],QE=({subprocess:e,stream:t,direction:r,fdNumber:n,pipeGroups:o,controller:s})=>{if(t===void 0)return;WE(t,s);let[i,a]=r==="output"?[t,e.stdio[n]]:[e.stdio[n],t],c=o.get(i)??[];o.set(i,[...c,a])},WE=(e,{signal:t})=>{q(e)&&pe(e,zE,t)},zE=2;import{addAbortListener as YE}from"events";var be=[];be.push("SIGHUP","SIGINT","SIGTERM");process.platform!=="win32"&&be.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");process.platform==="linux"&&be.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT");var Mr=e=>!!e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function",es=Symbol.for("signal-exit emitter"),ts=globalThis,HE=Object.defineProperty.bind(Object),rs=class{emitted={afterExit:!1,exit:!1};listeners={afterExit:[],exit:[]};count=0;id=Math.random();constructor(){if(ts[es])return ts[es];HE(ts,es,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(t,r){this.listeners[t].push(r)}removeListener(t,r){let n=this.listeners[t],o=n.indexOf(r);o!==-1&&(o===0&&n.length===1?n.length=0:n.splice(o,1))}emit(t,r,n){if(this.emitted[t])return!1;this.emitted[t]=!0;let o=!1;for(let s of this.listeners[t])o=s(r,n)===!0||o;return t==="exit"&&(o=this.emit("afterExit",r,n)||o),o}},Pr=class{},VE=e=>({onExit(t,r){return e.onExit(t,r)},load(){return e.load()},unload(){return e.unload()}}),ns=class extends Pr{onExit(){return()=>{}}load(){}unload(){}},os=class extends Pr{#t=ss.platform==="win32"?"SIGINT":"SIGHUP";#r=new rs;#e;#n;#s;#o={};#i=!1;constructor(t){super(),this.#e=t,this.#o={};for(let r of be)this.#o[r]=()=>{let n=this.#e.listeners(r),{count:o}=this.#r,s=t;if(typeof s.__signal_exit_emitter__=="object"&&typeof s.__signal_exit_emitter__.count=="number"&&(o+=s.__signal_exit_emitter__.count),n.length===o){this.unload();let i=this.#r.emit("exit",null,r),a=r==="SIGHUP"?this.#t:r;i||t.kill(t.pid,a)}};this.#s=t.reallyExit,this.#n=t.emit}onExit(t,r){if(!Mr(this.#e))return()=>{};this.#i===!1&&this.load();let n=r?.alwaysLast?"afterExit":"exit";return this.#r.on(n,t),()=>{this.#r.removeListener(n,t),this.#r.listeners.exit.length===0&&this.#r.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#i){this.#i=!0,this.#r.count+=1;for(let t of be)try{let r=this.#o[t];r&&this.#e.on(t,r)}catch{}this.#e.emit=(t,...r)=>this.#c(t,...r),this.#e.reallyExit=t=>this.#a(t)}}unload(){this.#i&&(this.#i=!1,be.forEach(t=>{let r=this.#o[t];if(!r)throw new Error("Listener not defined for signal: "+t);try{this.#e.removeListener(t,r)}catch{}}),this.#e.emit=this.#n,this.#e.reallyExit=this.#s,this.#r.count-=1)}#a(t){return Mr(this.#e)?(this.#e.exitCode=t||0,this.#r.emit("exit",this.#e.exitCode,null),this.#s.call(this.#e,this.#e.exitCode)):0}#c(t,...r){let n=this.#n;if(t==="exit"&&Mr(this.#e)){typeof r[0]=="number"&&(this.#e.exitCode=r[0]);let o=n.call(this.#e,t,...r);return this.#r.emit("exit",this.#e.exitCode,null),o}else return n.call(this.#e,t,...r)}},ss=globalThis.process,{onExit:kf,load:a1,unload:c1}=VE(Mr(ss)?new os(ss):new ns);var $f=(e,{cleanup:t,detached:r},{signal:n})=>{if(!t||r)return;let o=kf(()=>{e.kill()});YE(n,()=>{o()})};var Nf=({source:e,sourcePromise:t,boundOptions:r,createNested:n},...o)=>{let s=Qt(),{destination:i,destinationStream:a,destinationError:c,from:l,unpipeSignal:u}=KE(r,n,o),{sourceStream:f,sourceError:d}=JE(e,l),{options:p,fileDescriptors:h}=H.get(e);return{sourcePromise:t,sourceStream:f,sourceOptions:p,sourceError:d,destination:i,destinationStream:a,destinationError:c,unpipeSignal:u,fileDescriptors:h,startTime:s}},KE=(e,t,r)=>{try{let{destination:n,pipeOptions:{from:o,to:s,unpipeSignal:i}={}}=XE(e,t,...r),a=er(n,s);return{destination:n,destinationStream:a,from:o,unpipeSignal:i}}catch(n){return{destinationError:n}}},XE=(e,t,r,...n)=>{if(Array.isArray(r))return{destination:t(Bf,e)(r,...n),pipeOptions:e};if(typeof r=="string"||r instanceof URL){if(Object.keys(e).length>0)throw new TypeError('Please use .pipe("file", ..., options) or .pipe(execa("file", ..., options)) instead of .pipe(options)("file", ...).');let[o,s,i]=Lt(r,...n);return{destination:t(Bf)(o,s,i),pipeOptions:i}}if(H.has(r)){if(Object.keys(e).length>0)throw new TypeError("Please use .pipe(options)`command` or .pipe($(options)`command`) instead of .pipe(options)($`command`).");return{destination:r,pipeOptions:n[0]}}throw new TypeError(`The first argument must be a template string, an options object, or an Execa subprocess: ${r}`)},Bf=({options:e})=>({options:{...e,stdin:"pipe",piped:!0}}),JE=(e,t)=>{try{return{sourceStream:Be(e,t)}}catch(r){return{sourceError:r}}};var qf=({sourceStream:e,sourceError:t,destinationStream:r,destinationError:n,fileDescriptors:o,sourceOptions:s,startTime:i})=>{let a=ZE({sourceStream:e,sourceError:t,destinationStream:r,destinationError:n});if(a!==void 0)throw is({error:a,fileDescriptors:o,sourceOptions:s,startTime:i})},ZE=({sourceStream:e,sourceError:t,destinationStream:r,destinationError:n})=>{if(t!==void 0&&n!==void 0)return n;if(n!==void 0)return Zo(e),n;if(t!==void 0)return Jo(r),t},is=({error:e,fileDescriptors:t,sourceOptions:r,startTime:n})=>qe({error:e,command:Ff,escapedCommand:Ff,fileDescriptors:t,options:r,startTime:n,isSync:!1}),Ff="source.pipe(destination)";var Uf=async e=>{let[{status:t,reason:r,value:n=r},{status:o,reason:s,value:i=s}]=await e;if(i.pipedFrom.includes(n)||i.pipedFrom.push(n),o==="rejected")throw i;if(t==="rejected")throw n;return i};import{finished as ex}from"stream/promises";var jf=(e,t,r)=>{let n=Lr.has(t)?rx(e,t):tx(e,t);return pe(e,ox,r.signal),pe(t,sx,r.signal),nx(t),n},tx=(e,t)=>{let r=ye([e]);return Ge(r,t),Lr.set(t,r),r},rx=(e,t)=>{let r=Lr.get(t);return r.add(e),r},nx=async e=>{try{await ex(e,{cleanup:!0,readable:!1,writable:!0})}catch{}Lr.delete(e)},Lr=new WeakMap,ox=2,sx=1;import{aborted as ix}from"util";var Gf=(e,t)=>e===void 0?[]:[ax(e,t)],ax=async(e,{sourceStream:t,mergedStream:r,fileDescriptors:n,sourceOptions:o,startTime:s})=>{await ix(e,t),await r.remove(t);let i=new Error("Pipe canceled by `unpipeSignal` option.");throw is({error:i,fileDescriptors:n,sourceOptions:o,startTime:s})};var kr=(e,...t)=>{if(R(t[0]))return kr.bind(void 0,{...e,boundOptions:{...e.boundOptions,...t[0]}});let{destination:r,...n}=Nf(e,...t),o=cx({...n,destination:r});return o.pipe=kr.bind(void 0,{...e,source:r,sourcePromise:o,boundOptions:{}}),o},cx=async({sourcePromise:e,sourceStream:t,sourceOptions:r,sourceError:n,destination:o,destinationStream:s,destinationError:i,unpipeSignal:a,fileDescriptors:c,startTime:l})=>{let u=lx(e,o);qf({sourceStream:t,sourceError:n,destinationStream:s,destinationError:i,fileDescriptors:c,sourceOptions:r,startTime:l});let f=new AbortController;try{let d=jf(t,s,f);return await Promise.race([Uf(u),...Gf(a,{sourceStream:t,mergedStream:d,sourceOptions:r,fileDescriptors:c,startTime:l})])}finally{f.abort()}},lx=(e,t)=>Promise.allSettled([e,t]);import{setImmediate as gx}from"timers/promises";import{on as ux}from"events";import{getDefaultHighWaterMark as fx}from"stream";var $r=({subprocessStdout:e,subprocess:t,binary:r,shouldEncode:n,encoding:o,preserveNewlines:s})=>{let i=new AbortController;return dx(t,i),Wf({stream:e,controller:i,binary:r,shouldEncode:!e.readableObjectMode&&n,encoding:o,shouldSplit:!e.readableObjectMode,preserveNewlines:s})},dx=async(e,t)=>{try{await e}catch{}finally{t.abort()}},as=({stream:e,onStreamEnd:t,lines:r,encoding:n,stripFinalNewline:o,allMixed:s})=>{let i=new AbortController;px(t,i,e);let a=e.readableObjectMode&&!s;return Wf({stream:e,controller:i,binary:n==="buffer",shouldEncode:!a,encoding:n,shouldSplit:!a&&r,preserveNewlines:!o})},px=async(e,t,r)=>{try{await e}catch{r.destroy()}finally{t.abort()}},Wf=({stream:e,controller:t,binary:r,shouldEncode:n,encoding:o,shouldSplit:s,preserveNewlines:i})=>{let a=ux(e,"data",{signal:t.signal,highWaterMark:Qf,highWatermark:Qf});return hx({onStdoutChunk:a,controller:t,binary:r,shouldEncode:n,encoding:o,shouldSplit:s,preserveNewlines:i})},cs=fx(!0),Qf=cs,hx=async function*({onStdoutChunk:e,controller:t,binary:r,shouldEncode:n,encoding:o,shouldSplit:s,preserveNewlines:i}){let a=mx({binary:r,shouldEncode:n,encoding:o,shouldSplit:s,preserveNewlines:i});try{for await(let[c]of e)yield*ge(c,a,0)}catch(c){if(!t.signal.aborted)throw c}finally{yield*pt(a)}},mx=({binary:e,shouldEncode:t,encoding:r,shouldSplit:n,preserveNewlines:o})=>[Rr(e,r,!t),_r(e,o,!n,{})].filter(Boolean);var zf=async({stream:e,onStreamEnd:t,fdNumber:r,encoding:n,buffer:o,maxBuffer:s,lines:i,allMixed:a,stripFinalNewline:c,verboseInfo:l,streamInfo:u})=>{let f=yx({stream:e,onStreamEnd:t,fdNumber:r,encoding:n,allMixed:a,verboseInfo:l,streamInfo:u});if(!o){await Promise.all([bx(e),f]);return}let d=Fo(c,r),p=as({stream:e,onStreamEnd:t,lines:i,encoding:n,stripFinalNewline:d,allMixed:a}),[h]=await Promise.all([Sx({stream:e,iterable:p,fdNumber:r,encoding:n,maxBuffer:s,lines:i}),f]);return h},yx=async({stream:e,onStreamEnd:t,fdNumber:r,encoding:n,allMixed:o,verboseInfo:s,streamInfo:{fileDescriptors:i}})=>{if(!Ir({stdioItems:i[r]?.stdioItems,encoding:n,verboseInfo:s,fdNumber:r}))return;let a=as({stream:e,onStreamEnd:t,lines:!0,encoding:n,stripFinalNewline:!0,allMixed:o});await rf(a,e,r,s)},bx=async e=>{await gx(),e.readableFlowing===null&&e.resume()},Sx=async({stream:e,stream:{readableObjectMode:t},iterable:r,fdNumber:n,encoding:o,maxBuffer:s,lines:i})=>{try{return t||i?await mr(r,{maxBuffer:s}):o==="buffer"?new Uint8Array(await gr(r,{maxBuffer:s})):await br(r,{maxBuffer:s})}catch(a){return Hf(ru({error:a,stream:e,readableObjectMode:t,lines:i,encoding:o,fdNumber:n}))}},ls=async e=>{try{return await e}catch(t){return Hf(t)}},Hf=({bufferedData:e})=>Sa(e)?new Uint8Array(e):e;import{finished as wx}from"stream/promises";var yt=async(e,t,r,{isSameDirection:n,stopOnExit:o=!1}={})=>{let s=Ex(e,r),i=new AbortController;try{await Promise.race([...o?[r.exitPromise]:[],wx(e,{cleanup:!0,signal:i.signal})])}catch(a){s.stdinCleanedUp||Cx(a,t,r,n)}finally{i.abort()}},Ex=(e,{originalStreams:[t],subprocess:r})=>{let n={stdinCleanedUp:!1};return e===t&&xx(e,r,n),n},xx=(e,t,r)=>{let{_destroy:n}=e;e._destroy=(...o)=>{Tx(t,r),n.call(e,...o)}},Tx=({exitCode:e,signalCode:t},r)=>{(e!==null||t!==null)&&(r.stdinCleanedUp=!0)},Cx=(e,t,r,n)=>{if(!_x(e,t,r,n))throw e},_x=(e,t,r,n=!0)=>r.propagating?Vf(e)||Br(e):(r.propagating=!0,us(r,t)===n?Vf(e):Br(e)),us=({fileDescriptors:e},t)=>t!=="all"&&e[t].direction==="input",Br=e=>e?.code==="ERR_STREAM_PREMATURE_CLOSE",Vf=e=>e?.code==="EPIPE";var Yf=({subprocess:e,encoding:t,buffer:r,maxBuffer:n,lines:o,stripFinalNewline:s,verboseInfo:i,streamInfo:a})=>e.stdio.map((c,l)=>fs({stream:c,fdNumber:l,encoding:t,buffer:r[l],maxBuffer:n[l],lines:o[l],allMixed:!1,stripFinalNewline:s,verboseInfo:i,streamInfo:a})),fs=async({stream:e,fdNumber:t,encoding:r,buffer:n,maxBuffer:o,lines:s,allMixed:i,stripFinalNewline:a,verboseInfo:c,streamInfo:l})=>{if(!e)return;let u=yt(e,t,l);if(us(l,t)){await u;return}let[f]=await Promise.all([zf({stream:e,onStreamEnd:u,fdNumber:t,encoding:r,buffer:n,maxBuffer:o,lines:s,allMixed:i,stripFinalNewline:a,verboseInfo:c,streamInfo:l}),u]);return f};var Kf=({stdout:e,stderr:t},{all:r})=>r&&(e||t)?ye([e,t].filter(Boolean)):void 0,Xf=({subprocess:e,encoding:t,buffer:r,maxBuffer:n,lines:o,stripFinalNewline:s,verboseInfo:i,streamInfo:a})=>fs({...Rx(e,r),fdNumber:"all",encoding:t,maxBuffer:n[1]+n[2],lines:o[1]||o[2],allMixed:Ax(e),stripFinalNewline:s,verboseInfo:i,streamInfo:a}),Rx=({stdout:e,stderr:t,all:r},[,n,o])=>{let s=n||o;return s?n?o?{stream:r,buffer:s}:{stream:e,buffer:s}:{stream:t,buffer:s}:{stream:r,buffer:s}},Ax=({all:e,stdout:t,stderr:r})=>e&&t&&r&&t.readableObjectMode!==r.readableObjectMode;import{once as vx}from"events";var Jf=e=>Me(e,"ipc"),Zf=(e,t)=>{let r=Gt(e);W({type:"ipc",verboseMessage:r,fdNumber:"ipc",verboseInfo:t})};var ed=async({subprocess:e,buffer:t,maxBuffer:r,ipc:n,ipcOutput:o,verboseInfo:s})=>{if(!n)return o;let i=Jf(s),a=J(t,"ipc"),c=J(r,"ipc");for await(let l of Vo({anyProcess:e,channel:e.channel,isSubprocess:!1,ipc:n,shouldAwait:!1,reference:!0}))a&&(nu(e,o,c),o.push(l)),i&&Zf(l,s);return o},td=async(e,t)=>(await Promise.allSettled([e]),t);var rd=async({subprocess:e,options:{encoding:t,buffer:r,maxBuffer:n,lines:o,timeoutDuration:s,cancelSignal:i,gracefulCancel:a,forceKillAfterDelay:c,stripFinalNewline:l,ipc:u,ipcInput:f},context:d,verboseInfo:p,fileDescriptors:h,originalStreams:S,onInternalError:y,controller:E})=>{let _=cf(e,d),A={originalStreams:S,fileDescriptors:h,subprocess:e,exitPromise:_,propagating:!1},D=Yf({subprocess:e,encoding:t,buffer:r,maxBuffer:n,lines:o,stripFinalNewline:l,verboseInfo:p,streamInfo:A}),Q=Xf({subprocess:e,encoding:t,buffer:r,maxBuffer:n,lines:o,stripFinalNewline:l,verboseInfo:p,streamInfo:A}),te=[],ue=ed({subprocess:e,buffer:r,maxBuffer:n,ipc:u,ipcOutput:te,verboseInfo:p}),Se=Ix(S,e,A),re=Ox(h,A);try{return await Promise.race([Promise.all([{},uf(_),Promise.all(D),Q,ue,kl(e,f),...Se,...re]),y,Dx(e,E),...Ol(e,s,d,E),...Xc({subprocess:e,cancelSignal:i,gracefulCancel:a,context:d,controller:E}),...vl({subprocess:e,cancelSignal:i,gracefulCancel:a,forceKillAfterDelay:c,context:d,controller:E})])}catch(jr){return d.terminationReason??="other",Promise.all([{error:jr},_,Promise.all(D.map(We=>ls(We))),ls(Q),td(ue,te),Promise.allSettled(Se),Promise.allSettled(re)])}},Ix=(e,t,r)=>e.map((n,o)=>n===t.stdio[o]?void 0:yt(n,o,r)),Ox=(e,t)=>e.flatMap(({stdioItems:r},n)=>r.filter(({value:o,stream:s=o})=>G(s,{checkOpen:!1})&&!q(s)).map(({type:o,value:s,stream:i=s})=>yt(i,n,t,{isSameDirection:F.has(o),stopOnExit:o==="native"}))),Dx=async(e,{signal:t})=>{let[r]=await vx(e,"error",{signal:t});throw r};var nd=()=>({readableDestroy:new WeakMap,writableFinal:new WeakMap,writableDestroy:new WeakMap}),bt=(e,t,r)=>{let n=e[r];n.has(t)||n.set(t,[]);let o=n.get(t),s=z();return o.push(s),{resolve:s.resolve.bind(s),promises:o}},Qe=async({resolve:e,promises:t},r)=>{e();let[n]=await Promise.race([Promise.allSettled([!0,r]),Promise.all([!1,...t])]);return!n};import{Readable as Mx}from"stream";import{callbackify as Px}from"util";import{finished as od}from"stream/promises";var ds=async e=>{if(e!==void 0)try{await ps(e)}catch{}},sd=async e=>{if(e!==void 0)try{await hs(e)}catch{}},ps=async e=>{await od(e,{cleanup:!0,readable:!1,writable:!0})},hs=async e=>{await od(e,{cleanup:!0,readable:!0,writable:!1})},Nr=async(e,t)=>{if(await e,t)throw t},Fr=(e,t,r)=>{r&&!Br(r)?e.destroy(r):t&&e.destroy()};var id=({subprocess:e,concurrentStreams:t,encoding:r},{from:n,binary:o=!0,preserveNewlines:s=!0}={})=>{let i=o||L.has(r),{subprocessStdout:a,waitReadableDestroy:c}=ms(e,n,t),{readableEncoding:l,readableObjectMode:u,readableHighWaterMark:f}=gs(a,i),{read:d,onStdoutDataDone:p}=ys({subprocessStdout:a,subprocess:e,binary:i,encoding:r,preserveNewlines:s}),h=new Mx({read:d,destroy:Px(Ss.bind(void 0,{subprocessStdout:a,subprocess:e,waitReadableDestroy:c})),highWaterMark:f,objectMode:u,encoding:l});return bs({subprocessStdout:a,onStdoutDataDone:p,readable:h,subprocess:e}),h},ms=(e,t,r)=>{let n=Be(e,t),o=bt(r,n,"readableDestroy");return{subprocessStdout:n,waitReadableDestroy:o}},gs=({readableEncoding:e,readableObjectMode:t,readableHighWaterMark:r},n)=>n?{readableEncoding:e,readableObjectMode:t,readableHighWaterMark:r}:{readableEncoding:e,readableObjectMode:!0,readableHighWaterMark:cs},ys=({subprocessStdout:e,subprocess:t,binary:r,encoding:n,preserveNewlines:o})=>{let s=z(),i=$r({subprocessStdout:e,subprocess:t,binary:r,shouldEncode:!r,encoding:n,preserveNewlines:o});return{read(){Lx(this,i,s)},onStdoutDataDone:s}},Lx=async(e,t,r)=>{try{let{value:n,done:o}=await t.next();o?r.resolve():e.push(n)}catch{}},bs=async({subprocessStdout:e,onStdoutDataDone:t,readable:r,subprocess:n,subprocessStdin:o})=>{try{await hs(e),await n,await ds(o),await t,r.readable&&r.push(null)}catch(s){await ds(o),ad(r,s)}},Ss=async({subprocessStdout:e,subprocess:t,waitReadableDestroy:r},n)=>{await Qe(r,t)&&(ad(e,n),await Nr(t,n))},ad=(e,t)=>{Fr(e,e.readable,t)};import{Writable as kx}from"stream";import{callbackify as cd}from"util";var ld=({subprocess:e,concurrentStreams:t},{to:r}={})=>{let{subprocessStdin:n,waitWritableFinal:o,waitWritableDestroy:s}=ws(e,r,t),i=new kx({...Es(n,e,o),destroy:cd(Ts.bind(void 0,{subprocessStdin:n,subprocess:e,waitWritableFinal:o,waitWritableDestroy:s})),highWaterMark:n.writableHighWaterMark,objectMode:n.writableObjectMode});return xs(n,i),i},ws=(e,t,r)=>{let n=er(e,t),o=bt(r,n,"writableFinal"),s=bt(r,n,"writableDestroy");return{subprocessStdin:n,waitWritableFinal:o,waitWritableDestroy:s}},Es=(e,t,r)=>({write:$x.bind(void 0,e),final:cd(Bx.bind(void 0,e,t,r))}),$x=(e,t,r,n)=>{e.write(t,r)?n():e.once("drain",n)},Bx=async(e,t,r)=>{await Qe(r,t)&&(e.writable&&e.end(),await t)},xs=async(e,t,r)=>{try{await ps(e),t.writable&&t.end()}catch(n){await sd(r),ud(t,n)}},Ts=async({subprocessStdin:e,subprocess:t,waitWritableFinal:r,waitWritableDestroy:n},o)=>{await Qe(r,t),await Qe(n,t)&&(ud(e,o),await Nr(t,o))},ud=(e,t)=>{Fr(e,e.writable,t)};import{Duplex as Nx}from"stream";import{callbackify as Fx}from"util";var fd=({subprocess:e,concurrentStreams:t,encoding:r},{from:n,to:o,binary:s=!0,preserveNewlines:i=!0}={})=>{let a=s||L.has(r),{subprocessStdout:c,waitReadableDestroy:l}=ms(e,n,t),{subprocessStdin:u,waitWritableFinal:f,waitWritableDestroy:d}=ws(e,o,t),{readableEncoding:p,readableObjectMode:h,readableHighWaterMark:S}=gs(c,a),{read:y,onStdoutDataDone:E}=ys({subprocessStdout:c,subprocess:e,binary:a,encoding:r,preserveNewlines:i}),_=new Nx({read:y,...Es(u,e,f),destroy:Fx(qx.bind(void 0,{subprocessStdout:c,subprocessStdin:u,subprocess:e,waitReadableDestroy:l,waitWritableFinal:f,waitWritableDestroy:d})),readableHighWaterMark:S,writableHighWaterMark:u.writableHighWaterMark,readableObjectMode:h,writableObjectMode:u.writableObjectMode,encoding:p});return bs({subprocessStdout:c,onStdoutDataDone:E,readable:_,subprocess:e,subprocessStdin:u}),xs(u,_,c),_},qx=async({subprocessStdout:e,subprocessStdin:t,subprocess:r,waitReadableDestroy:n,waitWritableFinal:o,waitWritableDestroy:s},i)=>{await Promise.all([Ss({subprocessStdout:e,subprocess:r,waitReadableDestroy:n},i),Ts({subprocessStdin:t,subprocess:r,waitWritableFinal:o,waitWritableDestroy:s},i)])};var Cs=(e,t,{from:r,binary:n=!1,preserveNewlines:o=!1}={})=>{let s=n||L.has(t),i=Be(e,r),a=$r({subprocessStdout:i,subprocess:e,binary:s,shouldEncode:!0,encoding:t,preserveNewlines:o});return Ux(a,i,e)},Ux=async function*(e,t,r){try{yield*e}finally{t.readable&&t.destroy(),await r}};var dd=(e,{encoding:t})=>{let r=nd();e.readable=id.bind(void 0,{subprocess:e,concurrentStreams:r,encoding:t}),e.writable=ld.bind(void 0,{subprocess:e,concurrentStreams:r}),e.duplex=fd.bind(void 0,{subprocess:e,concurrentStreams:r,encoding:t}),e.iterable=Cs.bind(void 0,e,t),e[Symbol.asyncIterator]=Cs.bind(void 0,e,t,{})};var pd=(e,t)=>{for(let[r,n]of Gx){let o=n.value.bind(t);Reflect.defineProperty(e,r,{...n,value:o})}},jx=(async()=>{})().constructor.prototype,Gx=["then","catch","finally"].map(e=>[e,Reflect.getOwnPropertyDescriptor(jx,e)]);var hd=(e,t,r,n)=>{let{file:o,commandArguments:s,command:i,escapedCommand:a,startTime:c,verboseInfo:l,options:u,fileDescriptors:f}=zx(e,t,r),{subprocess:d,promise:p}=Vx({file:o,commandArguments:s,options:u,startTime:c,verboseInfo:l,command:i,escapedCommand:a,fileDescriptors:f});return d.pipe=kr.bind(void 0,{source:d,sourcePromise:p,boundOptions:{},createNested:n}),pd(d,p),H.set(d,{options:u,fileDescriptors:f}),d},zx=(e,t,r)=>{let{command:n,escapedCommand:o,startTime:s,verboseInfo:i}=Wt(e,t,r),{file:a,commandArguments:c,options:l}=fr(e,t,r),u=Hx(l),f=_f(u,i);return{file:a,commandArguments:c,command:n,escapedCommand:o,startTime:s,verboseInfo:i,options:u,fileDescriptors:f}},Hx=({timeout:e,signal:t,...r})=>{if(t!==void 0)throw new TypeError('The "signal" option has been renamed to "cancelSignal" instead.');return{...r,timeoutDuration:e}},Vx=({file:e,commandArguments:t,options:r,startTime:n,verboseInfo:o,command:s,escapedCommand:i,fileDescriptors:a})=>{let c;try{c=Wx(e,t,r)}catch(h){return Ef({error:h,command:s,escapedCommand:i,fileDescriptors:a,options:r,startTime:n,verboseInfo:o})}let l=new AbortController;Qx(Number.POSITIVE_INFINITY,l.signal);let u=[...c.stdio];Lf(c,a,l),$f(c,r,l);let f={},d=z();c.kill=Yc.bind(void 0,{kill:c.kill.bind(c),options:r,onInternalError:d,context:f,controller:l}),c.all=Kf(c,r),dd(c,r),bf(c,r);let p=Yx({subprocess:c,options:r,startTime:n,verboseInfo:o,fileDescriptors:a,originalStreams:u,command:s,escapedCommand:i,context:f,onInternalError:d,controller:l});return{subprocess:c,promise:p}},Yx=async({subprocess:e,options:t,startTime:r,verboseInfo:n,fileDescriptors:o,originalStreams:s,command:i,escapedCommand:a,context:c,onInternalError:l,controller:u})=>{let[f,[d,p],h,S,y]=await rd({subprocess:e,options:t,context:c,verboseInfo:n,fileDescriptors:o,originalStreams:s,onInternalError:l,controller:u});u.abort(),l.resolve();let E=h.map((D,Q)=>ee(D,t,Q)),_=ee(S,t,"all"),A=Kx({errorInfo:f,exitCode:d,signal:p,stdio:E,all:_,ipcOutput:y,context:c,options:t,command:i,escapedCommand:a,startTime:r});return Ue(A,n,t)},Kx=({errorInfo:e,exitCode:t,signal:r,stdio:n,all:o,ipcOutput:s,context:i,options:a,command:c,escapedCommand:l,startTime:u})=>"error"in e?dt({error:e.error,command:c,escapedCommand:l,timedOut:i.terminationReason==="timeout",isCanceled:i.terminationReason==="cancel"||i.terminationReason==="gracefulCancel",isGracefullyCanceled:i.terminationReason==="gracefulCancel",isMaxBuffer:e.error instanceof V,isForcefullyTerminated:i.isForcefullyTerminated,exitCode:t,signal:r,stdio:n,all:o,ipcOutput:s,options:a,startTime:u,isSync:!1}):wr({command:c,escapedCommand:l,stdio:n,all:o,ipcOutput:s,options:a,startTime:u});var qr=(e,t)=>{let r=Object.fromEntries(Object.entries(t).map(([n,o])=>[n,Xx(n,e[n],o)]));return{...e,...r}},Xx=(e,t,r)=>Jx.has(e)&&R(t)&&R(r)?{...t,...r}:r,Jx=new Set(["env",...Zn]);var le=(e,t,r,n)=>{let o=(i,a,c)=>le(i,a,r,c),s=(...i)=>Zx({mapArguments:e,deepOptions:r,boundOptions:t,setBoundExeca:n,createNested:o},...i);return n!==void 0&&n(s,o,t),s},Zx=({mapArguments:e,deepOptions:t={},boundOptions:r={},setBoundExeca:n,createNested:o},s,...i)=>{if(R(s))return o(e,qr(r,s),n);let{file:a,commandArguments:c,options:l,isSync:u}=eT({mapArguments:e,firstArgument:s,nextArguments:i,deepOptions:t,boundOptions:r});return u?df(a,c,l):hd(a,c,l,o)},eT=({mapArguments:e,firstArgument:t,nextArguments:r,deepOptions:n,boundOptions:o})=>{let s=_a(t)?Ra(t,r):[t,...r],[i,a,c]=Lt(...s),l=qr(qr(n,o),c),{file:u=i,commandArguments:f=a,options:d=l,isSync:p=!1}=e({file:i,commandArguments:a,options:l});return{file:u,commandArguments:f,options:d,isSync:p}};var md=({file:e,commandArguments:t})=>yd(e,t),gd=({file:e,commandArguments:t})=>({...yd(e,t),isSync:!0}),yd=(e,t)=>{if(t.length>0)throw new TypeError(`The command and its arguments must be passed as a single string: ${e} ${t}.`);let[r,...n]=tT(e);return{file:r,commandArguments:n}},tT=e=>{if(typeof e!="string")throw new TypeError(`The command must be a string: ${String(e)}.`);let t=e.trim();if(t==="")return[];let r=[];for(let n of t.split(rT)){let o=r.at(-1);o&&o.endsWith("\\")?r[r.length-1]=`${o.slice(0,-1)} ${n}`:r.push(n)}return r},rT=/ +/g;var bd=(e,t,r)=>{e.sync=t(nT,r),e.s=e.sync},Sd=({options:e})=>wd(e),nT=({options:e})=>({...wd(e),isSync:!0}),wd=e=>({options:{...oT(e),...e}}),oT=({input:e,inputFile:t,stdio:r})=>e===void 0&&t===void 0&&r===void 0?{stdin:"inherit"}:{},Ed={preferLocal:!0};var _s=le(()=>({})),YM=le(()=>({isSync:!0})),KM=le(md),XM=le(gd),JM=le(Ml),ZM=le(Sd,{},Ed,bd),{sendMessage:eP,getOneMessage:tP,getEachMessage:rP,getCancelSignal:nP}=Sf();import{unlinkSync as sT,existsSync as iT}from"fs";import{join as aT}from"path";import{cpus as cT}from"os";var Ur=class{sourceConfig;destConfig;sourcePool;destPool;preservedTables;stats;tempDir;dryRun;activeSyncTriggers=[];constructor(t,r,n=[],o=!1){this.sourceConfig=t,this.destConfig=r,this.sourcePool=new Hn(this.sourceConfig),this.destPool=new Hn(this.destConfig),this.preservedTables=new Set(n.map(s=>s.toLowerCase())),this.tempDir="/tmp",this.dryRun=o,this.stats={startTime:new Date,tablesProcessed:0,recordsMigrated:0,errors:[],warnings:[]}}async migrate(){try{this.log("\u{1F680} Starting database migration..."),this.log(`\u{1F4CA} Dry run mode: ${this.dryRun?"ENABLED":"DISABLED"}`),await this.performPreMigrationChecks();let t=await this.analyzeSchema(this.sourcePool,"source"),r=await this.analyzeSchema(this.destPool,"destination");if(this.log(`\u{1F4CB} Found ${t.length} source tables to migrate`),this.log(`\u{1F4CB} Found ${r.length} destination tables to backup`),this.log(`\u{1F512} Will restore ${this.preservedTables.size} preserved tables after migration`),this.dryRun){await this.performDryRun(t,r);return}await this.performCompleteMigration(t,r),this.stats.endTime=new Date,this.logSummary()}catch(t){throw this.logError("Migration failed",t),t}finally{await this.cleanup()}}async performPreMigrationChecks(){this.log("\u{1F50D} Performing pre-migration checks...");try{await this.sourcePool.query("SELECT 1"),this.log("\u2705 Source database connection successful")}catch(t){throw new Error(`Failed to connect to source database: ${t}`)}try{await this.destPool.query("SELECT 1"),this.log("\u2705 Destination database connection successful")}catch(t){throw new Error(`Failed to connect to destination database: ${t}`)}await this.ensureExtensions(),await this.checkDiskSpace()}async ensureExtensions(){let t=["postgis","uuid-ossp"];for(let r of t)try{await this.destPool.query(`CREATE EXTENSION IF NOT EXISTS "${r}"`),this.log(`\u2705 Extension ${r} is available`)}catch(n){this.stats.warnings.push(`Could not enable extension ${r}: ${n}`)}}async checkDiskSpace(){try{let t=await this.sourcePool.query(`
        SELECT pg_size_pretty(pg_database_size(current_database())) as size
      `);this.log(`\u{1F4CA} Source database size: ${t.rows[0].size}`)}catch(t){this.stats.warnings.push(`Could not determine database size: ${t}`)}}async analyzeSchema(t,r){this.log(`\u{1F52C} Analyzing ${r} database schema...`);let o=await t.query(`
      SELECT 
        c.relname as table_name,
        n.nspname as table_schema
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relkind = 'r'
        AND c.relname != 'spatial_ref_sys'
        AND c.relname != '_prisma_migrations'
      ORDER BY c.relname
    `),s=[];for(let i of o.rows){let a=await this.getTableInfo(t,i.table_schema,i.table_name);s.push(a)}return this.log(`\u{1F4CA} ${r} database has ${s.length} tables`),s}async getTableInfo(t,r,n){let i=(await t.query(`
      SELECT 
        column_name,
        data_type,
        is_nullable,
        column_default,
        character_maximum_length
      FROM information_schema.columns
      WHERE table_schema = $1 AND table_name = $2
      ORDER BY ordinal_position
    `,[r,n])).rows.map(y=>({columnName:y.column_name,dataType:y.data_type,isNullable:y.is_nullable==="YES",defaultValue:y.column_default,characterMaximumLength:y.character_maximum_length})),l=(await t.query(`
      SELECT 
        tc.constraint_name,
        tc.constraint_type,
        pg_get_constraintdef(c.oid) as definition
      FROM information_schema.table_constraints tc
      JOIN pg_constraint c ON c.conname = tc.constraint_name
      WHERE tc.table_schema = $1 AND tc.table_name = $2
    `,[r,n])).rows.map(y=>({constraintName:y.constraint_name,constraintType:y.constraint_type,definition:y.definition})),d=(await t.query(`
      SELECT 
        i.relname as index_name,
        pg_get_indexdef(i.oid) as definition,
        ix.indisunique as is_unique,
        am.amname as index_type
      FROM pg_class t
      JOIN pg_index ix ON t.oid = ix.indrelid
      JOIN pg_class i ON i.oid = ix.indexrelid
      JOIN pg_am am ON i.relam = am.oid
      WHERE t.relname = $1
        AND t.relnamespace = (SELECT oid FROM pg_namespace WHERE nspname = $2)
        AND NOT ix.indisprimary
    `,[n,r])).rows.map(y=>({indexName:y.index_name,definition:y.definition,isUnique:y.is_unique,indexType:y.index_type})),h=await t.query(`
      SELECT 
        pg_get_serial_sequence($1, column_name) as sequence_name,
        column_name
      FROM information_schema.columns
      WHERE table_schema = $2 AND table_name = $3
        AND column_default LIKE 'nextval%'
    `,[`"${n}"`,r,n]),S=[];for(let y of h.rows)if(y.sequence_name){let E=await t.query(`SELECT last_value FROM ${y.sequence_name}`);S.push({sequenceName:y.sequence_name,columnName:y.column_name,currentValue:parseInt(E.rows[0].last_value)})}return{tableName:n,schemaName:r,columns:i,constraints:l,indexes:d,sequences:S}}async disableForeignKeyConstraints(t){this.log("\u{1F513} Disabling foreign key constraints..."),await t.query("SET session_replication_role = replica"),this.log("\u2705 Foreign key constraints disabled")}async enableForeignKeyConstraints(t){this.log("\u{1F512} Re-enabling foreign key constraints..."),await t.query("SET session_replication_role = origin"),this.log("\u2705 Foreign key constraints re-enabled")}async performDryRun(t,r){this.log("\u{1F9EA} Performing dry run analysis..."),this.log("\u{1F4CA} Migration Plan:"),this.log(`   Source tables to migrate: ${t.length}`);for(let s of t)try{let i=await this.sourcePool.query(`SELECT COUNT(*) FROM ${s.tableName}`),a=parseInt(i.rows[0].count);this.log(`   - ${s.tableName}: ${a} rows \u2192 ${s.tableName}_shadow`)}catch(i){this.log(`   - ${s.tableName}: Could not count rows (${i})`)}this.log(`   Destination schema to backup: ${r.length} tables`);let n=Date.now();this.log(`   \u2192 All tables will be preserved in backup_${n} schema`);for(let s of r)try{let i=await this.destPool.query(`SELECT COUNT(*) FROM ${s.tableName}`),a=parseInt(i.rows[0].count);this.log(`   - ${s.tableName}: ${a} rows`)}catch(i){this.log(`   - ${s.tableName}: Could not count rows (${i})`)}let o=[];for(let s of this.preservedTables){let i=t.some(c=>c.tableName.toLowerCase()===s),a=r.some(c=>c.tableName.toLowerCase()===s);i&&a&&o.push(s)}if(o.length>0){this.log(`   Preserved tables to restore: ${o.length}`);for(let s of o)this.log(`   - ${s}: Will clear and restore from backup`)}this.log("\u{1F9EA} Dry run completed - no changes made")}async performCompleteMigration(t,r){this.log("\u{1F504} Starting database migration...");let n=Date.now();try{await this.createShadowSchemaAndRestore(t,n),await this.setupPreservedTableSync(r,n),await this.backupPreservedTableData(r,n),await this.performAtomicSchemaSwap(n),await this.cleanupSyncTriggersAndValidate(n),this.log("\u{1F522} Phase 5: Resetting sequences..."),await this.resetSequences(t),this.log("\u{1F5C2}\uFE0F  Phase 6: Recreating indexes..."),await this.recreateIndexes(t),this.log("\u2705 Zero-downtime migration finished successfully"),this.log(`\u{1F4E6} Original schema preserved in backup_${n} schema`),this.log("\u{1F4A1} Call cleanupBackupSchema(timestamp) to remove backup after verification")}catch(o){this.logError("Migration failed",o);try{this.activeSyncTriggers.length>0&&(this.log("\u{1F9F9} Cleaning up active sync triggers before rollback..."),await this.cleanupRealtimeSync(this.activeSyncTriggers))}catch(s){this.logError("Warning: Could not cleanup sync triggers",s)}this.log("\u{1F504} Attempting automatic rollback via schema swap...");try{await this.rollbackSchemaSwap(n),this.log("\u2705 Rollback completed - original schema restored")}catch(s){this.logError("Rollback failed",s),this.log("\u26A0\uFE0F  Manual intervention required - check backup schema")}throw o}}async createShadowSchemaAndRestore(t,r){this.log("\u{1F527} Phase 1: Creating shadow schema and restoring source data...");let n=await this.destPool.connect();try{await this.disableForeignKeyConstraints(this.destPool),await this.prepareSourceForShadowDump(t);let o=aT(this.tempDir,`source_dump_${r}.backup`);await this.createBinaryDump(o),this.log("\u26A0\uFE0F  Dropping existing shadow schema on destination (if exists)"),await n.query("DROP SCHEMA IF EXISTS shadow CASCADE;"),this.log("\u2705 Shadow schema dropped - will be recreated by pg_restore");let s=Math.min(8,cT().length);this.log(`\u{1F680} Restoring with ${s} parallel jobs...`);let i=["--jobs",s.toString(),"--format","custom","--no-privileges","--no-owner","--disable-triggers","--dbname",this.destConfig.database,"--host",this.destConfig.host,"--port",this.destConfig.port.toString(),"--username",this.destConfig.user,o],a={...process.env,PGPASSWORD:this.destConfig.password};await _s("pg_restore",i,{env:a}),this.log("\u2705 Source data restored to shadow schema with parallelization"),await this.restoreSourceFromShadowDump(t),iT(o)&&sT(o),this.stats.tablesProcessed=t.length}finally{n.release()}}async createBinaryDump(t){this.log("\u{1F4E6} Creating binary dump of source database...");let r=["--format","custom","--no-privileges","--no-owner","--disable-triggers","--verbose","--schema","shadow","--file",t,"--host",this.sourceConfig.host,"--port",this.sourceConfig.port.toString(),"--username",this.sourceConfig.user,"--dbname",this.sourceConfig.database],n={...process.env,PGPASSWORD:this.sourceConfig.password};await _s("pg_dump",r,{env:n}),this.log(`\u2705 Binary dump created: ${t}`)}async moveObjectsToShadowSchema(t,r){this.log("\u{1F504} Moving restored objects to shadow schema...");for(let n of r)try{(await t.query(`
          SELECT EXISTS (
            SELECT 1 FROM information_schema.tables 
            WHERE table_schema = 'public' 
            AND table_name = $1
          )
        `,[n.tableName])).rows[0].exists&&(await t.query(`ALTER TABLE public."${n.tableName}" SET SCHEMA shadow;`),this.log(`\u{1F4E6} Moved ${n.tableName} to shadow schema`))}catch(o){let s=o instanceof Error?o.message:String(o);this.log(`\u26A0\uFE0F  Warning: Could not move ${n.tableName} to shadow schema: ${s}`)}this.log("\u2705 Objects moved to shadow schema")}async prepareSourceForShadowDump(t){this.log("\u{1F504} Preparing source database - moving tables to shadow schema...");let r=await this.sourcePool.connect();try{await r.query("DROP SCHEMA IF EXISTS shadow CASCADE;"),await r.query("CREATE SCHEMA shadow;"),this.log("\u2705 Shadow schema created on source database");for(let n of t)try{await r.query(`ALTER TABLE public."${n.tableName}" SET SCHEMA shadow;`),this.log(`\u{1F4E6} Moved source table ${n.tableName} to shadow schema`)}catch(o){let s=o instanceof Error?o.message:String(o);throw this.log(`\u26A0\uFE0F  Warning: Could not move source table ${n.tableName}: ${s}`),o}this.log("\u2705 All source tables moved to shadow schema")}finally{r.release()}}async restoreSourceFromShadowDump(t){this.log("\u{1F504} Restoring source database - moving tables back to public schema...");let r=await this.sourcePool.connect();try{for(let n of t)try{await r.query(`ALTER TABLE shadow."${n.tableName}" SET SCHEMA public;`),this.log(`\u{1F4E6} Restored source table ${n.tableName} to public schema`)}catch(o){let s=o instanceof Error?o.message:String(o);this.log(`\u26A0\uFE0F  Warning: Could not restore source table ${n.tableName}: ${s}`)}await r.query("DROP SCHEMA IF EXISTS shadow CASCADE;"),this.log("\u2705 Source database restored and shadow schema cleaned up")}finally{r.release()}}async backupPreservedTableData(t,r){if(this.preservedTables.size===0){this.log("\u2705 No preserved tables to backup");return}this.log("\u{1F4BE} Phase 2: Backing up preserved table data...");let n=await this.destPool.connect();try{await n.query("BEGIN");for(let o of this.preservedTables){let s=`${o}_backup_${r}`;try{if((await n.query(`
            SELECT EXISTS (
              SELECT 1 FROM information_schema.tables 
              WHERE table_schema = 'public' 
              AND table_name = $1
            )
          `,[o])).rows[0].exists){this.log(`\u{1F4BE} Backing up preserved table: ${o} \u2192 ${s}`),await n.query(`CREATE TABLE "${s}" AS SELECT * FROM "${o}"`);let a=await n.query(`SELECT COUNT(*) FROM "${s}"`),c=parseInt(a.rows[0].count);this.log(`\u{1F4CA} Backed up ${c} rows from ${o}`)}else this.log(`\u26A0\uFE0F  Table ${o} not found, skipping backup`)}catch(i){let a=i instanceof Error?i.message:String(i);this.log(`\u26A0\uFE0F  Warning: Could not backup ${o}: ${a}`)}}await n.query("COMMIT"),this.log("\u2705 Preserved table data backed up")}catch(o){throw await n.query("ROLLBACK"),new Error(`Failed to backup preserved table data: ${o}`)}finally{n.release()}}async performAtomicSchemaSwap(t){this.log("\u{1F504} Phase 3: Performing atomic schema swap...");let r=await this.destPool.connect();try{await r.query("BEGIN");let n=`backup_${t}`;await r.query(`ALTER SCHEMA public RENAME TO ${n};`),this.log(`\u{1F4E6} Moved public schema to ${n}`),await r.query("ALTER SCHEMA shadow RENAME TO public;"),this.log("\u{1F680} Activated shadow schema as new public schema"),await r.query("CREATE SCHEMA shadow;"),this.log("\u2705 Created new shadow schema"),await r.query("COMMIT"),this.log("\u2705 Atomic schema swap completed - migration is now live!")}catch(n){throw await r.query("ROLLBACK"),new Error(`Failed to perform schema swap: ${n}`)}finally{r.release()}}async setupPreservedTableSync(t,r){if(this.preservedTables.size===0){this.log("\u2705 No preserved tables to sync");return}this.log(`\u{1F504} Phase 2A: Setting up preserved table synchronization (backup_${r})...`);let n=[];for(let s of this.preservedTables)t.some(a=>a.tableName.toLowerCase()===s.toLowerCase())||n.push(s);if(n.length>0)throw new Error(`Preserved tables not found in destination: ${n.join(", ")}`);let o=await this.destPool.connect();try{for(let s of this.preservedTables){let i=t.find(c=>c.tableName.toLowerCase()===s.toLowerCase());if(!i){this.log(`\u26A0\uFE0F  Preserved table ${s} not found in destination schema, skipping`);continue}if(this.log(`\u{1F504} Setting up sync for preserved table: ${s} (${i.columns.length} columns)`),(await o.query(`
          SELECT EXISTS (
            SELECT 1 FROM information_schema.tables 
            WHERE table_schema = 'public' 
            AND table_name = $1
          )
        `,[s])).rows[0].exists){await o.query(`DELETE FROM shadow."${s}"`),await o.query(`INSERT INTO shadow."${s}" SELECT * FROM public."${s}"`);let c=await this.createRealtimeSyncTrigger(o,s);c.checksum=`sync_${r}`,this.activeSyncTriggers.push(c);let l=await this.validateSyncConsistency(s);if(!l.isValid)throw new Error(`Initial sync validation failed for ${s}: ${l.errors.join(", ")}`);this.log(`\u2705 Sync setup complete for ${s} (${l.sourceRowCount} rows)`)}else throw new Error(`Preserved table ${s} exists in schema analysis but not in actual database`)}this.log(`\u2705 Real-time sync setup complete for ${this.activeSyncTriggers.length} preserved tables (backup_${r})`)}catch(s){try{await this.cleanupRealtimeSync(this.activeSyncTriggers)}catch(i){this.logError("Failed to cleanup triggers after setup error",i)}throw s}finally{o.release()}}async createRealtimeSyncTrigger(t,r){let n=`sync_${r}_to_shadow`,o=`${n}_trigger`,i=(await t.query(`
      SELECT column_name, data_type 
      FROM information_schema.columns 
      WHERE table_schema = 'public' 
      AND table_name = $1 
      ORDER BY ordinal_position
    `,[r])).rows.map(d=>d.column_name),a=i.map(d=>`"${d}"`).join(", "),c=i.map(d=>`NEW."${d}"`).join(", "),l=i.map(d=>`"${d}" = NEW."${d}"`).join(", "),u=`
      CREATE OR REPLACE FUNCTION ${n}()
      RETURNS TRIGGER AS $$
      BEGIN
        IF TG_OP = 'DELETE' THEN
          DELETE FROM shadow.${r} WHERE id = OLD.id;
          RETURN OLD;
        ELSIF TG_OP = 'UPDATE' THEN
          UPDATE shadow.${r} 
          SET ${l}
          WHERE id = OLD.id;
          RETURN NEW;
        ELSIF TG_OP = 'INSERT' THEN
          INSERT INTO shadow.${r} (${a})
          VALUES (${c});
          RETURN NEW;
        END IF;
        RETURN NULL;
      END;
      $$ LANGUAGE plpgsql;
    `;await t.query(u);let f=`
      CREATE TRIGGER ${o}
        AFTER INSERT OR UPDATE OR DELETE ON public.${r}
        FOR EACH ROW EXECUTE FUNCTION ${n}();
    `;return await t.query(f),this.log(`\u2705 Created sync trigger: ${o}`),{tableName:r,functionName:n,triggerName:o,isActive:!0}}async cleanupSyncTriggersAndValidate(t){if(this.activeSyncTriggers.length===0){this.log("\u2705 No sync triggers to cleanup");return}this.log(`\u{1F9F9} Phase 4: Cleaning up sync triggers and validating consistency (backup_${t})...`);try{let r=await Promise.all(this.activeSyncTriggers.map(o=>this.validateSyncConsistency(o.tableName))),n=!0;for(let o of r)o.isValid?this.log(`\u2705 Sync validation passed for ${o.tableName} (${o.sourceRowCount} rows)`):(n=!1,this.logError(`Sync validation failed for ${o.tableName}`,new Error(o.errors.join(", "))),this.log(`   Source: ${o.sourceRowCount} rows, checksum: ${o.sourceChecksum}`),this.log(`   Target: ${o.targetRowCount} rows, checksum: ${o.targetChecksum}`));if(!n)throw new Error("Sync validation failed for one or more preserved tables");await this.cleanupRealtimeSync(this.activeSyncTriggers),this.log(`\u2705 Sync triggers cleaned up and validation complete (backup_${t})`)}catch(r){try{await this.cleanupRealtimeSync(this.activeSyncTriggers)}catch(n){this.logError("Failed to cleanup triggers after validation error",n)}throw r}}async cleanupRealtimeSync(t){if(t.length===0)return;this.log(`\u{1F9F9} Cleaning up ${t.length} sync triggers...`);let r=await this.destPool.connect();try{for(let n of t)try{await r.query(`DROP TRIGGER IF EXISTS ${n.triggerName} ON public.${n.tableName}`),await r.query(`DROP FUNCTION IF EXISTS ${n.functionName}()`),this.log(`\u2705 Cleaned up sync trigger: ${n.triggerName}`),n.isActive=!1}catch(o){this.logError(`Failed to cleanup trigger ${n.triggerName}`,o)}this.activeSyncTriggers=[]}finally{r.release()}}async validateSyncConsistency(t){let r=await this.destPool.connect();try{let n=await r.query(`SELECT COUNT(*) FROM public.${t}`),o=await r.query(`SELECT COUNT(*) FROM shadow.${t}`),s=parseInt(n.rows[0].count),i=parseInt(o.rows[0].count),a=await r.query(`
        SELECT md5(string_agg(md5(ROW(*)::text), '' ORDER BY id)) as checksum 
        FROM public.${t}
      `),c=await r.query(`
        SELECT md5(string_agg(md5(ROW(*)::text), '' ORDER BY id)) as checksum 
        FROM shadow.${t}
      `),l=a.rows[0]?.checksum||"",u=c.rows[0]?.checksum||"",f=[],d=!0;return s!==i&&(f.push(`Row count mismatch: source=${s}, target=${i}`),d=!1),l!==u&&(f.push(`Checksum mismatch: source=${l}, target=${u}`),d=!1),{tableName:t,isValid:d,sourceRowCount:s,targetRowCount:i,sourceChecksum:l,targetChecksum:u,errors:f}}catch(n){return{tableName:t,isValid:!1,sourceRowCount:0,targetRowCount:0,sourceChecksum:"",targetChecksum:"",errors:[`Validation error: ${n}`]}}finally{r.release()}}async rollbackSchemaSwap(t){this.log("\u{1F504} Rolling back schema swap...");let r=await this.destPool.connect(),n=`backup_${t}`;try{await r.query("BEGIN"),(await r.query(`
        SELECT EXISTS (
          SELECT 1 FROM information_schema.schemata 
          WHERE schema_name = $1
        )
      `,[n])).rows[0].exists?(await r.query(`ALTER SCHEMA public RENAME TO failed_migration_${t};`),await r.query(`ALTER SCHEMA ${n} RENAME TO public;`),await r.query("COMMIT"),this.log("\u2705 Schema rollback completed")):(await r.query("ROLLBACK"),this.log("\u26A0\uFE0F  No backup schema found for rollback"))}catch(o){throw await r.query("ROLLBACK"),new Error(`Rollback failed: ${o}`)}finally{r.release()}}async cleanupBackupSchema(t){this.log("\u{1F5D1}\uFE0F  Cleaning up backup schema...");let r=await this.destPool.connect(),n=`backup_${t}`;try{(await r.query(`
        SELECT EXISTS (
          SELECT 1 FROM information_schema.schemata 
          WHERE schema_name = $1
        )
      `,[n])).rows[0].exists?(await r.query(`DROP SCHEMA ${n} CASCADE;`),this.log(`\u{1F5D1}\uFE0F  Cleaned up backup schema: ${n}`)):this.log(`\u26A0\uFE0F  Backup schema ${n} not found`);let s=await r.query(`
        SELECT table_name 
        FROM information_schema.tables 
        WHERE table_schema = 'public' 
        AND table_name LIKE '%_backup_${t}'
      `);for(let i of s.rows)try{await r.query(`DROP TABLE "${i.table_name}" CASCADE;`),this.log(`\u{1F5D1}\uFE0F  Cleaned up backup table: ${i.table_name}`)}catch(a){let c=a instanceof Error?a.message:String(a);this.log(`\u26A0\uFE0F  Warning: Could not clean up backup table ${i.table_name}: ${c}`)}this.log("\u2705 Backup cleanup completed")}catch(o){let s=o instanceof Error?o.message:String(o);this.log(`\u26A0\uFE0F  Warning: Could not clean up backup schema: ${s}`)}finally{r.release()}}async resetSequences(t){this.log("\u{1F522} Resetting sequences...");for(let r of t)for(let n of r.sequences)try{let o=r.tableName.replace("_shadow",""),s=await this.destPool.query(`SELECT COALESCE(MAX(${n.columnName}), 0) as max_val FROM ${o}`),a=parseInt(s.rows[0].max_val)+1;await this.destPool.query(`SELECT setval('${n.sequenceName}', $1)`,[a]),this.log(`\u2705 Reset sequence ${n.sequenceName} to ${a}`)}catch(o){this.logError(`Failed to reset sequence ${n.sequenceName}`,o)}}async recreateIndexes(t){this.log("\u{1F5C2}\uFE0F  Recreating indexes...");for(let r of t)for(let n of r.indexes)try{if(n.definition.includes("UNIQUE")||n.definition.includes("PRIMARY KEY"))continue;let o=r.tableName.replace("_shadow",""),s=n.definition.replace(r.tableName,o);(n.indexType==="gist"||s.includes("USING gist"))&&this.log(`\u{1F30D} Recreating spatial index: ${n.indexName}`),await this.destPool.query(s),this.log(`\u2705 Recreated index: ${n.indexName}`)}catch(o){this.logError(`Failed to recreate index ${n.indexName}`,o),this.stats.warnings.push(`Could not recreate index ${n.indexName}: ${o}`)}}async cleanup(){this.log("\u{1F9F9} Cleaning up resources...");try{await this.sourcePool.end(),await this.destPool.end(),this.log("\u2705 Database connections closed")}catch(t){this.logError("Error during cleanup",t)}}log(t){let r=new Date().toISOString();console.log(`[${r}] ${t}`)}logError(t,r){let o=`[${new Date().toISOString()}] \u274C ${t}: ${r}`;console.error(o),this.stats.errors.push(o)}logSummary(){let t=this.stats.endTime?(this.stats.endTime.getTime()-this.stats.startTime.getTime())/1e3:0;this.log("\u{1F4CA} Migration Summary:"),this.log(`   \u23F1\uFE0F  Duration: ${t}s`),this.log(`   \u{1F4E6} Tables processed: ${this.stats.tablesProcessed}`),this.log(`   \u{1F4CA} Records migrated: ${this.stats.recordsMigrated}`),this.log(`   \u26A0\uFE0F  Warnings: ${this.stats.warnings.length}`),this.log(`   \u274C Errors: ${this.stats.errors.length}`),this.stats.warnings.length>0&&(this.log("\u26A0\uFE0F  Warnings:"),this.stats.warnings.forEach(r=>this.log(`   - ${r}`))),this.stats.errors.length>0&&(this.log("\u274C Errors:"),this.stats.errors.forEach(r=>this.log(`   - ${r}`)))}};function Rs(e){let t=new URL(e);return{host:t.hostname,port:parseInt(t.port)||5432,database:t.pathname.substring(1),user:t.username,password:t.password}}import{fileURLToPath as uT}from"url";var As=class{client;dryRun;constructor(t,r=!1){this.client=new ya(t),this.dryRun=r}log(t){console.log(t)}async connect(){await this.client.connect()}async disconnect(){await this.client.end()}async listBackups(t=!1){await this.connect();try{let r=await this.getAvailableBackups();t?console.log(JSON.stringify(r.map(n=>({timestamp:n.timestamp,created:n.created.toISOString(),tableCount:n.tableCount,size:n.size})),null,2)):this.printBackupsTable(r)}finally{await this.disconnect()}}async getAvailableBackups(){let r=await this.client.query(`
      SELECT 
        nspname as schema_name,
        CASE 
          WHEN nspname ~ '^backup_([0-9]+)$' 
          THEN CAST(substring(nspname from '^backup_([0-9]+)$') AS BIGINT)
          ELSE 0
        END as timestamp
      FROM pg_namespace 
      WHERE nspname LIKE 'backup_%'
        AND nspname ~ '^backup_[0-9]+$'
      ORDER BY timestamp DESC;
    `),n=[];for(let o of r.rows){let s=o.timestamp,i=o.schema_name,a=new Date(s),l=await this.client.query(`
        SELECT COUNT(*) as count 
        FROM information_schema.tables 
        WHERE table_schema = $1;
      `,[i]),u=parseInt(l.rows[0].count),p=(await this.client.query(`
        SELECT 
          COALESCE(
            pg_size_pretty(
              SUM(pg_total_relation_size(schemaname||'.'||tablename))
            ), 
            '0 bytes'
          ) as size
        FROM pg_tables 
        WHERE schemaname = $1;
      `,[i])).rows[0]?.size||"0 bytes";n.push({timestamp:s,schemaName:i,created:a,tableCount:u,size:p})}return n}printBackupsTable(t){if(t.length===0){console.log("No backup schemas found.");return}console.log("\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510"),console.log("\u2502 Timestamp       \u2502 Created             \u2502 Tables \u2502 Size     \u2502"),console.log("\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524");for(let r of t){let n=r.timestamp.toString().padEnd(15),o=r.created.toISOString().replace("T"," ").substring(0,19).padEnd(19),s=r.tableCount.toString().padEnd(6),i=r.size.padEnd(8);console.log(`\u2502 ${n} \u2502 ${o} \u2502 ${s} \u2502 ${i} \u2502`)}console.log("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518")}async rollback(t,r=[]){await this.connect();try{let n=await this.getAvailableBackups();if(n.length===0)throw new Error("No backup schemas found");let o=t==="latest"?n[0]:n.find(s=>s.timestamp===t);if(!o)throw new Error(`Backup not found: ${t}`);await this.performRollback(o,r)}finally{await this.disconnect()}}async performRollback(t,r){if(this.log(`
\u26A0\uFE0F  DESTRUCTIVE ROLLBACK - NO UNDO AVAILABLE`),this.log("\u2022 Current 'public' schema \u2192 renamed to 'shadow' (temporary)"),this.log(`\u2022 Backup '${t.schemaName}' \u2192 renamed to 'public' (restored)`),this.log("\u2022 Existing 'shadow' schema will be DELETED if present"),r.length>0&&(this.log(`
CURRENT DATA TO BE KEPT:`),this.log(`\u2022 Tables to copy from shadow to public: ${r.join(", ")}`)),this.log(`
BACKUP CONSUMED:`),this.log(`\u2022 Backup '${t.schemaName}' will be consumed (no longer available)`),this.dryRun){this.log(`
\u{1F50D} DRY RUN - No changes made`);return}this.log(`
\u2705 Proceeding with destructive rollback...`);try{this.log("\u{1F513} Disabling foreign key constraints for rollback..."),await this.client.query("SET session_replication_role = replica;"),await this.client.query("DROP SCHEMA IF EXISTS shadow CASCADE;"),this.log("\u2022 Cleared existing shadow schema"),await this.client.query("ALTER SCHEMA public RENAME TO shadow;"),this.log("\u2022 Renamed current public schema to shadow"),await this.client.query(`ALTER SCHEMA ${t.schemaName} RENAME TO public;`),this.log("\u2022 Renamed backup schema to public"),r.length>0&&await this.copyKeepTables(r),this.log("\u{1F512} Re-enabling foreign key constraints..."),await this.client.query("SET session_replication_role = origin;"),await this.client.query("DROP SCHEMA shadow CASCADE;"),this.log("\u2022 Cleaned up shadow schema"),this.log(`
\u2705 Rollback completed successfully!`),this.log(`\u{1F4E6} Backup '${t.schemaName}' has been consumed`)}catch(n){this.log(`
\u274C Rollback failed, attempting to restore original state...`);try{this.log("\u{1F512} Re-enabling foreign key constraints after rollback error..."),await this.client.query("SET session_replication_role = origin;")}catch(o){this.log(`\u26A0\uFE0F  Warning: Could not re-enable foreign key constraints: ${o}`)}throw await this.recoverFromFailedRollback(),n}}async copyKeepTables(t){this.log(`
\u{1F504} Copying preserved tables from shadow to public...`);for(let r of t)try{if(!(await this.client.query(`
          SELECT EXISTS (
            SELECT 1 FROM information_schema.tables 
            WHERE table_schema = 'shadow' AND table_name = $1
          );
        `,[r])).rows[0].exists){this.log(`\u26A0\uFE0F  Table '${r}' not found in shadow schema, skipping`);continue}await this.client.query(`DROP TABLE IF EXISTS public."${r}" CASCADE;`),await this.client.query(`CREATE TABLE public."${r}" (LIKE shadow."${r}" INCLUDING ALL);`),await this.client.query(`INSERT INTO public.${r} SELECT * FROM shadow.${r};`),this.log(`  \u2713 Copied table '${r}' from shadow to public`)}catch(n){throw this.log(`  \u274C Failed to copy table '${r}': ${n}`),n}}async recoverFromFailedRollback(){try{(await this.client.query(`
        SELECT EXISTS (
          SELECT 1 FROM information_schema.schemata 
          WHERE schema_name = 'shadow'
        );
      `)).rows[0].exists?(await this.client.query("DROP SCHEMA IF EXISTS public CASCADE;"),await this.client.query("ALTER SCHEMA shadow RENAME TO public;"),this.log("\u2705 Original state restored from shadow")):this.log("\u274C Cannot recover: shadow schema not found")}catch(t){this.log(`\u274C Recovery failed: ${t}`)}}async cleanup(t){await this.connect();try{let r=this.parseDateString(t),o=(await this.getAvailableBackups()).filter(s=>s.timestamp<r);if(o.length===0){this.log("No backup schemas found before the specified date.");return}if(this.dryRun){this.log(`Would delete ${o.length} backup schema(s):`);for(let s of o)this.log(`\u2022 ${s.schemaName} (${s.created.toISOString().replace("T"," ").substring(0,19)})`);return}this.log(`Deleting ${o.length} backup schema(s)...`);for(let s of o)await this.client.query(`DROP SCHEMA ${s.schemaName} CASCADE;`),this.log(`\u2022 Deleted ${s.schemaName}`);this.log("\u2705 Cleanup completed successfully!")}finally{await this.disconnect()}}parseDateString(t){let r;if(t.match(/^\d{4}-\d{2}-\d{2}$/))r=new Date(t+"T00:00:00.000Z");else if(t.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/))r=new Date(t.replace(" ","T")+":00.000Z");else{if(t.match(/^\d+$/))return parseInt(t);throw new Error(`Invalid date format: ${t}. Use ISO format (2025-07-15) or timestamp.`)}if(isNaN(r.getTime()))throw new Error(`Invalid date: ${t}`);return r.getTime()}async verify(t){await this.connect();try{let n=(await this.getAvailableBackups()).find(o=>o.timestamp===t);if(!n)throw new Error(`Backup not found: ${t}`);this.log(`\u{1F50D} Verifying backup: ${n.schemaName}`),this.log(`Created: ${n.created.toISOString().replace("T"," ").substring(0,19)}`),await this.performAdvancedVerification(n),this.log("\u2705 Backup verification completed successfully!")}finally{await this.disconnect()}}async performAdvancedVerification(t){if(!(await this.client.query(`
      SELECT EXISTS (
        SELECT 1 FROM information_schema.schemata 
        WHERE schema_name = $1
      );
    `,[t.schemaName])).rows[0].exists)throw new Error(`Schema ${t.schemaName} does not exist`);this.log("  \u2713 Schema exists");let o=(await this.client.query(`
      SELECT table_name 
      FROM information_schema.tables 
      WHERE table_schema = $1 
      ORDER BY table_name;
    `,[t.schemaName])).rows.map(s=>s.table_name);this.log(`  \u2713 Found ${o.length} tables`);for(let s of o){let i=await this.client.query(`
        SELECT COUNT(*) as count 
        FROM ${t.schemaName}.${s};
      `),a=parseInt(i.rows[0].count);this.log(`    \u2022 ${s}: ${a} rows`)}for(let s of o){let i=await this.client.query(`
        SELECT COUNT(*) as count 
        FROM ${t.schemaName}.${s} 
        LIMIT 5;
      `);parseInt(i.rows[0].count)>0&&await this.client.query(`SELECT * FROM ${t.schemaName}.${s} LIMIT 1;`)}this.log("  \u2713 Sample data integrity verified")}};function xd(){console.log(`
Usage: npm run migration <command> [options]

Commands:
  list                                    List all available backup schemas
  start --source <url> --dest <url>       Start database migration
  rollback --latest                       Rollback to most recent backup
  rollback --timestamp <ts>               Rollback to specific backup timestamp
  cleanup --before <date>                 Delete backups before specified date
  verify --timestamp <ts>                 Verify backup integrity

Options:
  --source <url>                         Source database URL (for start command)
  --dest <url>                           Destination database URL (for start command)
  --preserved-tables <table1,table2>     Tables to preserve during migration (for start command)
  --keep-tables <table1,table2>          Tables to preserve during rollback
  --json                                 Output as JSON (list command only)
  --dry-run                              Preview changes without executing
  --help                                 Show this help message

Examples:
  npm run migration -- list
  npm run migration -- list --json
  npm run migration -- start --source postgres://user:pass@host:port/db --dest postgres://user:pass@host:port/db
  npm run migration -- start --source postgres://... --dest postgres://... --preserved-tables users,sessions --dry-run
  npm run migration -- rollback --latest
  npm run migration -- rollback --timestamp 1753207951602
  npm run migration -- rollback --latest --keep-tables users,sessions
  npm run migration -- rollback --latest --dry-run
  npm run migration cleanup --before "2025-07-15"
  npm run migration cleanup --before "2025-07-15 10:30" --dry-run
  npm run migration verify --timestamp 1753207951602

Date Formats:
  ISO Date: 2025-07-15
  Date + Time: 2025-07-15 10:30
  Timestamp: 1753207951602
`)}async function fT(){try{let{values:e,positionals:t}=lT({args:process.argv.slice(2),options:{latest:{type:"boolean"},timestamp:{type:"string"},before:{type:"string"},source:{type:"string"},dest:{type:"string"},"preserved-tables":{type:"string"},"keep-tables":{type:"string"},json:{type:"boolean"},"dry-run":{type:"boolean"},help:{type:"boolean"}},allowPositionals:!0});if(e.help||t.length===0){xd();return}let r=t[0],n=e["dry-run"]||!1;switch(r){case"start":await dT(e,n);break;case"list":case"rollback":case"cleanup":case"verify":await pT(r,e,n);break;default:console.error(`Unknown command: ${r}`),xd(),process.exit(1)}}catch(e){console.error(`
\u274C Error:`,e instanceof Error?e.message:e),process.exit(1)}}async function dT(e,t){let r=e.source||process.env.SOURCE_DATABASE_URL,n=e.dest||process.env.DEST_DATABASE_URL||process.env.DATABASE_URL,o=e["preserved-tables"]||process.env.PRESERVED_TABLES||"";(!r||!n)&&(console.error("\u274C Start command requires:"),console.error("   --source <url> - Source database connection string"),console.error("   --dest <url> - Destination database connection string"),console.error("   Optional: --preserved-tables <table1,table2> - Tables to preserve"),console.error("   Optional: --dry-run - Preview mode"),process.exit(1));let s=o.split(",").map(l=>l.trim()).filter(l=>l.length>0),i=Rs(r),a=Rs(n);console.log("\u{1F680} Database Migration Tool"),console.log(`\u{1F4CD} Source: ${i.host}:${i.port}/${i.database}`),console.log(`\u{1F4CD} Destination: ${a.host}:${a.port}/${a.database}`),console.log(`\u{1F512} Preserved tables: ${s.join(", ")||"none"}`),console.log("");let c=new Ur(i,a,s,t);try{await c.migrate(),console.log(`
\u2705 Migration completed successfully!`),console.log("\u{1F4E6} Schema backup retained for rollback purposes"),process.exit(0)}catch(l){console.error(`
\u274C Migration failed:`,l),process.exit(1)}}async function pT(e,t,r){let n={host:process.env.DB_HOST||"localhost",port:parseInt(process.env.DB_PORT||"5432"),database:process.env.DB_NAME||"postgres",user:process.env.DB_USER||"postgres",password:process.env.DB_PASSWORD||""},o=new As(n,r);switch(e){case"list":await o.listBackups(t.json||!1);break;case"rollback":{let s;if(t.latest)s="latest";else if(t.timestamp){if(s=parseInt(t.timestamp),isNaN(s))throw new Error("Invalid timestamp format")}else throw new Error("Rollback requires --latest or --timestamp option");let i=t["keep-tables"]?t["keep-tables"].split(",").map(a=>a.trim()):[];await o.rollback(s,i);break}case"cleanup":if(!t.before)throw new Error("Cleanup requires --before option");await o.cleanup(t.before);break;case"verify":{if(!t.timestamp)throw new Error("Verify requires --timestamp option");let s=parseInt(t.timestamp);if(isNaN(s))throw new Error("Invalid timestamp format");await o.verify(s);break}default:throw new Error(`Unknown backup command: ${e}`)}}process.argv[1]===uT(import.meta.url)&&fT();export{As as MigrationManager};
